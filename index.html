<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾ç¥ç©ºèª¿å¹«æ‰‹ | å°ˆæ¥­å†·æ°£å¸«å‚…å·¥å…·ç®± V11.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                return false;
            }
        });

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        industrial: { 950: '#020617', 900: '#0f172a', 800: '#1e293b', 700: '#334155', 600: '#475569', accent: '#f59e0b', text: '#e2e8f0' },
                        heat: { 500: '#f97316', 900: '#7c2d12' }, 
                        cool: { 500: '#3b82f6', 900: '#1e3a8a' },
                        table: { head: '#1e293b', border: '#475569', row: '#0f172a', rowAlt: '#1a2436' }
                    },
                    animation: { 'fade-in': 'fadeIn 0.2s ease-out', 'zoom-in': 'zoomIn 0.2s ease-out', 'slide-up': 'slideUp 0.3s ease-out' },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        zoomIn: { '0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020617; color: #e2e8f0; user-select: none; font-family: 'Microsoft JhengHei', sans-serif; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        input, select { outline: none; background: transparent; }
        select { appearance: none; }
        
        /* è¡¨æ ¼å°ˆç”¨æ¨£å¼ */
        .spec-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .spec-table th, .spec-table td { border: 1px solid #475569; padding: 8px 12px; }
        .spec-table th { background-color: #334155; color: #f59e0b; font-weight: bold; text-align: left; white-space: nowrap; width: 30%; }
        .spec-table td { color: #e2e8f0; font-family: monospace; }
        .spec-table tr:nth-child(even) { background-color: #1a2436; }
        
        .grid-pos-btn { aspect-ratio: 1/1; border: 1px solid #334155; display: flex; align-items: center; justify-content: center; border-radius: 6px; cursor: pointer; transition: all 0.2s; background-color: #1e293b; color: #475569; }
        .grid-pos-btn.active-unit { background-color: #3b82f6; color: #fff; border-color: #3b82f6; }
        .grid-pos-btn.active-outlet { background-color: #10b981; color: #fff; border-color: #10b981; }
        
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- ğŸ”¥ é—œéµæ­¥é©Ÿï¼šåœ¨é€™è£¡å¼•å…¥ä½ çš„è³‡æ–™åº«æª”æ¡ˆ ğŸ”¥ -->
    <script src="database.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- 1. åŸºç¤å…ƒä»¶ ---
        // AC_DATABASE å·²ç¶“åœ¨ database.js è¼‰å…¥ï¼Œé€™è£¡ç›´æ¥ä½¿ç”¨å³å¯ï¼Œä¸éœ€é‡æ–°å®šç¾©

        const Icon = ({ name, className = "w-4 h-4" }) => {
            const icons = {
                menu: <><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></>,
                wrench: <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />,
                search: <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
                ruler: <path d="M21.3 15.3 16 10l-4.9 4.9-5.3-5.3-1.4 1.4 5.3 5.3L5.4 21l-1.4-1.4 4.6-4.6L2.7 9.7l1.4-1.4 4.6 4.6L12.1 9l1.4 1.4-4.6 4.6 4.6 4.6 5.3-5.3 1.4 1.4-5.3 5.3 1.4 1.4Z" />,
                calculator: <><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></>,
                box: <><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" /><path d="m3.3 7 8.7 5 8.7-5" /><path d="M12 22V12" /></>,
                history: <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M12 7v5l4 2" /></>,
                x: <><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>,
                check: <path d="M20 6 9 17l-5-5" />,
                zap: <path d="M4 14.5 14 3 12.5 9.5H20L10 21l1.5-6.5H4Z" />,
                trash: <><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></>,
                "circle-dot": <><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></>,
                "chevron-right": <path d="m9 18 6-6-6-6" />,
                "wind": <><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2" /><path d="M9.6 4.6A2 2 0 1 1 11 8H2" /><path d="M12.6 19.4A2 2 0 1 0 14 16H2" /></>,
                "git-merge": <><circle cx="18" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><path d="M6 21V9a9 9 0 0 0 9 9"/></>,
                "plus": <><path d="M5 12h14"/><path d="M12 5v14"/></>,
                "thermometer": <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />,
                sun: <><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41-1.41" /><path d="m19.07 4.93-1.41 1.41" /></>,
                snowflake: <><line x1="2" x2="22" y1="12" y2="12" /><line x1="12" x2="12" y1="2" y2="22" /><path d="m20 16-4-4 4-4" /><path d="m4 8 4 4-4 4" /><path d="m16 4-4 4-4-4" /><path d="m8 20 4-4 4 4" /></>,
                "eye": <><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z" /><circle cx="12" cy="12" r="3" /></>
            };
            return <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name] || null}</svg>;
        };

        const conditionLabels = { westSun: 'è¥¿æ›¬', allDaySun: 'å…¨æ—¥æ›¬', topFloor: 'é ‚æ¨“', highCeiling: 'æŒ‘é«˜', ironSheet: 'éµçš®', blackIron: 'é»‘éµçš®' };

        // --- 2. å„å€‹åŠŸèƒ½å­å…ƒä»¶ ---

        const SpecModal = ({ group, onClose }) => {
            if (!group || !group.variants) return null;
            const [selectedVariant, setSelectedVariant] = useState(group.variants[0]);
            
            return (
                <div className="fixed inset-0 z-[300] flex items-center justify-center p-2 animate-fade-in">
                    <div className="absolute inset-0 bg-black/90 backdrop-blur-md" onClick={onClose}></div>
                    <div className="bg-industrial-900 w-full max-w-2xl h-[90vh] rounded-xl border border-industrial-700 shadow-2xl flex flex-col relative z-10 overflow-hidden animate-zoom-in">
                        <div className="bg-industrial-800 p-4 border-b border-industrial-700 flex justify-between items-center shrink-0">
                            <div>
                                <h3 className="text-xl font-bold text-white tracking-wide">{group.brandCN} {group.series}</h3>
                                <div className="flex gap-2 mt-1 flex-wrap">
                                    {group.variants.map((v, idx) => (
                                        <button key={idx} onClick={() => setSelectedVariant(v)} className={`text-[11px] px-2 py-0.5 rounded border transition-colors ${selectedVariant === v ? 'bg-industrial-700 text-white border-industrial-500' : 'bg-transparent text-gray-500 border-transparent hover:bg-industrial-800'}`}>{v.func}å‹ ({v.modelIdu})</button>
                                    ))}
                                </div>
                            </div>
                            <button onClick={onClose} className="p-2 bg-industrial-700 hover:bg-industrial-600 rounded-full transition-colors text-white"><Icon name="x" className="w-5 h-5" /></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 custom-scroll">
                            <div className="flex gap-2 mb-4 flex-wrap">
                                <div className="bg-blue-900/30 border border-blue-800 rounded px-3 py-1 text-xs text-blue-300">å†·æˆ¿èƒ½åŠ›: {selectedVariant.maxKw} kW</div>
                                <div className="bg-green-900/30 border border-green-800 rounded px-3 py-1 text-xs text-green-300">CSPF: {selectedVariant.cspf || '-'} kWh/kWh</div>
                                <div className="bg-purple-900/30 border border-purple-800 rounded px-3 py-1 text-xs text-purple-300">å†·åª’: {selectedVariant.refrigerant}</div>
                            </div>
                            <table className="spec-table">
                                <tbody>
                                    <tr><th colSpan="2" className="text-center bg-gray-800 text-white">åŸºæœ¬è¦æ ¼</th></tr>
                                    <tr><th>å®¤å…§æ©Ÿå‹è™Ÿ</th><td>{selectedVariant.modelIdu}</td></tr>
                                    <tr><th>å®¤å¤–æ©Ÿå‹è™Ÿ</th><td>{selectedVariant.modelOdu}</td></tr>
                                    <tr><th>é›»æºè¦æ ¼</th><td>{selectedVariant.odu?.power || '220V'}</td></tr>
                                    <tr><th>æ§åˆ¶é…ç·š</th><td>{selectedVariant.odu?.signalWire || '-'}</td></tr>
                                    <tr><th>é›»æºé…ç·š</th><td>{selectedVariant.odu?.powerWire || '-'}</td></tr>
                                    <tr><th colSpan="2" className="text-center bg-gray-800 text-white">å®¤å…§æ©Ÿè¦æ ¼ (IDU)</th></tr>
                                    <tr><th>å¤–è§€å°ºå¯¸ (å¯¬xé«˜xæ·±)</th><td>{selectedVariant.idu?.dims} mm</td></tr>
                                    <tr><th>æ©Ÿå™¨æ·¨é‡ (Weight)</th><td className="text-green-400 font-bold">{selectedVariant.idu?.weight || '-'} kg</td></tr>
                                    <tr><th>å™ªéŸ³å€¼ (dB)</th><td>{selectedVariant.idu?.noise || '-'}</td></tr>
                                    <tr><th>é¢¨é‡ç‰¹æ€§</th><td>{selectedVariant.idu?.airflow || '-'}</td></tr>
                                    <tr><th colSpan="2" className="text-center bg-gray-800 text-white">å®¤å¤–æ©Ÿè¦æ ¼ (ODU)</th></tr>
                                    <tr><th>å¤–è§€å°ºå¯¸ (å¯¬xé«˜xæ·±)</th><td>{selectedVariant.odu?.dims} mm</td></tr>
                                    <tr><th>æ©Ÿå™¨æ·¨é‡ (Weight)</th><td className="text-green-400 font-bold">{selectedVariant.odu?.weight || '-'} kg</td></tr>
                                    <tr><th>è…³åº§å­”è· (å¯¬xæ·±)</th><td className="text-yellow-400">{selectedVariant.odu?.footSpacing || '-'} mm</td></tr>
                                    <tr><th>é‹è½‰é›»æµ (å†·/æš–)</th><td>{selectedVariant.odu?.currentCool || '-'}/{selectedVariant.odu?.currentHeat || '-'}</td></tr>
                                    <tr><th>æœ€å¤§é›»æµ</th><td className="text-red-400 font-bold">{selectedVariant.odu?.currentMax || '-'}</td></tr>
                                    <tr><th colSpan="2" className="text-center bg-gray-800 text-white">é…ç®¡è³‡è¨Š</th></tr>
                                    <tr><th>æ¶²ç®¡ / æ°£ç®¡</th><td className="text-yellow-400 font-bold">{selectedVariant.pipes}</td></tr>
                                    <tr><th>æœ€å¤§é…ç®¡é•·åº¦</th><td>20m (åƒè€ƒå€¼)</td></tr>
                                    <tr><th>æœ€å¤§é«˜ä½å·®</th><td>10m (åƒè€ƒå€¼)</td></tr>
                                    <tr><th>è£œå……å†·åª’é‡</th><td>20g/m (è¶…éåŸºæº–å¾Œ)</td></tr>
                                </tbody>
                            </table>
                            <div className="mt-4 text-[10px] text-gray-500 text-center">* è³‡æ–™åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›å®‰è£è«‹ä»¥æ©Ÿå™¨éŠ˜æ¿æˆ–åŸå» æœ€æ–°æŠ€è¡“æ‰‹å†Šç‚ºæº–ã€‚</div>
                        </div>
                    </div>
                </div>
            );
        };

        const HistoryModal = ({ item, onClose, onOpenSpec }) => {
            if (!item) return null;
            const data = item.data;

            const renderContent = () => {
                switch (item.type) {
                    case 'capacity_multi':
                        return (
                             <div className="space-y-4">
                                 <div className="grid grid-cols-2 gap-4 text-white mb-4 border-b border-industrial-700 pb-4">
                                     <div className="text-center font-mono border-r border-industrial-700">
                                         <div className="text-gray-500 text-[10px] mb-1 font-bold">ç³»çµ±ç¸½è² è¼‰</div>
                                         <div className="text-3xl font-bold text-yellow-400">{data.totalKw} <span className="text-xs text-yellow-600 font-sans">KW</span></div>
                                     </div>
                                     <div className="text-center font-mono">
                                         <div className="text-gray-500 text-[10px] mb-1 font-bold">è¦åŠƒç©ºé–“</div>
                                         <div className="text-3xl font-bold">{data.roomCount} <span className="text-xs text-gray-500 font-sans">é–“</span></div>
                                     </div>
                                 </div>
                                 {data.pref === 'multi' && data.roomCount > 1 && (
                                     <div className="mb-4">
                                         <h3 className="text-[10px] text-purple-400 font-bold mb-2 uppercase tracking-widest flex items-center gap-1"><Icon name="check" className="w-3 h-3"/> ä¸€å°å¤šå®¤å¤–æ©Ÿæ¨è–¦é…å°</h3>
                                         {data.recommendedODU ? (
                                             <div className="bg-purple-900/20 p-3 rounded-xl border border-purple-900/50 shadow-inner">
                                                 <div className="text-white font-bold text-sm mb-1">{data.recommendedODU.brandCN} {data.recommendedODU.modelOdu}</div>
                                                 <div className="text-[10px] text-gray-400 flex flex-col gap-1 mt-2">
                                                     <span><strong className="text-purple-300">æ”¯æ´å½¢å¼:</strong> æœ€å¤§æ”¯æ´ {data.recommendedODU.maxIdus} å…§æ©Ÿ</span>
                                                     <span><strong className="text-purple-300">èƒ½åŠ›ä¸Šé™:</strong> {data.recommendedODU.maxKw} KW</span>
                                                 </div>
                                             </div>
                                         ) : (
                                             <div className="bg-industrial-800 p-3 rounded-xl border border-industrial-700 text-xs text-gray-400">è³‡æ–™åº«ä¸­å°šç„¡é©åˆæ©Ÿå‹</div>
                                         )}
                                     </div>
                                 )}
                                 <div>
                                     <h3 className="text-[10px] text-gray-500 font-bold mb-2 uppercase tracking-widest border-t border-industrial-700 pt-3">ç©ºé–“æ˜ç´°</h3>
                                     <div className="space-y-2">
                                         {data.roomData.map((r, idx) => (
                                             <div key={idx} className="bg-industrial-950 p-3 rounded-lg border border-industrial-800 relative overflow-hidden">
                                                 <div className="absolute top-0 left-0 w-1 h-full bg-green-500 opacity-50"></div>
                                                 <div className="flex justify-between items-center mb-1 pl-2">
                                                     <span className="text-gray-200 font-bold text-sm">{r.name} <span className="text-[10px] text-gray-500 font-normal ml-1">({r.ping}åª)</span></span>
                                                     <span className="font-mono font-bold text-yellow-500 text-sm">{r.kw} KW</span>
                                                 </div>
                                                 <div className="text-[10px] text-gray-400 mb-2 pl-2">é¸æ“‡å‹å¼: <span className="text-green-400 font-bold">{r.iduType}</span></div>
                                                 <div className="mt-2 pt-2 border-t border-industrial-800 text-[10px] pl-2">
                                                     {data.pref === 'single' ? (
                                                         r.matchedSingle ? <span className="text-blue-300">æ¨è–¦: {r.matchedSingle.modelIdu}</span> : <span className="text-red-400">ç„¡åˆé©æ©Ÿå‹</span>
                                                     ) : (
                                                         r.matchedIdu ? <span className="text-green-300">æ¨è–¦: {r.matchedIdu.modelIdu}</span> : <span className="text-red-400">ç„¡åˆé©æ©Ÿå‹</span>
                                                     )}
                                                 </div>
                                             </div>
                                         ))}
                                     </div>
                                 </div>
                             </div>
                        );
                    case 'calc':
                         return (
                             <div className="text-center">
                                 <div className="mb-4">
                                     <span className="block text-gray-500 text-[10px] mb-1 uppercase font-bold tracking-widest">è¨ˆç®—æ¢ä»¶</span>
                                     <div className="text-xs text-gray-400">åŸºæº–: {data.baseLen}m | ç¸½é•·: {data.totalLen}m</div>
                                 </div>
                                 <span className="block text-gray-500 text-[10px] mb-1 uppercase font-bold tracking-widest">å»ºè­°è£œå……é‡</span>
                                 <div className="text-4xl font-mono font-bold text-green-400">{data.result} <span className="text-sm">g</span></div>
                             </div>
                         );
                    case 'cooling':
                        return (
                             <div className="text-center">
                                 <div className="grid grid-cols-2 gap-2 mb-4 text-xs text-gray-400">
                                     <div className="bg-industrial-950 p-2 rounded">åªæ•¸: {data.ping}åª</div>
                                     <div className="bg-industrial-950 p-2 rounded">èƒ½åŠ›: {data.acKw}KW</div>
                                     <div className="bg-industrial-950 p-2 rounded">å®¤æº«: {data.currentTemp}Â°C</div>
                                     <div className="bg-industrial-950 p-2 rounded">ç›®æ¨™: {data.targetTemp}Â°C</div>
                                 </div>
                                 <span className="block text-gray-500 text-[10px] mb-1 uppercase font-bold tracking-widest">é è¨ˆé™æº«è€—æ™‚</span>
                                 <div className="text-5xl font-mono font-bold text-purple-400 my-2">{data.minutes} <span className="text-sm font-sans text-gray-400 uppercase">min</span></div>
                             </div>
                        );
                    case 'ducted':
                        return (
                             <div className="space-y-4">
                                 {data.splitConfig ? (
                                     <div className="flex flex-col gap-3">
                                         <div className="bg-industrial-950 p-3 rounded-xl border border-industrial-700 flex justify-between items-center"><div><div className="text-[10px] text-blue-300 font-bold uppercase tracking-wider mb-1">ä¸»æ©Ÿç«¯</div></div><div className="text-right"><div className="text-xl font-mono font-bold text-blue-400">{data.mainQty}å­” Ã— {data.mainSize}å‹</div></div></div>
                                         <div className="flex justify-center -my-2 z-10 text-gray-500"><Icon name="git-merge" className="w-5 h-5 rotate-180 bg-industrial-900 rounded-full" /></div>
                                         <div className="bg-industrial-950 p-3 rounded-xl border border-green-900/50 flex justify-between items-center"><div><div className="text-[10px] text-green-400 font-bold uppercase tracking-wider mb-1">æœ«ç«¯</div></div><div className="text-right"><div className="text-xl font-mono font-bold text-green-400">{data.splitConfig.qty}å‡ºé¢¨å£ Ã— {data.splitConfig.size}å‹</div></div></div>
                                     </div>
                                 ) : (
                                     <div className="grid grid-cols-2 gap-4 text-white">
                                         <div className="text-center border-r border-industrial-700 font-mono"><div className="text-gray-500 text-[10px] mb-1 font-bold">ä¸»æ©Ÿç«¯å‡ºé¢¨</div><div className="text-3xl font-bold">{data.mainQty} <span className="text-xs text-blue-500 font-sans">å­”</span></div></div>
                                         <div className="text-center font-mono"><div className="text-gray-500 text-[10px] mb-1 font-bold">å­”å¾‘</div><div className="text-3xl font-bold">{data.mainSize} <span className="text-xs text-blue-500 font-sans">å‹</span></div></div>
                                     </div>
                                 )}
                                 <div className="bg-industrial-950 p-3 rounded-xl text-[11px] leading-relaxed text-gray-300 border border-industrial-700/50 mt-4"><span style={{ whiteSpace: "pre-wrap" }}>{data.airflowNote}</span></div>
                             </div>
                        );
                    case 'search':
                        return (
                            <div className="space-y-2">
                                <div className="text-[10px] text-gray-500 mb-2">é»æ“Šå¡ç‰‡æŸ¥çœ‹è©³ç´°è¦æ ¼</div>
                                {data.results.map((g, i) => <ResultCard key={i} group={g} onClick={() => onOpenSpec(g)} />)}
                            </div>
                        );
                    default:
                        return <div className="text-gray-500 text-center">ç„¡æ³•é¡¯ç¤ºæ­¤é¡å‹çš„ç´€éŒ„</div>;
                }
            };

            return (
                <div className="fixed inset-0 z-[300] flex items-center justify-center p-4 animate-fade-in">
                    <div className="absolute inset-0 bg-black/90 backdrop-blur-md" onClick={onClose}></div>
                    <div className="bg-industrial-900 w-full max-w-lg max-h-[85vh] rounded-xl border border-industrial-700 shadow-2xl flex flex-col relative z-10 overflow-hidden animate-zoom-in">
                        <div className="bg-industrial-800 p-4 border-b border-industrial-700 flex justify-between items-center shrink-0">
                            <h3 className="text-lg font-bold text-white tracking-wide truncate pr-4">{item.title}</h3>
                            <button onClick={onClose} className="p-2 bg-industrial-700 hover:bg-industrial-600 rounded-full transition-colors text-white"><Icon name="x" className="w-5 h-5" /></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-5 custom-scroll">
                            {renderContent()}
                            <div className="mt-6 pt-4 border-t border-industrial-800 text-[10px] text-gray-500 text-center">
                                ç´€éŒ„æ™‚é–“: {item.date}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const FilterSelect = ({ label, value, options, onChange, disabled }) => (
            <div className={`relative ${disabled ? 'opacity-50' : ''}`}>
                <span className="absolute -top-2 left-2 bg-industrial-800 px-1 text-[10px] text-industrial-accent font-bold tracking-widest z-10 pointer-events-none">{label}</span>
                <div className="relative">
                    <select value={value} onChange={e => onChange(e.target.value)} disabled={disabled} className="w-full appearance-none bg-industrial-900 border border-industrial-700 rounded-lg pl-3 pr-8 py-2.5 text-sm text-white focus:border-industrial-accent outline-none transition-all cursor-pointer disabled:cursor-not-allowed">
                        {options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                    </select>
                    <div className="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none text-gray-500"><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg></div>
                </div>
            </div>
        );

        const ResultCard = ({ group, onClick }) => {
            if (!group || !group.variants) return null; 

            const firstItem = group.variants[0];
            const hasHeat = group.variants.some(v => v.func === 'å†·æš–');
            const hasCoolOnly = group.variants.some(v => v.func === 'å†·å°ˆ');
            
            let barColor = 'bg-gray-600';
            if (hasHeat && !hasCoolOnly) barColor = 'bg-heat-500';
            else if (!hasHeat && hasCoolOnly) barColor = 'bg-cool-500';
            else if (hasHeat && hasCoolOnly) barColor = 'bg-gradient-to-b from-heat-500 to-cool-500';

            return (
                <div onClick={onClick} className="bg-industrial-800 rounded-xl p-4 border border-industrial-700 shadow-lg mb-3 relative overflow-hidden cursor-pointer hover:border-industrial-500 hover:bg-industrial-700 transition-all group">
                    <div className={`absolute top-0 left-0 w-1.5 h-full ${barColor}`}></div>
                    <div className="pl-3 flex justify-between items-center">
                        <div>
                            <div className="flex items-center gap-2 mb-1">
                                <span className="text-[10px] font-bold text-industrial-accent bg-industrial-950 px-2 py-0.5 rounded">{group.brandCN}</span>
                                {group.series && <span className="text-[10px] text-gray-400 border border-industrial-600 px-1.5 py-0.5 rounded">{group.series}</span>}
                            </div>
                            <div className="text-lg font-bold text-white tracking-wide group-hover:text-industrial-accent transition-colors">{firstItem.modelIdu} <span className="text-xs text-gray-500 ml-2 font-normal">({group.variants.length > 1 ? 'ç³»åˆ—' : firstItem.func})</span></div>
                            <div className="text-xs text-gray-400 mt-1 font-mono">{group.maxKw} kW | {group.pipes} | {group.refrigerant}</div>
                        </div>
                        <div className="flex flex-col items-end gap-2">
                             <div className="flex gap-1">
                                {hasHeat && <span className="w-2 h-2 rounded-full bg-heat-500" title="æœ‰å†·æš–"></span>}
                                {hasCoolOnly && <span className="w-2 h-2 rounded-full bg-cool-500" title="æœ‰å†·å°ˆ"></span>}
                            </div>
                            <button className="bg-industrial-900 hover:bg-blue-600 text-blue-400 hover:text-white border border-blue-900/50 rounded-lg px-3 py-1.5 text-xs font-bold flex items-center gap-1 transition-all"><Icon name="eye" className="w-3 h-3" />è¦æ ¼è©³æƒ…</button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const SidebarBtn = ({ active, onClick, icon, label }) => (
            <button onClick={onClick} className={`flex items-center gap-4 w-full text-left px-4 py-3.5 rounded-xl transition-all ${active ? 'bg-industrial-800 border border-industrial-700 text-industrial-accent font-bold' : 'text-gray-400 hover:bg-industrial-800 hover:text-white'}`}><Icon name={icon} className="w-5 h-5" /><span className="text-sm tracking-widest">{label}</span></button>
        );

        const MultiRoomCapacityCalculator = ({ rooms, setRooms, systemPref, setSystemPref, result, setResult, addToHistory, db }) => {
            const [error, setError] = useState('');
            const addRoom = () => { if (rooms.length >= 6) { setError('æœ€å¤šæ”¯æ´åŒæ™‚è©•ä¼° 6 å€‹ç©ºé–“'); return; } setError(''); setRooms([...rooms, { id: Date.now(), name: `ç©ºé–“ ${rooms.length + 1}`, ping: '', conditions: {}, kw: 0, iduType: 'å£æ›å¼', matchedSingle: null, matchedIdu: null }]); };
            const removeRoom = (id) => { setRooms(rooms.filter(r => r.id !== id)); };
            const updateRoom = (id, field, value) => { setRooms(rooms.map(r => r.id === id ? { ...r, [field]: value } : r)); };
            const toggleCondition = (id, conditionKey) => { setRooms(rooms.map(r => { if (r.id !== id) return r; const nextConds = { ...r.conditions, [conditionKey]: !r.conditions[conditionKey] }; if (conditionKey === 'blackIron' && nextConds.blackIron) nextConds.ironSheet = false; if (conditionKey === 'ironSheet' && nextConds.ironSheet) nextConds.blackIron = false; return { ...r, conditions: nextConds }; })); };
            const calculateAll = () => {
                let hasError = false; let totalKw = 0;
                const calculatedRooms = rooms.map(r => {
                    const p = parseFloat(r.ping); if (!p || p <= 0) { hasError = true; return r; }
                    let kcalBase = 450, mult = 1.0;
                    if (r.conditions.westSun) mult += 0.2; if (r.conditions.allDaySun) mult += 0.3; if (r.conditions.topFloor) mult += 0.2; if (r.conditions.highCeiling) mult += 0.2;
                    if (r.conditions.blackIron) mult += 0.8; else if (r.conditions.ironSheet) mult += 0.5;
                    const roomKw = parseFloat(((kcalBase * mult * p) / 860).toFixed(2)); totalKw += roomKw;
                    return { ...r, kw: roomKw, matchedSingle: null, matchedIdu: null };
                });
                if (hasError) { setError('è«‹ç¢ºèªæ‰€æœ‰ç©ºé–“çš†å·²è¼¸å…¥æœ‰æ•ˆåªæ•¸'); return; } setError(''); totalKw = parseFloat(totalKw.toFixed(2));
                let recommendedODU = null;
                if (systemPref === 'multi' && calculatedRooms.length > 1) {
                    const matches = db.filter(item => item.isMulti === true && item.maxKw >= totalKw && (item.maxIdus || 2) >= calculatedRooms.length);
                    if (matches.length > 0) { matches.sort((a, b) => a.maxKw - b.maxKw); recommendedODU = matches[0]; }
                }
                const finalRooms = calculatedRooms.map(r => {
                    if (systemPref === 'single') {
                        const matches = db.filter(item => item.isMulti === false && item.odu !== null && item.idu !== null && item.type === r.iduType && item.maxKw >= r.kw);
                        if (matches.length > 0) { matches.sort((a, b) => a.maxKw - b.maxKw); r.matchedSingle = matches[0]; }
                    } else {
                        let matches = db.filter(item => item.idu !== null && item.type === r.iduType && item.maxKw >= r.kw);
                        if (recommendedODU) { const brandMatches = matches.filter(i => i.brandCN === recommendedODU.brandCN); if (brandMatches.length > 0) matches = brandMatches; }
                        if (matches.length > 0) { matches.sort((a, b) => a.maxKw - b.maxKw); r.matchedIdu = matches[0]; }
                    }
                    return r;
                });
                setRooms(finalRooms); const resData = { pref: systemPref, totalKw, roomCount: finalRooms.length, recommendedODU, roomData: finalRooms };
                setResult(resData); addToHistory(`å…¨å±‹è¦åŠƒ: ${finalRooms.length}é–“ / ${totalKw}KW`, 'capacity_multi', resData);
            };
            return (
                <div className="animate-fade-in pb-10">
                    <div className="flex justify-between items-center mb-4 text-white"><h2 className="text-yellow-400 font-bold flex items-center gap-2 text-sm"><Icon name="ruler" className="w-5 h-5" /> å¤šé–“è² è¼‰èˆ‡å¤–æ©Ÿé…ç½®</h2><button onClick={addRoom} className="text-[10px] bg-industrial-800 hover:bg-industrial-700 text-white px-3 py-1.5 rounded border border-industrial-600 flex items-center gap-1"><Icon name="plus" className="w-3 h-3"/> æ–°å¢ç©ºé–“</button></div>
                    {error && <div className="text-red-400 text-xs font-bold mb-3 text-center bg-red-900/20 py-2 rounded-lg">{error}</div>}
                    <div className="mb-4 bg-industrial-950 p-1.5 rounded-xl border border-industrial-800"><label className="text-[10px] text-gray-500 mb-2 block font-bold text-center uppercase tracking-widest">ç³»çµ±é…ç½®åå¥½</label><div className="flex text-xs font-bold gap-2"><button onClick={() => {setSystemPref('single'); setResult(null);}} className={`flex-1 py-3 rounded-lg transition-all ${systemPref === 'single' ? 'bg-blue-600 text-white shadow-md' : 'bg-industrial-900 text-gray-500 border border-industrial-700'}`}>ä¸€å°ä¸€ç¨ç«‹é…ç½®</button><button onClick={() => {setSystemPref('multi'); setResult(null);}} className={`flex-1 py-3 rounded-lg transition-all ${systemPref === 'multi' ? 'bg-purple-600 text-white shadow-md' : 'bg-industrial-900 text-gray-500 border border-industrial-700'}`}>ä¸€å°å¤šå…±ç”¨å¤–æ©Ÿ</button></div></div>
                    <div className="space-y-4 mb-6">{rooms.map((room) => (<div key={room.id} className="bg-industrial-800 p-4 rounded-xl border border-industrial-700 shadow-sm relative">{rooms.length > 1 && (<button onClick={() => removeRoom(room.id)} className="absolute top-3 right-3 text-gray-500 hover:text-red-400"><Icon name="x" className="w-4 h-4" /></button>)}<div className="flex gap-2 mb-3 pr-6"><input type="text" value={room.name} onChange={e => updateRoom(room.id, 'name', e.target.value)} className="bg-transparent border-b border-industrial-600 text-industrial-accent font-bold w-1/3 text-sm focus:border-yellow-500" placeholder="ç©ºé–“åç¨±" /><div className="flex items-center gap-2 w-2/3"><input type="number" value={room.ping} onChange={e => updateRoom(room.id, 'ping', e.target.value)} className="w-full bg-industrial-900 border border-industrial-700 rounded-lg py-1.5 px-3 text-white text-sm" placeholder="è¼¸å…¥åªæ•¸" /><span className="text-xs text-gray-500">åª</span></div></div><div className="flex gap-2 mb-3">{['å£æ›å¼', 'åŠéš±å¼', 'ç›´ç«‹å¼'].map(type => (<button key={type} onClick={() => updateRoom(room.id, 'iduType', type)} className={`text-[10px] px-3 py-1.5 rounded-md font-bold transition-all border ${room.iduType === type ? 'bg-green-700/80 text-white border-green-500' : 'bg-industrial-900 text-gray-500 border-industrial-700'}`}>{type}</button>))}</div><div className="flex flex-wrap gap-2">{Object.entries(conditionLabels).map(([k, l]) => (<label key={k} className={`flex items-center space-x-1 bg-industrial-900 px-2 py-1 rounded border border-industrial-700 cursor-pointer text-[10px] ${room.conditions[k] ? 'border-industrial-accent text-industrial-accent' : 'text-gray-400'}`}><input type="checkbox" checked={!!room.conditions[k]} onChange={() => toggleCondition(room.id, k)} className="hidden" /><span>{l}</span></label>))}</div>{room.kw > 0 && <div className="absolute bottom-3 right-3 text-yellow-400 font-mono text-sm font-bold">{room.kw} KW</div>}</div>))}</div>
                    <button onClick={calculateAll} className="w-full py-4 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm flex items-center justify-center gap-2"><Icon name="zap" className="w-4 h-4"/> ç”¢ç”Ÿå®Œæ•´æ©Ÿå‹é…ç½®</button>
                    {result && (
                        <div className="mt-6 bg-industrial-900 rounded-2xl p-5 border border-yellow-600/50 animate-slide-up shadow-2xl relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-yellow-600"></div>
                             <div className="grid grid-cols-2 gap-4 text-white mb-4 border-b border-industrial-700 pb-4"><div className="text-center font-mono border-r border-industrial-700"><div className="text-gray-500 text-[10px] mb-1 font-bold">ç³»çµ±ç¸½è² è¼‰</div><div className="text-3xl font-bold text-yellow-400">{result.totalKw} <span className="text-xs text-yellow-600 font-sans">KW</span></div></div><div className="text-center font-mono"><div className="text-gray-500 text-[10px] mb-1 font-bold">è¦åŠƒç©ºé–“</div><div className="text-3xl font-bold">{result.roomCount} <span className="text-xs text-gray-500 font-sans">é–“</span></div></div></div>
                             {result.pref === 'multi' && result.roomCount > 1 && (<div className="mb-4"><h3 className="text-[10px] text-purple-400 font-bold mb-2 uppercase tracking-widest flex items-center gap-1"><Icon name="check" className="w-3 h-3"/> ä¸€å°å¤šå®¤å¤–æ©Ÿæ¨è–¦é…å°</h3>{result.recommendedODU ? (<div className="bg-purple-900/20 p-3 rounded-xl border border-purple-900/50 shadow-inner"><div className="text-white font-bold text-sm mb-1">{result.recommendedODU.brandCN} {result.recommendedODU.modelOdu}</div><div className="text-[10px] text-gray-400 flex flex-col gap-1 mt-2"><span><strong className="text-purple-300">æ”¯æ´å½¢å¼:</strong> æœ€å¤§æ”¯æ´ {result.recommendedODU.maxIdus} å…§æ©Ÿ</span><span><strong className="text-purple-300">èƒ½åŠ›ä¸Šé™:</strong> {result.recommendedODU.maxKw} KW</span>{result.recommendedODU.odu && <span><strong className="text-purple-300">é›»æºç·šå»ºè­°:</strong> {result.recommendedODU.odu.powerWire}</span>}</div></div>) : (<div className="bg-industrial-800 p-3 rounded-xl border border-industrial-700 text-xs text-gray-400">* è³‡æ–™åº«ä¸­å°šç„¡å¯æ»¿è¶³ {result.totalKw} KW ä¸”æ”¯æ´ {result.roomCount} å°å¤šçš„æ©Ÿå‹ã€‚<br/>å»ºè­°åˆ†æµç‚ºå…©çµ„ç³»çµ±ï¼Œæˆ–åˆ‡æ›è‡³ã€Œä¸€å°ä¸€ç¨ç«‹é…ç½®ã€ã€‚</div>)}</div>)}
                             <div><h3 className="text-[10px] text-gray-500 font-bold mb-2 uppercase tracking-widest border-t border-industrial-700 pt-3">{result.pref === 'single' ? 'å„ç©ºé–“ä¸€å°ä¸€ç³»çµ±æ¨è–¦' : 'å„ç©ºé–“å°æ‡‰å…§æ©Ÿæ¨è–¦'}</h3><div className="space-y-2">{result.roomData.map(r => (<div key={`res-${r.id}`} className="bg-industrial-950 p-3 rounded-lg border border-industrial-800 relative overflow-hidden"><div className="absolute top-0 left-0 w-1 h-full bg-green-500 opacity-50"></div><div className="flex justify-between items-center mb-1 pl-2"><span className="text-gray-200 font-bold text-sm">{r.name} <span className="text-[10px] text-gray-500 font-normal ml-1">({r.ping}åª)</span></span><span className="font-mono font-bold text-yellow-500 text-sm">{r.kw} KW</span></div><div className="text-[10px] text-gray-400 mb-2 pl-2">é¸æ“‡å‹å¼: <span className="text-green-400 font-bold">{r.iduType}</span></div><div className="mt-2 pt-2 border-t border-industrial-800 text-[10px] pl-2">{result.pref === 'single' ? (r.matchedSingle ? (<div className="text-blue-300 font-bold">æ¨è–¦ä¸€å°ä¸€: <br/>{r.matchedSingle.brandCN} {r.matchedSingle.modelIdu} / {r.matchedSingle.modelOdu} <br/><span className="text-gray-500 font-normal block mt-0.5">èƒ½åŠ›ä¸Šé™ {r.matchedSingle.maxKw}KW</span></div>) : (<div className="text-red-400">æŸ¥ç„¡å°æ‡‰ä¹‹ {r.kw}KW ä»¥ä¸Š {r.iduType} æ©Ÿå‹</div>)) : (r.matchedIdu ? (<div className="text-green-300 font-bold">æ¨è–¦å¤šè¯å…§æ©Ÿ: <br/>{r.matchedIdu.brandCN} {r.matchedIdu.modelIdu} <br/><span className="text-gray-500 font-normal block mt-0.5">èƒ½åŠ›ä¸Šé™ {r.matchedIdu.maxKw}KW</span></div>) : (<div className="text-red-400">æŸ¥ç„¡å°æ‡‰ä¹‹ {r.kw}KW ä»¥ä¸Šå¤šè¯ {r.iduType} å…§æ©Ÿ</div>))}</div></div>))}</div></div>
                        </div>
                    )}
                </div>
            );
        };

        const RefrigerantCalculator = ({ state, setState, addToHistory }) => {
            const [error, setError] = useState('');
            const calculate = () => {
                const total = parseFloat(state.totalLen); if (isNaN(total) || total < 0) { setError('è«‹è¼¸å…¥å¯¦éš›æ–½å·¥ç¸½ç®¡é•·'); return; } setError('');
                const res = Math.max(0, Math.round((total - state.baseLen) * state.gramPerMeter));
                setState(p=>({...p, result: res})); addToHistory(`è£œå†·åª’: ${res}g / ${total}m`, 'calc', { baseLen: state.baseLen, totalLen: total, result: res });
            };
            return (
                <div className="animate-fade-in space-y-4 pb-10">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl"><div className="flex justify-between items-center mb-4 text-white"><h2 className="text-green-400 font-bold flex items-center gap-2 text-sm"><Icon name="calculator" className="w-4 h-4" /> å†·åª’è£œå¡«é‡è¨ˆç®—</h2><button onClick={()=>{setState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null }); setError('');}} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button></div><div className="mb-5 bg-industrial-950 p-3 rounded-xl border border-industrial-800 text-[11px] text-gray-300 leading-relaxed"><div className="text-green-500 font-bold mb-1 flex items-center gap-1"><Icon name="check" className="w-3 h-3"/> æ¥­ç•Œå†·åª’è¿½åŠ æ¨™æº–åƒè€ƒ (ä»¥R32/R410Aç‚ºä¾‹)</div><ul className="list-disc pl-4 space-y-1 text-gray-400"><li><strong className="text-gray-300">å…å……å¡«é•·åº¦ï¼š</strong>ä¸€å°ä¸€å¸¸ç‚º <span className="text-blue-300">5~10ç±³</span>ã€‚ä¸€å°å¤šå¸¸ç‚º <span className="text-blue-300">30~40ç±³</span>ã€‚</li><li><strong className="text-gray-300">æ¶²ç®¡ 2åˆ† (6.35mm)ï¼š</strong>æ¯ç±³è¿½åŠ  <span className="text-yellow-400 font-bold">20g</span>ã€‚</li><li><strong className="text-gray-300">æ¶²ç®¡ 3åˆ† (9.52mm)ï¼š</strong>æ¯ç±³è¿½åŠ  <span className="text-yellow-400 font-bold">50g</span>ã€‚</li><li><strong className="text-gray-300">æ¶²ç®¡ 4åˆ† (12.7mm)ï¼š</strong>æ¯ç±³è¿½åŠ  <span className="text-yellow-400 font-bold">90g</span>ã€‚</li></ul></div>{error && <div className="text-red-400 text-xs font-bold mb-3 text-center bg-red-900/20 py-2 rounded-lg">{error}</div>}<div className="space-y-5"><div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">åŸå» åŸºæº–é•·åº¦ (m)</label><div className="grid grid-cols-4 gap-2">{[5, 7.5, 10, 30].map(l => (<button key={l} onClick={()=>setState(p=>({...p, baseLen:l}))} className={`py-2 rounded-xl text-xs font-bold border transition-all ${state.baseLen===l ? 'bg-green-600 border-green-500 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{l}m</button>))}</div></div><div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">æ¯ç±³è£œå……é‡ (g/m) <span className="normal-case font-normal ml-1 text-[9px] text-blue-400">â€»è«‹ä¾æ¶²ç®¡å¤§å°é¸æ“‡</span></label><div className="grid grid-cols-4 gap-2">{[15, 20, 50, 90].map(v => (<button key={v} onClick={()=>setState(p=>({...p, gramPerMeter:v}))} className={`py-2 rounded-xl text-xs font-bold border transition-all ${state.gramPerMeter===v ? 'bg-green-600 border-green-500 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{v}g</button>))}</div></div><div><label className="text-[10px] text-gray-500 mb-2 block font-bold text-center uppercase tracking-widest">å¯¦éš›æ–½å·¥ç¸½ç®¡é•· (m)</label><input type="number" value={state.totalLen} onChange={e=>setState(p=>({...p, totalLen:e.target.value}))} className="w-full text-3xl py-4 bg-industrial-900 border-2 border-industrial-700 focus:border-green-500 rounded-2xl text-center text-white font-mono shadow-inner" placeholder="0" /></div><button onClick={calculate} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm flex items-center justify-center gap-2"><Icon name="calculator" className="w-4 h-4" /> é–‹å§‹è¨ˆç®—è£œå……é‡</button></div>{state.result !== null && (<div className="mt-6 bg-industrial-900 rounded-2xl p-4 border border-green-600/30 text-center animate-fade-in"><span className="block text-gray-500 text-[10px] mb-1 uppercase font-bold tracking-widest">å»ºè­°è£œå……é‡</span><div className="text-4xl font-mono font-bold text-green-400">{state.result} <span className="text-sm">g</span></div></div>)}</div></div>
            );
        };

        const CoolingTimeCalculator = ({ state, setState, addToHistory }) => {
            const [error, setError] = useState('');
            const calculate = () => {
                const { ping, height, currentTemp, targetTemp, acKw } = state; const p = parseFloat(ping), h = parseFloat(height), kw = parseFloat(acKw), ct = parseFloat(currentTemp), tt = parseFloat(targetTemp); const dt = ct - tt;
                if (!p || !kw || isNaN(dt) || dt <= 0) { setError('è«‹ç¢ºèªæ•¸å€¼å®Œæ•´ï¼ˆç›®æ¨™æº«åº¦éœ€ä½æ–¼å®¤æº«ï¼‰'); return; } setError('');
                const time = Math.round(((p * 3.3 * h) * 1.2 * 1.0 * dt * 10) / kw / 60);
                setState(pS => ({...pS, minutes: time})); addToHistory(`é™æº«ä¼°ç®—: ${time} åˆ†é˜`, 'cooling', { ping: p, height: h, acKw: kw, minutes: time, currentTemp: ct, targetTemp: tt });
            };
            return (
                <div className="animate-fade-in space-y-4"><div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl"><div className="flex justify-between items-center mb-4 text-white"><h2 className="text-purple-400 font-bold flex items-center gap-2 text-sm"><Icon name="thermometer" className="w-4 h-4" /> ç‰©ç†é™æº«æ¨¡æ“¬</h2><button onClick={()=>{setState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null }); setError('');}} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button></div>{error && <div className="text-red-400 text-xs font-bold mb-3 text-center bg-red-900/20 py-2 rounded-lg">{error}</div>}<div className="grid grid-cols-2 gap-3 mb-4"><div className="relative"><span className="absolute left-3 top-0 text-[8px] text-gray-500 uppercase font-bold">åªæ•¸ Area</span><input type="number" value={state.ping} onChange={e=>setState(p=>({...p, ping:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div><div className="relative"><span className="absolute left-3 top-0 text-[8px] text-gray-500 uppercase font-bold">é«˜åº¦ Height</span><input type="number" value={state.height} onChange={e=>setState(p=>({...p, height:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div></div><div className="grid grid-cols-2 gap-3 mb-6"><div className="relative"><span className="absolute left-3 top-0 text-[8px] text-red-500 uppercase font-bold">å®¤æº« Â°C</span><input type="number" value={state.currentTemp} onChange={e=>setState(p=>({...p, currentTemp:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-red-300 text-sm" /></div><div className="relative"><span className="absolute left-3 top-0 text-[8px] text-blue-500 uppercase font-bold">ç›®æ¨™ Â°C</span><input type="number" value={state.targetTemp} onChange={e=>setState(p=>({...p, targetTemp:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-blue-300 text-sm" /></div></div><div className="mb-6"><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest text-center">å†·æ°£åˆ¶å†·èƒ½åŠ› (KW)</label><input type="number" value={state.acKw} onChange={e=>setState(p=>({...p, acKw:e.target.value}))} className="w-full bg-industrial-900 border-2 border-industrial-700 focus:border-purple-500 rounded-2xl p-4 text-center text-white font-bold text-xl shadow-inner" placeholder="ä¾‹å¦‚: 3.6" /></div><button onClick={calculate} className="w-full py-4 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm">åŸ·è¡Œæ•¸æ“šæ¨¡æ“¬</button></div>{state.minutes !== null && (<div className="bg-industrial-900 rounded-2xl p-5 border border-purple-600/50 text-center animate-slide-up relative overflow-hidden"><div className="absolute top-0 left-0 w-full h-1 bg-purple-600"></div><div className="text-gray-500 text-[10px] uppercase font-bold tracking-widest">é è¨ˆé™æº«è€—æ™‚</div><div className="text-5xl font-mono font-bold text-purple-400 my-2">{state.minutes} <span className="text-sm font-sans text-gray-400 uppercase">min</span></div></div>)}</div>
            );
        };

        const DuctedCalculator = ({ state, setState, addToHistory }) => {
            const [error, setError] = useState('');
            const calculate = () => {
                const fw = parseFloat(state.flangeW), fh = parseFloat(state.flangeH), p = parseFloat(state.ping);
                const desiredOutlets = parseInt(state.outletCount);
                if (!fw || !fh || !p || !desiredOutlets) { setError('è«‹å®Œæ•´è¼¸å…¥æ‰€æœ‰é‡æ¸¬å°ºå¯¸èˆ‡è¦åŠƒåƒæ•¸'); return; }
                if (state.outletPos === null) { setError('è«‹é»é¸ä¹å®®æ ¼è¨­å®šé¢¨ç®¡èµ°å‘'); return; }
                setError('');

                const area = fw * fh; 
                const x1 = state.unitPos % 3, y1 = Math.floor(state.unitPos / 3);
                const x2 = state.outletPos % 3, y2 = Math.floor(state.outletPos / 3);
                const gridDist = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                const roomSide = Math.sqrt(p * 3.3058); 
                const estDist = (gridDist * (roomSide / 3)) + 1.5;

                const needHighPressure = (estDist >= 10 && p > 5);
                const area12 = 730; // 12è‹±å‹ç´„ç•¥é¢ç©
                const area10 = 490;
                const area8 = 314;

                let mainQty = 0, mainSize = 0, splitConfig = null, note = "";

                // æ–°å¢ 12è‹±å‹ é‚è¼¯
                if (!needHighPressure && area >= desiredOutlets * area12 && desiredOutlets >= 2) {
                    mainQty = desiredOutlets; mainSize = 12;
                    note = `æ³•è˜­é¢ç©éå¸¸å……è£• (${area}cmÂ²)ï¼Œå¯ç›´æ¥è£½ä½œ ${mainQty} å­” 12å‹ å¤§å‹é›†é¢¨ç®±ï¼Œé¢¨é‡èˆ‡éœéŸ³æ•ˆæœæœ€ä½³ã€‚`;
                } else if (!needHighPressure && area >= desiredOutlets * area10) {
                    mainQty = desiredOutlets; mainSize = 10;
                    note = `æ³•è˜­é¢ç©å……è¶³ (${area}cmÂ²)ï¼Œå¯ç›´æ¥æ–¼ä¸»æ©Ÿç«¯è£½ä½œ ${mainQty} å­” 10å‹ æ¨™æº–é›†é¢¨ç®±ã€‚`;
                } else if (area >= desiredOutlets * area8) {
                    mainQty = desiredOutlets; mainSize = 8;
                    if (needHighPressure) note = `é ä¼°é¢¨ç®¡é•·åº¦ç´„ ${estDist.toFixed(1)} ç±³ï¼Œéœ€åˆ‡æ›ç‚º 8 å‹ç³»çµ±ä»¥æé«˜éœå£“ã€‚\næ³•è˜­é¢ç©å¤ æ’ä¸‹ ${mainQty} å­” 8å‹ã€‚`;
                    else note = `æ³•è˜­é¢ç©ç„¡æ³•å®¹ç´ ${desiredOutlets} å­” 10å‹ï¼Œä½†å¯æ’ä¸‹ ${mainQty} å­” 8å‹ï¼\nå·²ç‚ºæ‚¨è‡ªå‹•é™ç®¡å¾‘ï¼Œç„¡é ˆä½¿ç”¨ä¸‰é€šã€‚`;
                } else {
                    mainSize = needHighPressure ? 8 : 10;
                    let holeArea = mainSize === 10 ? area10 : area8;
                    // å¦‚æœé‚„æ˜¯ä¸å¤ ï¼Œä¹Ÿå˜—è©¦ç”¨12å‹åšä¸»å¹¹
                    if (area >= area12 && desiredOutlets >= 3) { mainSize = 12; holeArea = area12; }
                    
                    mainQty = Math.floor(area / holeArea);
                    if (mainQty < 1) {
                        if (area >= area8) { mainSize = 8; mainQty = Math.floor(area / area8); } 
                        else { mainSize = 8; mainQty = 1; }
                    }
                    const splitRatio = desiredOutlets / mainQty;
                    const splitSize = mainSize / splitRatio; 
                    
                    // ä¿®æ­£ä¸‰é€šå¾Œå­”å¾‘é¡¯ç¤ºé‚è¼¯
                    let displaySplitSize = splitSize;
                    if (mainSize === 12 && splitRatio >= 2) displaySplitSize = 8; // 12è½‰å…©å€‹8
                    else if (mainSize === 10 && splitRatio >= 2) displaySplitSize = 6; // 10è½‰å…©å€‹6 (é€šå¸¸)

                    splitConfig = { qty: desiredOutlets, size: displaySplitSize.toFixed(1) };
                    note = `å—é™æ–¼æ³•è˜­é¢ç© (${area}cmÂ²)ï¼Œç„¡æ³•ç›´æ¥æ’ä¸‹ ${desiredOutlets} å­”ã€‚\nå»ºè­°ä¸»æ©Ÿç«¯å…ˆåš ${mainQty} å­” ${mainSize}å‹ï¼Œå»¶ä¼¸å¾ŒåŠ è£ä¸‰é€šè½‰ç‚º ${desiredOutlets} å€‹ ${displaySplitSize.toFixed(0)}~${displaySplitSize.toFixed(1)}å‹å‡ºé¢¨å£ã€‚`;
                    if (needHighPressure) note = `âš ï¸ é•·è·é›¢é€é¢¨ï¼Œä¸»æ©Ÿç«¯å·²å„ªå…ˆè€ƒé‡éœå£“è¨­å®šã€‚\n` + note;
                }

                if (p <= 4 && !needHighPressure && !splitConfig && mainSize === 10) note = "â„¹ï¸ å°åªæ•¸ç©ºé–“ï¼Œç¶­æŒæ¨™æº– 10 å‹å­”å¾‘ç¢ºä¿ä½é¢¨åˆ‡éŸ³ã€‚\n" + note;

                const res = { mainQty, mainSize, splitConfig, airflowNote: note, estDist: estDist.toFixed(1), flangeArea: area, desiredOutlets };
                setState(prev => ({ ...prev, result: res }));
                addToHistory(`åŠéš±è¦åŠƒ: ${desiredOutlets}å­”`, 'ducted', res);
            };

            const reset = () => { setState({ flangeW:'', flangeH:'', ping:'', outletCount: 2, unitPos:4, outletPos:null, result:null }); setError(''); };

            return (
                <div className="animate-fade-in space-y-4 pb-10">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl"><div className="flex justify-between items-center mb-6 text-white"><h2 className="text-blue-400 font-bold flex items-center gap-2 text-sm"><Icon name="box" className="w-4 h-4" /> åŠéš±å¼é›†é¢¨ç³»çµ±è¦åŠƒ</h2><button onClick={reset} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button></div>{error && <div className="text-red-400 text-xs font-bold mb-3 text-center bg-red-900/20 py-2 rounded-lg">{error}</div>}<div className="space-y-6"><div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">1. æ³•è˜­å°ºå¯¸èˆ‡ç©ºé–“è¦åŠƒ</label><div className="grid grid-cols-2 gap-3 mb-3"><div className="relative"><span className="absolute left-2 top-0 text-[8px] text-gray-500">æ³•è˜­å¯¬(cm)</span><input type="number" value={state.flangeW} onChange={e=>setState(p=>({...p, flangeW:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div><div className="relative"><span className="absolute left-2 top-0 text-[8px] text-gray-500">æ³•è˜­é«˜(cm)</span><input type="number" value={state.flangeH} onChange={e=>setState(p=>({...p, flangeH:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div></div><div className="grid grid-cols-2 gap-3"><div className="relative"><span className="absolute left-2 top-0 text-[8px] text-blue-400">ç©ºé–“åªæ•¸</span><input type="number" value={state.ping} onChange={e=>setState(p=>({...p, ping:e.target.value}))} className="w-full bg-industrial-900 border border-blue-900/50 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div><div className="relative"><span className="absolute left-2 top-0 text-[8px] text-green-400">å‡ºé¢¨å£æ•¸</span><input type="number" value={state.outletCount} onChange={e=>setState(p=>({...p, outletCount:e.target.value}))} className="w-full bg-industrial-900 border border-green-900/50 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div></div></div><div className="bg-industrial-950 p-4 rounded-xl border border-industrial-800"><label className="text-[10px] text-blue-400 mb-3 block font-bold text-center uppercase tracking-widest">2. é¢¨ç®¡èµ°å‘ (è¨ˆç®—è·é›¢å°„ç¨‹)</label><div className="flex gap-4 justify-center"><div className="flex flex-col items-center"><span className="text-[10px] text-gray-500 mb-2">ä¸»æ©Ÿä½ç½®</span><div className="grid grid-cols-3 gap-1 w-24">{[...Array(9)].map((_, i) => (<button key={`u-${i}`} type="button" onClick={() => setState(p => ({ ...p, unitPos: i }))} className={`grid-pos-btn ${state.unitPos === i ? 'active-unit' : ''}`}>{state.unitPos===i ? <Icon name="box" className="w-3 h-3" /> : null}</button>))}</div></div><div className="flex items-center text-gray-600"><Icon name="chevron-right" /></div><div className="flex flex-col items-center"><span className="text-[10px] text-gray-500 mb-2">æœ€é å‡ºé¢¨å£</span><div className="grid grid-cols-3 gap-1 w-24">{[...Array(9)].map((_, i) => (<button key={`o-${i}`} type="button" onClick={() => setState(p => ({ ...p, outletPos: i }))} className={`grid-pos-btn ${state.outletPos === i ? 'active-outlet' : ''}`}>{state.outletPos===i ? <Icon name="wind" className="w-3 h-3" /> : null}</button>))}</div></div></div></div><button onClick={calculate} className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm flex items-center justify-center gap-2"><Icon name="zap" className="w-4 h-4" /> ç”¢ç”Ÿæœ€ä½³é…ç½®æ–¹æ¡ˆ</button></div></div>
                    {state.result && (
                        <div className="bg-industrial-900 rounded-2xl p-5 border border-blue-600/50 animate-slide-up shadow-2xl relative overflow-hidden mt-4">
                             <div className="absolute top-0 left-0 w-full h-1 bg-blue-600"></div>
                             {state.result.splitConfig ? (
                                 <div className="flex flex-col gap-3">
                                     <div className="bg-industrial-800 p-4 rounded-xl border border-industrial-700 flex justify-between items-center"><div><div className="text-[10px] text-blue-300 font-bold uppercase tracking-wider mb-1">ä¸»æ©Ÿç«¯é›†é¢¨ç®±</div><div className="text-gray-400 text-xs">ä¾æ“šæ³•è˜­æ¥µé™</div></div><div className="text-right"><div className="text-2xl font-mono font-bold text-blue-400">{state.result.mainQty}å­” Ã— {state.result.mainSize}å‹</div></div></div>
                                     <div className="flex justify-center -my-2 z-10 text-gray-500"><Icon name="git-merge" className="w-6 h-6 rotate-180 bg-industrial-900 rounded-full" /></div>
                                     <div className="bg-industrial-800 p-4 rounded-xl border border-green-900/50 flex justify-between items-center"><div><div className="text-[10px] text-green-400 font-bold uppercase tracking-wider mb-1">æœ«ç«¯åˆ†é¢¨ç®±(ä¸‰é€š)</div><div className="text-gray-400 text-xs">ç¬¦åˆé æœŸå‡ºé¢¨æ•¸é‡</div></div><div className="text-right"><div className="text-2xl font-mono font-bold text-green-400">{state.result.splitConfig.qty}å‡ºé¢¨å£ Ã— {state.result.splitConfig.size}å‹</div></div></div>
                                 </div>
                             ) : (
                                 <div className="grid grid-cols-2 gap-4 text-white"><div className="text-center border-r border-industrial-700 font-mono"><div className="text-gray-500 text-[10px] mb-1 font-bold">ä¸»æ©Ÿç«¯å‡ºé¢¨æ•¸é‡</div><div className="text-4xl font-bold">{state.result.mainQty} <span className="text-xs text-blue-500 font-sans">å­”</span></div></div><div className="text-center font-mono"><div className="text-gray-500 text-[10px] mb-1 font-bold">å»ºè­°å­”å¾‘å¤§å°</div><div className="text-4xl font-bold">{state.result.mainSize} <span className="text-xs text-blue-500 font-sans">å‹</span></div></div></div>
                             )}
                             <div className="bg-industrial-800/50 p-3 rounded-xl text-[11px] leading-relaxed text-gray-300 border border-industrial-700/50 mt-4"><span className="text-blue-400 font-bold block mb-1 uppercase tracking-widest"><Icon name="wind" className="inline w-3 h-3 mr-1" />å°ˆæ¥­é…ç½®è§£æ:</span><span style={{ whiteSpace: "pre-wrap" }}>{state.result.airflowNote}</span></div>
                        </div>
                    )}
                </div>
            );
        };

        // --- 3. ä¸»ç¨‹å¼ App ---

        function App() {
            const [activeTab, setActiveTab] = useState('search'); 
            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [history, setHistory] = useState([]);
            const [showClearConfirm, setShowClearConfirm] = useState(false);
            const [selectedHistoryItem, setSelectedHistoryItem] = useState(null);
            const [searchState, setSearchState] = useState({ brand: 'ä¸æ‹˜', series: 'ä¸æ‹˜', func: 'ä¸æ‹˜', iduType: 'ä¸æ‹˜', keyword: '', results: [], hasSearched: false });
            const [selectedSpecGroup, setSelectedSpecGroup] = useState(null);

            const availableSeries = useMemo(() => {
                if (searchState.brand === 'ä¸æ‹˜') return ['ä¸æ‹˜'];
                const seriesSet = new Set(AC_DATABASE.filter(item => item.brandCN === searchState.brand && item.series).map(item => item.series));
                return ['ä¸æ‹˜', ...Array.from(seriesSet)];
            }, [searchState.brand]);

            useEffect(() => { setSearchState(prev => ({ ...prev, series: 'ä¸æ‹˜' })); }, [searchState.brand]);

            const [refrigerantState, setRefrigerantState] = useState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null });
            const [coolingState, setCoolingState] = useState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null });
            const [ductedState, setDuctedState] = useState({ flangeW: '', flangeH: '', ping: '', outletCount: 2, unitPos: 4, outletPos: null, result: null });
            const [rooms, setRooms] = useState([{ id: Date.now(), name: 'å®¢å»³', ping: '', conditions: {}, kw: 0, iduType: 'å£æ›å¼', matchedSingle: null, matchedIdu: null }]);
            const [systemPref, setSystemPref] = useState('multi'); 
            const [multiCapacityResult, setMultiCapacityResult] = useState(null);

            useEffect(() => {
                try {
                    const saved = localStorage.getItem('yiGeHistory');
                    if (saved) setHistory(JSON.parse(saved));
                } catch (e) { setHistory([]); }
            }, []);

            const addToHistory = useCallback((title, type, data) => {
                setHistory(prev => {
                    const newH = [{ id: Date.now(), title, type, date: new Date().toLocaleString(), data }, ...prev].slice(0, 20);
                    localStorage.setItem('yiGeHistory', JSON.stringify(newH));
                    return newH;
                });
            }, []);

            const confirmClearHistory = () => {
                setHistory([]);
                localStorage.removeItem('yiGeHistory');
                setShowClearConfirm(false);
            };

            const executeSearch = () => {
                const rawResults = AC_DATABASE.filter(item => {
                    if (searchState.brand !== 'ä¸æ‹˜' && item.brandCN !== searchState.brand) return false;
                    if (searchState.series !== 'ä¸æ‹˜' && item.series !== searchState.series) return false;
                    if (searchState.func !== 'ä¸æ‹˜' && item.func !== searchState.func) return false;
                    if (searchState.iduType !== 'ä¸æ‹˜') {
                        if (searchState.iduType === 'å®¤å…§æ©Ÿ' && !item.idu) return false;
                        else if (searchState.iduType === 'å®¤å¤–æ©Ÿ(ä¸€å°ä¸€)' && (!item.odu || item.isMulti)) return false;
                        else if (searchState.iduType === 'å®¤å¤–æ©Ÿ(ä¸€å°å¤š)' && (!item.odu || !item.isMulti)) return false;
                        else if (!['å®¤å…§æ©Ÿ','å®¤å¤–æ©Ÿ(ä¸€å°ä¸€)','å®¤å¤–æ©Ÿ(ä¸€å°å¤š)'].includes(searchState.iduType) && (!item.idu || item.type !== searchState.iduType)) return false;
                    }
                    if (searchState.keyword.trim() !== '') {
                        const kw = searchState.keyword.toLowerCase();
                        if (!item.brandCN.toLowerCase().includes(kw) && !((item.modelIdu||'')+(item.modelOdu||'')).toLowerCase().includes(kw) && !(item.series||'').toLowerCase().includes(kw)) return false;
                    }
                    return true;
                });

                const groupedMap = new Map();
                rawResults.forEach(item => {
                    const groupKey = `${item.brandCN}-${item.series}-${item.maxKw}-${item.type}`;
                    if (!groupedMap.has(groupKey)) {
                        groupedMap.set(groupKey, { brandCN: item.brandCN, series: item.series, maxKw: item.maxKw, type: item.type, refrigerant: item.refrigerant, pipes: item.pipes, variants: [] });
                    }
                    groupedMap.get(groupKey).variants.push(item);
                });

                const groupedResults = Array.from(groupedMap.values()).sort((a, b) => a.maxKw - b.maxKw);
                setSearchState(prev => ({ ...prev, results: groupedResults, hasSearched: true }));
                addToHistory(`æ¢ä»¶æœå°‹: ${groupedResults.length}çµ„çµæœ`, 'search', { results: groupedResults });
            };

            const clearSearchFilters = () => { setSearchState({ brand: 'ä¸æ‹˜', series: 'ä¸æ‹˜', func: 'ä¸æ‹˜', iduType: 'ä¸æ‹˜', keyword: '', results: [], hasSearched: false }); };
            
            return (
                <div className="min-h-screen flex flex-col font-sans select-none relative bg-industrial-950">
                    <header className="bg-industrial-900 border-b border-industrial-700 sticky top-0 z-40 px-4 py-3 shadow-lg">
                        <div className="max-w-md mx-auto flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <button onClick={() => setIsSidebarOpen(true)} className="p-1 -ml-1 text-gray-400 hover:text-white transition-colors active:scale-95"><Icon name="menu" className="w-6 h-6" /></button>
                                <div className="flex items-center gap-2"><Icon name="wrench" className="text-industrial-accent w-5 h-5" /><h1 className="text-lg font-bold tracking-tighter text-white">é¾ç¥<span className="text-industrial-accent">ç©ºèª¿</span>å¹«æ‰‹</h1></div>
                            </div>
                            <span className="text-[10px] text-industrial-600 font-mono">V11.2</span>
                        </div>
                    </header>
                    <div className={`fixed inset-0 z-[200] ${isSidebarOpen ? 'pointer-events-auto' : 'pointer-events-none'}`}>
                        <div className={`absolute inset-0 bg-black/70 backdrop-blur-sm transition-opacity duration-300 ${isSidebarOpen ? 'opacity-100' : 'opacity-0'}`} onClick={() => setIsSidebarOpen(false)}></div>
                        <div className={`absolute top-0 left-0 w-64 h-full bg-industrial-900 border-r border-industrial-700 transform transition-transform duration-300 flex flex-col shadow-2xl ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                            <div className="p-5 border-b border-industrial-700 flex items-center justify-between bg-industrial-950">
                                <div className="flex items-center gap-2"><Icon name="wrench" className="text-industrial-accent w-5 h-5" /><span className="text-lg font-bold text-white tracking-widest">é¸å–®</span></div>
                                <button onClick={() => setIsSidebarOpen(false)} className="text-gray-500 hover:text-white"><Icon name="x" className="w-5 h-5" /></button>
                            </div>
                            <div className="flex-1 overflow-y-auto py-4 space-y-1.5 px-3">
                                <SidebarBtn active={activeTab==='search'} onClick={()=>{setActiveTab('search'); setIsSidebarOpen(false);}} icon="search" label="æ©Ÿå‹èˆ‡è¦æ ¼æŸ¥è©¢" />
                                <SidebarBtn active={activeTab==='capacity'} onClick={()=>{setActiveTab('capacity'); setIsSidebarOpen(false);}} icon="ruler" label="è² è¼‰èˆ‡æ©Ÿå‹é…ç½®" />
                                <SidebarBtn active={activeTab==='calc'} onClick={()=>{setActiveTab('calc'); setIsSidebarOpen(false);}} icon="calculator" label="å†·åª’è¿½åŠ è¨ˆç®—" />
                                <SidebarBtn active={activeTab==='cooling'} onClick={()=>{setActiveTab('cooling'); setIsSidebarOpen(false);}} icon="thermometer" label="ç‰©ç†é™æº«æ¨¡æ“¬" />
                                <SidebarBtn active={activeTab==='ducted'} onClick={()=>{setActiveTab('ducted'); setIsSidebarOpen(false);}} icon="box" label="åŠéš±å¼é¢¨ç®¡è¦åŠƒ" />
                            </div>
                            <div className="p-4 border-t border-industrial-700 bg-industrial-950"><SidebarBtn active={activeTab==='history'} onClick={()=>{setActiveTab('history'); setIsSidebarOpen(false);}} icon="history" label="æ“ä½œæ­·å²ç´€éŒ„" /></div>
                        </div>
                    </div>
                    <main className="flex-1 max-w-md mx-auto w-full p-4 pb-8 overflow-x-hidden">
                        {activeTab === 'search' && (
                            <div className="animate-fade-in">
                                <h2 className="text-industrial-accent font-bold mb-3 flex items-center gap-2 text-sm"><Icon name="search" className="w-4 h-4" /> å¤šæ¢ä»¶ç²¾æº–ç¯©é¸</h2>
                                <div className="bg-industrial-800 p-4 rounded-xl border border-industrial-700 shadow-inner mb-6 space-y-4">
                                    <div className="grid grid-cols-2 gap-4 mt-2">
                                        <FilterSelect label="å“ç‰Œ" value={searchState.brand} options={['ä¸æ‹˜', 'æ—¥ç«‹', 'å¤§é‡‘', 'åœ‹éš›ç‰Œ', 'ä¸‰è±é‡å·¥', 'å¯Œå£«é€š', 'æ ¼åŠ›', 'ç¾çš„', 'è¯è±']} onChange={val => setSearchState(p => ({...p, brand: val}))} />
                                        <FilterSelect label="ç³»åˆ— (è«‹å…ˆé¸å“ç‰Œ)" value={searchState.series} options={availableSeries} disabled={searchState.brand === 'ä¸æ‹˜'} onChange={val => setSearchState(p => ({...p, series: val}))} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 mt-2">
                                        <FilterSelect label="å†·æš–/å†·å°ˆ" value={searchState.func} options={['ä¸æ‹˜', 'å†·æš–', 'å†·å°ˆ']} onChange={val => setSearchState(p => ({...p, func: val}))} />
                                        <FilterSelect label="æ©Ÿå‹å‹å¼" value={searchState.iduType} options={['ä¸æ‹˜', 'å®¤å…§æ©Ÿ', 'å®¤å¤–æ©Ÿ(ä¸€å°ä¸€)', 'å®¤å¤–æ©Ÿ(ä¸€å°å¤š)', 'å£æ›å¼', 'åŠéš±å¼', 'ç›´ç«‹å¼']} onChange={val => setSearchState(p => ({...p, iduType: val}))} />
                                    </div>
                                    <div className="relative pt-2">
                                        <span className="absolute top-0 left-2 bg-industrial-800 px-1 text-[10px] text-industrial-accent font-bold tracking-widest z-10 pointer-events-none">å‹è™Ÿé—œéµå­—</span>
                                        <div className="absolute inset-y-0 left-0 pl-3 pt-2 flex items-center pointer-events-none text-gray-500"><Icon name="search" className="w-4 h-4" /></div>
                                        <input type="text" className="w-full pl-9 pr-4 py-2.5 bg-industrial-900 border border-industrial-700 rounded-lg text-sm text-white focus:border-industrial-accent transition-all" placeholder="é¸å¡«..." value={searchState.keyword} onChange={e => setSearchState(p => ({...p, keyword: e.target.value}))} onKeyDown={e => { if (e.key === 'Enter') executeSearch(); }} />
                                    </div>
                                    <div className="flex gap-3 pt-2 border-t border-industrial-700/50">
                                        <button onClick={clearSearchFilters} className="px-4 py-3 bg-industrial-900 text-gray-400 font-bold rounded-lg border border-industrial-700 text-sm whitespace-nowrap hover:text-white">æ¸…é™¤æ¢ä»¶</button>
                                        <button onClick={executeSearch} className="flex-1 py-3 bg-industrial-accent hover:bg-yellow-500 text-white font-bold rounded-lg shadow-lg transition-all active:scale-95 text-sm flex justify-center items-center gap-2"><Icon name="search" className="w-4 h-4" /> åŸ·è¡Œæœå°‹</button>
                                    </div>
                                </div>
                                {searchState.hasSearched && (
                                    <div className="mt-2">
                                        <div className="text-[10px] text-gray-500 mb-3 border-b border-industrial-700 pb-2 uppercase tracking-widest flex justify-between"><span>æŸ¥è©¢çµæœ</span><span className="text-industrial-accent font-bold">å…± {searchState.results.length} çµ„ç¬¦åˆ</span></div>
                                        {searchState.results.length > 0 ? 
                                            searchState.results.map((g, i) => <ResultCard key={i} group={g} onClick={() => setSelectedSpecGroup(g)} />) 
                                            : <div className="text-center text-gray-500 py-10 bg-industrial-800/50 rounded-xl border border-industrial-700 border-dashed"><Icon name="x" className="w-8 h-8 mx-auto mb-2 text-gray-600" /><p className="text-sm">æŸ¥ç„¡ç¬¦åˆæ¢ä»¶çš„æ©Ÿå‹è³‡æ–™</p></div>}
                                    </div>
                                )}
                            </div>
                        )}
                        {activeTab === 'capacity' && <MultiRoomCapacityCalculator rooms={rooms} setRooms={setRooms} systemPref={systemPref} setSystemPref={setSystemPref} result={multiCapacityResult} setResult={setMultiCapacityResult} addToHistory={addToHistory} db={AC_DATABASE} />}
                        {activeTab === 'calc' && <RefrigerantCalculator state={refrigerantState} setState={setRefrigerantState} addToHistory={addToHistory} />}
                        {activeTab === 'cooling' && <CoolingTimeCalculator state={coolingState} setState={setCoolingState} addToHistory={addToHistory} />}
                        {activeTab === 'ducted' && <DuctedCalculator state={ductedState} setState={setDuctedState} addToHistory={addToHistory} />}
                        {activeTab === 'history' && (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-4 border-b border-industrial-700 pb-2"><h2 className="text-white font-bold tracking-widest flex items-center gap-2 text-sm"><Icon name="history" className="w-4 h-4"/> æ“ä½œç´€éŒ„</h2><button onClick={() => setShowClearConfirm(true)} className="text-[10px] text-red-400 border border-red-900/30 px-2 py-1 rounded bg-red-900/10 hover:bg-red-900/20">æ¸…é™¤ç´€éŒ„</button></div>
                                {history.length === 0 ? <p className="text-center text-gray-600 py-20 text-sm">ç›®å‰æ²’æœ‰æ­·å²ç´€éŒ„</p> : (
                                    <div className="space-y-3">{history.map(item => (<div key={item.id} onClick={() => setSelectedHistoryItem(item)} className="bg-industrial-800 p-3 rounded-xl border-l-4 border-industrial-600 flex justify-between items-center shadow-sm cursor-pointer hover:bg-industrial-700 transition-colors group"><div><span className="text-[9px] text-gray-500 block leading-none mb-1 uppercase tracking-widest">{item.type} | {item.date}</span><div className="text-sm font-bold text-gray-200 truncate w-56 group-hover:text-industrial-accent transition-colors">{item.title}</div></div><Icon name="chevron-right" className="w-4 h-4 text-gray-600 group-hover:text-white" /></div>))}</div>
                                )}
                            </div>
                        )}
                    </main>
                    {selectedSpecGroup && (
                        <SpecModal group={selectedSpecGroup} onClose={() => setSelectedSpecGroup(null)} />
                    )}
                    {selectedHistoryItem && (
                        <HistoryModal item={selectedHistoryItem} onClose={() => setSelectedHistoryItem(null)} onOpenSpec={setSelectedSpecGroup} />
                    )}
                    {showClearConfirm && <div className="fixed inset-0 z-[300] flex items-center justify-center p-4 animate-fade-in"><div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={() => setShowClearConfirm(false)}></div><div className="bg-industrial-800 p-6 rounded-2xl w-full max-w-xs border border-industrial-700 shadow-2xl relative z-10 text-center"><Icon name="trash" className="w-10 h-10 text-red-500 mx-auto mb-3" /><h3 className="text-white font-bold mb-2">ç¢ºèªæ¸…é™¤ç´€éŒ„</h3><p className="text-xs text-gray-400 mb-6">æ‚¨ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰çš„æ“ä½œç´€éŒ„å—ï¼Ÿ</p><div className="flex gap-3"><button onClick={() => setShowClearConfirm(false)} className="flex-1 py-3 rounded-xl bg-industrial-700 text-white font-bold text-sm">å–æ¶ˆ</button><button onClick={confirmClearHistory} className="flex-1 py-3 rounded-xl bg-red-600 hover:bg-red-500 text-white font-bold text-sm shadow-lg">ç¢ºå®š</button></div></div></div>}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
