<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾ç¥ç©ºèª¿å¹«æ‰‹ | å°ˆæ¥­å†·æ°£å¸«å‚…å·¥å…·ç®±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        // --- åŸºæœ¬é˜²è­·è…³æœ¬ ---
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                return false;
            }
        });

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        industrial: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                            accent: '#f59e0b',
                            text: '#e2e8f0',
                        }
                    },
                    animation: { 'fade-in': 'fadeIn 0.3s ease-out', 'slide-up': 'slideUp 0.3s ease-out' },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(15px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; user-select: none; -webkit-user-select: none; font-family: sans-serif; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input { user-select: auto; -webkit-user-select: auto; outline: none; }
        .grid-pos-btn { aspect-ratio: 1/1; border: 1px solid #334155; display: flex; align-items: center; justify-content: center; border-radius: 6px; cursor: pointer; transition: all 0.2s; }
        .grid-pos-btn.active { background-color: #f59e0b; color: #0f172a; border-color: #f59e0b; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- æ ¸å¿ƒåœ–ç¤ºçµ„ä»¶ (ç©©å®šæ€§é«˜ï¼Œä¸å´©æ½°) ---
        const Icon = ({ name, className = "w-4 h-4" }) => {
            const icons = {
                wrench: <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z" />,
                search: <><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></>,
                ruler: <path d="M21.3 15.3 16 10l-4.9 4.9-5.3-5.3-1.4 1.4 5.3 5.3L5.4 21l-1.4-1.4 4.6-4.6L2.7 9.7l1.4-1.4 4.6 4.6L12.1 9l1.4 1.4-4.6 4.6 4.6 4.6 5.3-5.3 1.4 1.4-5.3 5.3 1.4 1.4Z" />,
                calculator: <><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></>,
                box: <><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z" /><path d="m3.3 7 8.7 5 8.7-5" /><path d="M12 22V12" /></>,
                history: <><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /><path d="M12 7v5l4 2" /></>,
                x: <><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>,
                check: <path d="M20 6 9 17l-5-5" />,
                "air-vent": <><path d="M6 12H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" /><path d="M6 8h12" /><path d="M18.3 17.7a2.5 2.5 0 0 1-3.16 3.83 2.53 2.53 0 0 1-1.14-2V12" /><path d="M6.6 15.6A2 2 0 1 0 5 12v5a2 2 0 0 0 2 2h5" /></>,
                thermometer: <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />,
                zap: <path d="M4 14.5 14 3 12.5 9.5H20L10 21l1.5-6.5H4Z" />,
                trash: <><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" /></>
            };
            return (
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const AC_DATABASE = [
            { id: 'daikin-001', brand: 'Daikin', brandCN: 'å¤§é‡‘', model: 'RXV36UVLT', type: 'å†·æš–è®Šé »', pipes: '2åˆ† / 3åˆ†', dims: '825x283x233', power: '220V/4.5A', refrigerant: 'R32' },
            { id: 'hitachi-001', brand: 'Hitachi', brandCN: 'æ—¥ç«‹', model: 'RAC-40NK', type: 'å†·å°ˆè®Šé »', pipes: '2åˆ† / 4åˆ†', dims: '900x300x250', power: '220V/5.2A', refrigerant: 'R410A' },
            { id: 'panasonic-001', brand: 'Panasonic', brandCN: 'åœ‹éš›ç‰Œ', model: 'CU-PX28FCA2', type: 'å†·æš–æ——è‰¦', pipes: '2åˆ† / 3åˆ†', dims: '780x290x240', power: '220V/3.8A', refrigerant: 'R32' },
            { id: 'teco-001', brand: 'TECO', brandCN: 'æ±å…ƒ', model: 'MA-28IH-ZR', type: 'è®Šé »å†·æš–', pipes: '2åˆ† / 3åˆ†', dims: '815x275x210', power: '110V/8.5A', refrigerant: 'R32' }
        ];

        function App() {
            const [activeTab, setActiveTab] = useState('search'); 
            const [history, setHistory] = useState([]);
            const [selectedHistoryItem, setSelectedHistoryItem] = useState(null);

            const [searchState, setSearchState] = useState({ term: '', results: [] });
            const [capacityState, setCapacityState] = useState({ unit: 'm', length: '', width: '', ping: 0, conditions: { westSun: false, allDaySun: false, topFloor: false, highCeiling: false, ironSheet: false, blackIron: false }, result: null });
            const [refrigerantState, setRefrigerantState] = useState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null });
            const [coolingState, setCoolingState] = useState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null });
            const [ductedState, setDuctedState] = useState({ flangeW: '', flangeH: '', spaceType: 'long', unitPos: 4, result: null });

            useEffect(() => {
                try {
                    const saved = localStorage.getItem('yiGeHistory');
                    if (saved) setHistory(JSON.parse(saved));
                } catch (e) { setHistory([]); }
            }, []);

            const addToHistory = useCallback((title, type, data) => {
                setHistory(prev => {
                    const newH = [{ id: Date.now(), title, type, date: new Date().toLocaleString(), data }, ...prev].slice(0, 20);
                    localStorage.setItem('yiGeHistory', JSON.stringify(newH));
                    return newH;
                });
            }, []);

            const clearHistory = () => {
                if(window.confirm('ç¢ºå®šæ¸…é™¤ç´€éŒ„å—ï¼Ÿ')) {
                    setHistory([]);
                    localStorage.removeItem('yiGeHistory');
                }
            };

            return (
                <div className="min-h-screen flex flex-col font-sans select-none">
                    <header className="bg-industrial-900 border-b border-industrial-700 sticky top-0 z-50 px-4 py-3 shadow-lg">
                        <div className="max-w-md mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <Icon name="wrench" className="text-industrial-accent w-5 h-5" />
                                <h1 className="text-lg font-bold tracking-tighter text-white">é¾ç¥<span className="text-industrial-accent">ç©ºèª¿</span>å¹«æ‰‹</h1>
                            </div>
                            <span className="text-[10px] text-industrial-600 font-mono">V1.5.6 STABLE</span>
                        </div>
                    </header>

                    <main className="flex-1 max-w-md mx-auto w-full p-4 pb-24 overflow-x-hidden">
                        {activeTab === 'search' && (
                            <div className="animate-fade-in">
                                <div className="relative mb-6">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500">
                                        <Icon name="search" className="w-4 h-4" />
                                    </div>
                                    <input
                                        type="text"
                                        className="w-full pl-9 pr-10 py-3 bg-industrial-800 border border-industrial-700 rounded-xl text-sm text-white focus:border-industrial-accent transition-all shadow-inner"
                                        placeholder="æœå°‹å“ç‰Œã€å‹è™Ÿ..."
                                        value={searchState.term}
                                        onChange={(e) => {
                                            const term = e.target.value;
                                            const low = term.toLowerCase();
                                            const res = term ? AC_DATABASE.filter(i => i.brand.toLowerCase().includes(low) || i.brandCN.includes(low) || i.model.toLowerCase().includes(low)) : [];
                                            setSearchState({ term, results: res });
                                        }}
                                    />
                                    {searchState.term && (
                                        <button onClick={() => setSearchState({ term: '', results: [] })} className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white">
                                            <Icon name="x" className="w-4 h-4" />
                                        </button>
                                    )}
                                </div>
                                {searchState.term ? (
                                    searchState.results.length > 0 ? searchState.results.map(i => <ResultCard key={i.id} item={i} />) : <p className="text-center text-gray-500 text-sm py-10">æŸ¥ç„¡çµæœ</p>
                                ) : (
                                    <div className="grid grid-cols-2 gap-2 mt-4 opacity-70">
                                        {['å¤§é‡‘', 'æ—¥ç«‹', 'åœ‹éš›ç‰Œ', 'æ±å…ƒ'].map(b => (
                                            <button key={b} onClick={() => setSearchState({ term: b, results: AC_DATABASE.filter(i => i.brandCN.includes(b)) })} className="bg-industrial-800 border border-industrial-700 p-3 rounded-lg text-xs font-bold hover:bg-industrial-700 text-white">{b}</button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'capacity' && <CapacityCalculator state={capacityState} setState={setCapacityState} addToHistory={addToHistory} />}
                        {activeTab === 'calc' && <RefrigerantCalculator state={refrigerantState} setState={setRefrigerantState} addToHistory={addToHistory} />}
                        {activeTab === 'cooling' && <CoolingTimeCalculator state={coolingState} setState={setCoolingState} addToHistory={addToHistory} />}
                        {activeTab === 'ducted' && <DuctedCalculator state={ductedState} setState={setDuctedState} addToHistory={addToHistory} />}

                        {activeTab === 'history' && (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="font-bold text-white">æ“ä½œç´€éŒ„</h2>
                                    <button onClick={clearHistory} className="text-[10px] text-red-400 border border-red-900/30 px-2 py-1 rounded bg-red-900/10 hover:bg-red-900/20">æ¸…é™¤ç´€éŒ„</button>
                                </div>
                                {history.length === 0 ? <p className="text-center text-gray-600 py-20 text-sm">ç›®å‰æ²’æœ‰æ­·å²ç´€éŒ„</p> : (
                                    <div className="space-y-3">
                                        {history.map(item => (
                                            <div key={item.id} onClick={() => setSelectedHistoryItem(item)} className="bg-industrial-800 p-3 rounded-lg border-l-4 border-industrial-600 flex justify-between items-center cursor-pointer hover:bg-industrial-700 transition-all">
                                                <div>
                                                    <span className="text-[9px] text-gray-500 block leading-none mb-1 uppercase tracking-tighter">{item.type} | {item.date}</span>
                                                    <div className="text-sm font-bold text-gray-100 truncate w-48">{item.title}</div>
                                                </div>
                                                <Icon name="search" className="text-gray-600 w-4 h-4" />
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* æ­·å²è©³æƒ…å½ˆçª— */}
                    {selectedHistoryItem && (
                        <div className="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in">
                            <div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={() => setSelectedHistoryItem(null)}></div>
                            <div className="bg-industrial-900 w-full max-w-md rounded-t-3xl sm:rounded-2xl border border-industrial-700 shadow-2xl overflow-hidden flex flex-col max-h-[80vh] relative z-10">
                                <div className="p-4 border-b border-industrial-700 flex justify-between items-center bg-industrial-800/50">
                                    <h3 className="font-bold text-sm text-white">ç´€éŒ„è©³æƒ…å›æº¯</h3>
                                    <button onClick={() => setSelectedHistoryItem(null)} className="p-1 text-gray-400 hover:text-white"><Icon name="x" className="w-5 h-5" /></button>
                                </div>
                                <div className="p-6 overflow-y-auto custom-scroll">
                                    <div className="text-[10px] text-gray-500 mb-4 bg-industrial-950 p-2 rounded text-center uppercase tracking-widest">{selectedHistoryItem.type} | {selectedHistoryItem.date}</div>
                                    
                                    {selectedHistoryItem.type === 'calc' && (
                                        <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                            <div className="text-gray-500 text-xs mb-1 uppercase">éœ€è£œå……å†·åª’</div>
                                            <div className="text-5xl font-mono font-bold text-green-400">{selectedHistoryItem.data?.result}<span className="text-sm ml-1 text-gray-400 uppercase">g</span></div>
                                            <div className="text-[10px] text-gray-500 mt-4 border-t border-industrial-700 pt-3 text-left leading-relaxed">
                                                â€¢ ç¸½ç®¡è·¯é•·åº¦: {selectedHistoryItem.data?.totalLen} m<br/>
                                                â€¢ åŸå» åŸºæº–é•·: {selectedHistoryItem.data?.baseLen} m
                                            </div>
                                        </div>
                                    )}

                                    {selectedHistoryItem.type === 'capacity' && (
                                        <div className="space-y-4">
                                            <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                                <div className="text-gray-500 text-xs mb-1 uppercase tracking-widest">å»ºè­°è£½å†·é‡</div>
                                                <div className="text-4xl font-mono font-bold text-yellow-400">{selectedHistoryItem.data?.kw} KW</div>
                                                <div className="text-xs text-gray-500 mt-1">ç´„ {selectedHistoryItem.data?.tons} å™¸</div>
                                            </div>
                                            <div className="bg-industrial-950 p-4 rounded-xl text-xs leading-relaxed text-gray-300">
                                                <div className="text-industrial-accent font-bold mb-1 border-b border-industrial-700 pb-1">å¡«å¯«åƒæ•¸</div>
                                                <div>â€¢ è¨ˆç®—åªæ•¸: {selectedHistoryItem.data?.ping} åª</div>
                                                <div>â€¢ åŠ æ¬Šæ¢ä»¶: {selectedHistoryItem.data?.conditions?.join(', ') || 'ç„¡'}</div>
                                            </div>
                                        </div>
                                    )}

                                    {selectedHistoryItem.type === 'cooling' && (
                                        <div className="space-y-4">
                                            <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                                <div className="text-gray-500 text-xs mb-1 uppercase tracking-widest">é ä¼°é™æº«è€—æ™‚</div>
                                                <div className="text-5xl font-mono font-bold text-purple-400">{selectedHistoryItem.data?.minutes} <span className="text-sm">åˆ†é˜</span></div>
                                            </div>
                                            <div className="bg-industrial-950 p-4 rounded-xl text-xs leading-relaxed text-gray-300">
                                                <div className="text-industrial-accent font-bold mb-1 border-b border-industrial-700 pb-1">å¡«å¯«åƒæ•¸</div>
                                                <div>â€¢ ç©ºé–“æ¢ä»¶: {selectedHistoryItem.data?.ping} åª / é«˜åº¦ {selectedHistoryItem.data?.height} m</div>
                                                <div>â€¢ æº«å·®è®ŠåŒ–: {selectedHistoryItem.data?.currentTemp}Â°C â†’ {selectedHistoryItem.data?.targetTemp}Â°C</div>
                                                <div>â€¢ å†·æ°£èƒ½åŠ›: {selectedHistoryItem.data?.acKw} KW</div>
                                            </div>
                                        </div>
                                    )}

                                    {selectedHistoryItem.type === 'ducted' && (
                                        <div className="space-y-4">
                                            <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                                <div className="text-3xl font-mono font-bold text-blue-400">{selectedHistoryItem.data?.holeQty}å­” Ã— {selectedHistoryItem.data?.holeSize}å‹</div>
                                                <div className="text-[10px] text-gray-500 mt-1 uppercase tracking-widest">{selectedHistoryItem.data?.plenumType}</div>
                                            </div>
                                            <div className="bg-industrial-950 p-4 rounded-xl text-xs leading-relaxed text-gray-300">
                                                <div className="text-industrial-accent font-bold mb-1 border-b border-industrial-700 pb-1">æ¢ä»¶å›æº¯</div>
                                                <div>â€¢ æ³•è˜­å°ºå¯¸: {selectedHistoryItem.data?.flangeW}Ã—{selectedHistoryItem.data?.flangeH} cm</div>
                                                <div>â€¢ ç©ºé–“å‹æ…‹: {selectedHistoryItem.data?.spaceTypeCN}</div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <div className="p-4 bg-industrial-800 border-t border-industrial-700">
                                    <button onClick={() => setSelectedHistoryItem(null)} className="w-full py-3 bg-industrial-700 text-white rounded-xl font-bold">é—œé–‰è©³æƒ…</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="fixed bottom-0 w-full bg-industrial-900 border-t border-industrial-700 pb-safe z-50">
                        <div className="max-w-md mx-auto grid grid-cols-5 h-16">
                            <NavBtn active={activeTab === 'search'} onClick={() => setActiveTab('search')} icon="search" label="æœå°‹" />
                            <NavBtn active={activeTab === 'capacity'} onClick={() => setActiveTab('capacity')} icon="ruler" label="è² è¼‰" />
                            <NavBtn active={activeTab === 'calc'} onClick={() => setActiveTab('calc')} icon="calculator" label="å†·åª’" />
                            <NavBtn active={activeTab === 'ducted'} onClick={() => setActiveTab('ducted')} icon="box" label="åŠéš±" />
                            <NavBtn active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon="history" label="ç´€éŒ„" />
                        </div>
                    </nav>
                </div>
            );
        }

        function NavBtn({ active, onClick, icon, label }) {
            return (
                <button onClick={onClick} className={`flex flex-col items-center justify-center w-full transition-all duration-300 ${active ? 'text-industrial-accent scale-110' : 'text-gray-500 hover:text-gray-400'}`}>
                    <Icon name={icon} className="w-5 h-5 mb-1" />
                    <span className="text-[9px] font-bold uppercase tracking-tighter">{label}</span>
                </button>
            );
        }

        // --- ä¿®æ­£å¾Œçš„è² è¼‰è©¦ç®—çµ„ä»¶ (æ‰¾å›çµæœé¡¯ç¤ºå€å¡Š) ---
        function CapacityCalculator({ state, setState, addToHistory }) {
            useEffect(() => {
                const l = parseFloat(state.length) || 0, w = parseFloat(state.width) || 0;
                let area = state.unit === 'm' ? l * w : (l / 100) * (w / 100);
                setState(p => ({ ...p, ping: (area * 0.3025).toFixed(1) }));
            }, [state.length, state.width, state.unit]);

            const calculate = () => {
                const p = parseFloat(state.ping);
                if(!p || p <= 0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆå°ºå¯¸');
                let kcalBase = 450, mult = 1.0, conds = [];
                if (state.conditions.westSun) { mult += 0.2; conds.push('è¥¿æ›¬'); }
                if (state.conditions.allDaySun) { mult += 0.3; conds.push('å…¨æ—¥æ›¬'); }
                if (state.conditions.topFloor) { mult += 0.2; conds.push('é ‚æ¨“/å¹³æˆ¿'); }
                if (state.conditions.highCeiling) { mult += 0.2; conds.push('æŒ‘é«˜'); }
                if (state.conditions.blackIron) { mult += 0.8; conds.push('é»‘éµçš®'); }
                else if (state.conditions.ironSheet) { mult += 0.5; conds.push('éµçš®'); }
                
                const totalKcal = kcalBase * mult * p;
                const kw = (totalKcal / 860).toFixed(2);
                const tons = (totalKcal / 2500).toFixed(1);
                
                setState(pState => ({ ...pState, result: { kw, tons } }));
                addToHistory(`è² è¼‰è¨ˆç®—: ${p}åª / ${kw}KW`, 'capacity', { kw, tons, ping: p, conditions: conds });
            };

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-4 text-white">
                            <h2 className="text-yellow-400 font-bold flex items-center gap-2 text-sm"><Icon name="ruler" className="w-4 h-4" /> ç©ºé–“è² è¼‰è©¦ç®—</h2>
                            <button onClick={()=>setState({ unit: 'm', length: '', width: '', ping: 0, conditions: {}, result: null })} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="flex bg-industrial-950 p-1 rounded-xl mb-4 text-[10px] font-bold">
                            {['m', 'cm'].map(u => <button key={u} onClick={() => setState(p=>({...p, unit:u}))} className={`flex-1 py-1.5 rounded-lg transition-all ${state.unit===u ? 'bg-industrial-700 text-white shadow-md' : 'text-gray-500'}`}>{u==='m'?'å…¬å°º':'å…¬åˆ†'}</button>)}
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value={state.length} onChange={e=>setState(p=>({...p, length:e.target.value}))} placeholder="é•·åº¦" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-white text-sm" />
                            <input type="number" value={state.width} onChange={e=>setState(p=>({...p, width:e.target.value}))} placeholder="å¯¬åº¦" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-white text-sm" />
                        </div>
                        <div className="text-center mb-6 py-4 bg-industrial-950/50 rounded-2xl border border-industrial-700/50">
                            <div className="text-4xl font-mono font-bold text-white">{state.ping}</div>
                            <div className="text-[10px] text-gray-500 mt-1 uppercase tracking-widest font-bold">åªæ•¸ Area</div>
                        </div>
                        <div className="grid grid-cols-2 gap-2 mb-6">
                            {Object.entries({ westSun:'ğŸŒ è¥¿æ›¬', allDaySun:'â˜€ï¸ å…¨æ—¥æ›¬', topFloor:'ğŸ  é ‚æ¨“/å¹³æˆ¿', highCeiling:'ğŸ“ æŒ‘é«˜(>3m)', ironSheet:'ğŸ­ éµçš®å±‹', blackIron:'ğŸ”¥ é»‘è‰²éµçš®' }).map(([k, l]) => (
                                <label key={k} className={`flex items-center space-x-2 bg-industrial-900 p-2.5 rounded-xl border border-industrial-700 cursor-pointer transition-all ${k==='ironSheet' && state.conditions.blackIron ? 'opacity-20 pointer-events-none' : 'hover:border-industrial-accent'}`}>
                                    <input type="checkbox" checked={!!state.conditions[k]} onChange={()=>{
                                        const next = { ...state.conditions, [k]: !state.conditions[k] };
                                        if (k==='blackIron' && next.blackIron) next.ironSheet = false;
                                        if (k==='ironSheet' && next.ironSheet) next.blackIron = false;
                                        setState(p=>({...p, conditions: next}));
                                    }} className="rounded text-industrial-accent" />
                                    <span className="text-[10px] font-bold text-white">{l}</span>
                                </label>
                            ))}
                        </div>
                        <button onClick={calculate} className="w-full py-4 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm">è¨ˆç®—å†·æˆ¿èƒ½åŠ›</button>
                    </div>

                    {state.result && (
                        <div className="bg-industrial-900 rounded-2xl p-5 border border-yellow-600/50 animate-slide-up shadow-2xl relative overflow-hidden text-center">
                             <div className="absolute top-0 left-0 w-full h-1 bg-yellow-600"></div>
                             <div className="flex justify-center items-end gap-3 text-white">
                                 <div><div className="text-3xl font-mono font-bold">{state.result.kw}</div><div className="text-[9px] text-yellow-500 font-bold uppercase">KW</div></div>
                                 <div className="text-gray-600 pb-2">/</div>
                                 <div><div className="text-2xl font-mono font-bold">{state.result.tons}</div><div className="text-[9px] text-yellow-500 font-bold uppercase">å™¸ (Tons)</div></div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        function RefrigerantCalculator({ state, setState, addToHistory }) {
            const calculate = () => {
                const total = parseFloat(state.totalLen);
                if (isNaN(total) || total < 0) return alert('è«‹è¼¸å…¥ç®¡é•·æ•¸å€¼');
                const res = Math.max(0, Math.round((total - state.baseLen) * state.gramPerMeter));
                setState(p=>({...p, result: res}));
                addToHistory(`è£œå†·åª’: ${res}g / ${total}m`, 'calc', { baseLen: state.baseLen, totalLen: total, result: res });
            };
            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-6 text-white">
                            <h2 className="text-green-400 font-bold flex items-center gap-2 text-sm"><Icon name="calculator" className="w-4 h-4" /> å†·åª’è£œå¡«é‡è¨ˆç®—</h2>
                            <button onClick={()=>setState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null })} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="space-y-5">
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">åŸå» åŸºæº–é•·åº¦ (m)</label><div className="flex gap-2">{[5, 8].map(l => <button key={l} onClick={()=>setState(p=>({...p, baseLen:l}))} className={`flex-1 py-3 rounded-xl text-xs font-bold border transition-all ${state.baseLen===l ? 'bg-green-600 border-green-500 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{l}m</button>)}</div></div>
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">æ¯ç±³è£œå……é‡ (g/m)</label><div className="grid grid-cols-3 gap-2">{[15, 20, 30].map(v => <button key={v} onClick={()=>setState(p=>({...p, gramPerMeter:v}))} className={`py-3 rounded-xl text-xs font-bold border transition-all ${state.gramPerMeter===v ? 'bg-green-600 border-green-500 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{v}g</button>)}</div></div>
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold text-center uppercase tracking-widest">å¯¦éš›æ–½å·¥ç¸½ç®¡é•· (m)</label><input type="number" value={state.totalLen} onChange={e=>setState(p=>({...p, totalLen:e.target.value}))} className="w-full text-3xl py-4 bg-industrial-900 border-2 border-industrial-700 focus:border-green-500 rounded-2xl text-center text-white font-mono shadow-inner" placeholder="0" /></div>
                            <button onClick={calculate} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm flex items-center justify-center gap-2"><Icon name="calculator" className="w-4 h-4" /> é–‹å§‹è¨ˆç®—è£œå……é‡</button>
                        </div>
                        {state.result !== null && (
                            <div className="mt-6 bg-industrial-900 rounded-2xl p-4 border border-green-600/30 text-center animate-fade-in">
                                <span className="block text-gray-500 text-[10px] mb-1 uppercase font-bold tracking-widest">å»ºè­°è£œå……é‡</span>
                                <div className="text-4xl font-mono font-bold text-green-400">{state.result} <span className="text-sm">g</span></div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function CoolingTimeCalculator({ state, setState, addToHistory }) {
            const calculate = () => {
                const { ping, height, currentTemp, targetTemp, acKw } = state;
                const p = parseFloat(ping), h = parseFloat(height), kw = parseFloat(acKw), ct = parseFloat(currentTemp), tt = parseFloat(targetTemp);
                const dt = ct - tt;
                if (!p || !kw || isNaN(dt) || dt <= 0) return alert('è«‹ç¢ºèªæ•¸å€¼ï¼ˆç›®æ¨™æº«åº¦éœ€ä½æ–¼å®¤æº«ï¼‰');
                const time = Math.round(((p * 3.3 * h) * 1.2 * 1.0 * dt * 10) / kw / 60);
                setState(pS => ({...pS, minutes: time}));
                addToHistory(`é™æº«ä¼°ç®—: ${time} åˆ†é˜`, 'cooling', { ping: p, height: h, acKw: kw, minutes: time, currentTemp: ct, targetTemp: tt });
            };
            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-4 text-white">
                            <h2 className="text-purple-400 font-bold flex items-center gap-2 text-sm"><Icon name="thermometer" className="w-4 h-4" /> ç‰©ç†é™æº«æ¨¡æ“¬</h2>
                            <button onClick={()=>setState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null })} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="grid grid-cols-2 gap-3 mb-4">
                            <div className="relative"><span className="absolute left-3 top-0 text-[8px] text-gray-500 uppercase font-bold">åªæ•¸ Area</span><input type="number" value={state.ping} onChange={e=>setState(p=>({...p, ping:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div>
                            <div className="relative"><span className="absolute left-3 top-0 text-[8px] text-gray-500 uppercase font-bold">é«˜åº¦ Height</span><input type="number" value={state.height} onChange={e=>setState(p=>({...p, height:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-white text-sm" /></div>
                        </div>
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            <div className="relative"><span className="absolute left-3 top-0 text-[8px] text-red-500 uppercase font-bold">å®¤æº« Â°C</span><input type="number" value={state.currentTemp} onChange={e=>setState(p=>({...p, currentTemp:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-red-300 text-sm" /></div>
                            <div className="relative"><span className="absolute left-3 top-0 text-[8px] text-blue-500 uppercase font-bold">ç›®æ¨™ Â°C</span><input type="number" value={state.targetTemp} onChange={e=>setState(p=>({...p, targetTemp:e.target.value}))} className="w-full bg-industrial-900 border border-industrial-700 rounded-xl pt-4 pb-2 text-center text-blue-300 text-sm" /></div>
                        </div>
                        <div className="mb-6">
                            <label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest text-center">å†·æ°£åˆ¶å†·èƒ½åŠ› (KW)</label>
                            <input type="number" value={state.acKw} onChange={e=>setState(p=>({...p, acKw:e.target.value}))} className="w-full bg-industrial-900 border-2 border-industrial-700 focus:border-purple-500 rounded-2xl p-4 text-center text-white font-bold text-xl shadow-inner" placeholder="ä¾‹å¦‚: 3.6" />
                        </div>
                        <button onClick={calculate} className="w-full py-4 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm">åŸ·è¡Œæ•¸æ“šæ¨¡æ“¬</button>
                    </div>
                    {state.minutes !== null && (
                        <div className="bg-industrial-900 rounded-2xl p-5 border border-purple-600/50 text-center animate-slide-up relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-purple-600"></div>
                             <div className="text-gray-500 text-[10px] uppercase font-bold tracking-widest">é è¨ˆé™æº«è€—æ™‚</div>
                             <div className="text-5xl font-mono font-bold text-purple-400 my-2">{state.minutes} <span className="text-sm font-sans text-gray-400 uppercase">min</span></div>
                        </div>
                    )}
                </div>
            );
        }

        function DuctedCalculator({ state, setState, addToHistory }) {
            const calculate = () => {
                const fw = parseFloat(state.flangeW), fh = parseFloat(state.flangeH);
                if (!fw || !fh) return alert('è«‹è¼¸å…¥æ³•è˜­å°ºå¯¸');
                const area = fw * fh;
                let size = state.spaceType === 'square' ? 10 : 8, qty = 2, pType = "æ¨™æº–é›†é¢¨ç®±", note = "";
                if (fh < 20) { pType = "ä¸‰è§’å½¢é›†é¢¨ç®±"; size = 8; qty = 2; note = "æ³•è˜­é«˜åº¦éçª„ï¼Œå»ºè­°ä¸‰è§’å½¢é›†é¢¨ç®±é… 8 å‹å­”ã€‚"; }
                else { qty = Math.max(2, Math.ceil(area / (Math.PI * Math.pow((size*2.54/2), 2) * 0.9))); }
                if ([0, 2, 6, 8].includes(state.unitPos) && state.spaceType === 'long') note = "è§’è½è§’è½å®‰è£ä¸”ç©ºé–“é•·ï¼Œéœ€ç¸®å°å­”å¾‘æå‡å°„ç¨‹ã€‚";
                
                const res = { holeSize: size, holeQty: qty, plenumType: pType, airflowNote: note };
                setState(p => ({ ...p, result: res }));
                
                const stCN = { long: 'é•·è·é›¢', narrow: 'çª„ç©ºé–“', square: 'æ–¹å½¢' };
                addToHistory(`åŠéš±: ${fw}x${fh} / ${qty}å­”`, 'ducted', { flangeW: fw, flangeH: fh, holeSize: size, holeQty: qty, plenumType: pType, spaceTypeCN: stCN[state.spaceType] });
            };
            return (
                <div className="animate-fade-in space-y-4 pb-10">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-6 text-white">
                            <h2 className="text-blue-400 font-bold flex items-center gap-2 text-sm"><Icon name="box" className="w-4 h-4" /> åŠéš±å¼å‡ºé¢¨é…ç½®</h2>
                            <button onClick={()=>setState({ flangeW:'', flangeH:'', spaceType:'long', unitPos:4, result:null })} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="space-y-6">
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">1. æ³•è˜­é‡æ¸¬ (cm)</label><div className="grid grid-cols-2 gap-3"><input type="number" value={state.flangeW} onChange={e=>setState(p=>({...p, flangeW:e.target.value}))} placeholder="å¯¬åº¦" className="w-full bg-industrial-900 border border-industrial-700 rounded-xl py-3 text-center text-white text-sm" /><input type="number" value={state.flangeH} onChange={e=>setState(p=>({...p, flangeH:e.target.value}))} placeholder="é«˜åº¦" className="w-full bg-industrial-900 border border-industrial-700 rounded-xl py-3 text-center text-white text-sm" /></div></div>
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">2. ç©ºé–“å‹æ…‹æ¢ä»¶</label><div className="grid grid-cols-3 gap-2">{[{id:'long',l:'é•·'},{id:'narrow',l:'çª„'},{id:'square',l:'æ–¹'}].map(t => <button key={t.id} onClick={()=>setState(p=>({...p, spaceType:t.id}))} className={`p-2 rounded-xl border text-[10px] font-bold ${state.spaceType===t.id ? 'bg-blue-600 border-blue-400 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{t.l}</button>)}</div></div>
                            <div>
                                <label className="text-[10px] text-gray-500 mb-2 block font-bold text-center uppercase tracking-widest">3. ä¸»æ©Ÿä½ç½®é¸æ“‡</label>
                                <div className="bg-industrial-950 p-4 rounded-2xl flex justify-center">
                                    <div className="grid grid-cols-3 gap-2 w-40">
                                        {[...Array(9)].map((_, i) => (
                                            <button key={i} type="button" onClick={() => setState(p => ({ ...p, unitPos: i }))} className={`grid-pos-btn ${state.unitPos === i ? 'active' : 'bg-industrial-900'}`}>
                                                {i===4 && <Icon name="air-vent" className="w-3 h-3" />}
                                                {state.unitPos===i && i!==4 && <Icon name="check" className="w-3 h-3" />}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <button onClick={calculate} className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm flex items-center justify-center gap-2"><Icon name="zap" className="w-4 h-4" /> ç”Ÿæˆé…ç½®å»ºè­°</button>
                        </div>
                    </div>
                    {state.result && (
                        <div className="bg-industrial-900 rounded-2xl p-5 border border-blue-600/50 animate-slide-up shadow-2xl relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-blue-600"></div>
                             <div className="grid grid-cols-2 gap-4 text-white">
                                 <div className="text-center border-r border-industrial-700 font-mono"><div className="text-gray-500 text-[10px] mb-1 font-bold">å»ºè­°å­”æ•¸</div><div className="text-3xl font-bold">{state.result.holeQty} <span className="text-xs text-blue-500 font-sans">å­”</span></div></div>
                                 <div className="text-center font-mono"><div className="text-gray-500 text-[10px] mb-1 font-bold">å­”å¾‘å¤§å°</div><div className="text-3xl font-bold">{state.result.holeSize} <span className="text-xs text-blue-500 font-sans">å‹</span></div></div>
                                 <div className="col-span-2 bg-industrial-800/50 p-3 rounded-xl text-[10px] leading-relaxed text-gray-400 border border-industrial-700/50"><span className="text-blue-400 font-bold block mb-1 uppercase tracking-widest">âš ï¸ æ–½å·¥æŒ‡å—:</span>- {state.result.plenumType}<br/>- {state.result.airflowNote || "ä¿æŒæ¨™æº– 8 å‹ä»¥ä¸Šé…ç½®å¯ç¢ºä¿æœ€ä½³æ•ˆèƒ½ã€‚"}</div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
