<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾ç¥ç©ºèª¿å¹«æ‰‹ | å°ˆæ¥­å†·æ°£å¸«å‚…å·¥å…·ç®±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        // --- åŸºæœ¬é˜²è­·è…³æœ¬ (é˜²å›å­) ---
        document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
        document.addEventListener('keydown', function(e) {
            if(e.keyCode == 123) { e.preventDefault(); return false; }
            if(e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'i' || e.key === 'j')) { e.preventDefault(); return false; }
            if(e.ctrlKey && (e.key === 'U' || e.key === 'u')) { e.preventDefault(); return false; }
        });

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        industrial: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                            accent: '#f59e0b',
                            text: '#e2e8f0',
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            user-select: none;
            -webkit-user-select: none;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input { user-select: auto; -webkit-user-select: auto; }
        
        .grid-pos-btn {
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #334155;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .grid-pos-btn.active {
            background-color: #f59e0b;
            color: #0f172a;
            border-color: #f59e0b;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- æ¨¡æ“¬è³‡æ–™åº« ---
        const AC_DATABASE = [
            { id: 'daikin-001', brand: 'Daikin', brandCN: 'å¤§é‡‘', model: 'RXV36UVLT', type: 'å†·æš–è®Šé »', pipes: '2åˆ† / 3åˆ†', dims: 'å¯¬825 x é«˜283 x æ·±233 mm', power: '220V / 4.5A', refrigerant: 'R32' },
            { id: 'hitachi-001', brand: 'Hitachi', brandCN: 'æ—¥ç«‹', model: 'RAC-40NK', type: 'å†·å°ˆè®Šé »', pipes: '2åˆ† / 4åˆ†', dims: 'å¯¬900 x é«˜300 x æ·±250 mm', power: '220V / 5.2A', refrigerant: 'R410A' },
            { id: 'panasonic-001', brand: 'Panasonic', brandCN: 'åœ‹éš›ç‰Œ', model: 'CU-PX28FCA2', type: 'å†·æš–æ——è‰¦', pipes: '2åˆ† / 3åˆ†', dims: 'å¯¬780 x é«˜290 x æ·±240 mm', power: '220V / 3.8A', refrigerant: 'R32' },
            { id: 'midea-001', brand: 'Midea', brandCN: 'ç¾çš„', model: 'MV-36HP', type: 'å®šé »å†·æ°£', pipes: '3åˆ† / 5åˆ†', dims: 'å¯¬850 x é«˜270 x æ·±220 mm', power: '220V / 6.0A', refrigerant: 'R410A' },
            { id: 'teco-001', brand: 'TECO', brandCN: 'æ±å…ƒ', model: 'MA-28IH-ZR', type: 'è®Šé »å†·æš–', pipes: '2åˆ† / 3åˆ†', dims: 'å¯¬815 x é«˜275 x æ·±210 mm', power: '110V / 8.5A', refrigerant: 'R32' }
        ];

        function ResultCard({ item }) {
            return (
                <div className="bg-industrial-800 rounded-xl p-5 border border-industrial-700 shadow-lg relative overflow-hidden group hover:border-industrial-accent transition-colors animate-fade-in">
                    <div className="absolute top-0 left-0 w-1 h-full bg-industrial-accent"></div>
                    <div className="flex justify-between items-start mb-3">
                        <div>
                            <span className="text-xs font-bold text-industrial-accent uppercase tracking-wider bg-industrial-900 px-2 py-1 rounded">
                                {item.brandCN} / {item.brand}
                            </span>
                            <h3 className="text-xl font-bold mt-2 font-mono">{item.model}</h3>
                        </div>
                        <div className="text-right">
                            <span className={`inline-block px-2 py-1 text-xs rounded font-bold ${item.type.includes('æš–') ? 'bg-red-900 text-red-200' : 'bg-blue-900 text-blue-200'}`}>
                                {item.type}
                            </span>
                        </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4 text-sm mt-4 pt-4 border-t border-industrial-700">
                        <div>
                            <span className="block text-gray-500 text-xs mb-1">éŠ…ç®¡è¦æ ¼</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="circle-dot" className="w-3 h-3"></i> {item.pipes}
                            </span>
                        </div>
                        <div>
                            <span className="block text-gray-500 text-xs mb-1">é›»æºè¦æ ¼</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="zap" className="w-3 h-3"></i> {item.power}
                            </span>
                        </div>
                        <div className="col-span-2 text-xs">å°ºå¯¸: {item.dims} | å†·åª’: {item.refrigerant}</div>
                    </div>
                </div>
            );
        }

        function App() {
            const [activeTab, setActiveTab] = useState('search'); 
            const [history, setHistory] = useState([]);
            const [selectedHistoryItem, setSelectedHistoryItem] = useState(null);

            // --- ç‹€æ…‹æŒä¹…åŒ– ---
            const [searchState, setSearchState] = useState({ term: '', results: [] });
            const [capacityState, setCapacityState] = useState({
                unit: 'm', length: '', width: '', ping: 0,
                conditions: { westSun: false, allDaySun: false, topFloor: false, highCeiling: false, ironSheet: false, blackIron: false },
                result: null
            });
            const [refrigerantState, setRefrigerantState] = useState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null });
            const [coolingState, setCoolingState] = useState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null });
            
            // åŠéš±å¼ç‹€æ…‹
            const [ductedState, setDuctedState] = useState({
                flangeW: '', flangeH: '', 
                spaceType: 'long', // long, narrow, square
                unitPos: 4, // 0-8 ä»£è¡¨ä¹å®®æ ¼
                result: null
            });

            useEffect(() => {
                const savedHistory = localStorage.getItem('yiGeHistory');
                if (savedHistory) setHistory(JSON.parse(savedHistory));
            }, []);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, searchState, history, selectedHistoryItem, ductedState]);

            const addToHistory = useCallback((title, type, data = {}) => {
                const newEntry = { id: Date.now(), title, type, date: new Date().toLocaleString(), data };
                const newHistory = [newEntry, ...history].slice(0, 20);
                setHistory(newHistory);
                localStorage.setItem('yiGeHistory', JSON.stringify(newHistory));
            }, [history]);

            const clearHistory = () => {
                if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ')) {
                    setHistory([]);
                    localStorage.removeItem('yiGeHistory');
                }
            };

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    <header className="bg-industrial-900 border-b border-industrial-700 sticky top-0 z-50">
                        <div className="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <i data-lucide="wrench" className="text-industrial-accent w-6 h-6"></i>
                                <h1 className="text-xl font-bold tracking-wider">é¾ç¥<span className="text-industrial-accent">ç©ºèª¿</span>å¹«æ‰‹</h1>
                            </div>
                            <div className="text-xs text-industrial-600 font-mono border border-industrial-700 px-2 py-1 rounded">V1.5</div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-md mx-auto w-full p-4 pb-24 relative">
                        {activeTab === 'search' && (
                            <div className="animate-fade-in">
                                <div className="relative mb-6">
                                    <div className="relative">
                                        <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i data-lucide="search" className="text-gray-400 w-5 h-5"></i>
                                        </div>
                                        <input
                                            type="text"
                                            className="block w-full pl-10 pr-10 py-3 border border-industrial-600 rounded-lg bg-industrial-800 text-gray-100 focus:outline-none focus:border-industrial-accent"
                                            placeholder="è¼¸å…¥å“ç‰Œæˆ–å‹è™Ÿ..."
                                            value={searchState.term}
                                            onChange={(e) => {
                                                const term = e.target.value;
                                                const lowerTerm = term.toLowerCase();
                                                const results = term ? AC_DATABASE.filter(item => 
                                                    item.brand.toLowerCase().includes(lowerTerm) || item.brandCN.includes(lowerTerm) || item.model.toLowerCase().includes(lowerTerm)
                                                ) : [];
                                                setSearchState({ term, results });
                                            }}
                                        />
                                        {searchState.term && (
                                            <button onClick={() => setSearchState({ term: '', results: [] })} className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white">
                                                <i data-lucide="x" className="w-5 h-5"></i>
                                            </button>
                                        )}
                                    </div>
                                </div>
                                <div className="space-y-4">
                                    {searchState.term && searchState.results.length === 0 ? (
                                        <div className="text-center py-10 text-gray-500"><p>æ‰¾ä¸åˆ°ç¬¦åˆ "{searchState.term}" çš„è³‡æ–™</p></div>
                                    ) : (
                                        searchState.results.map(item => <ResultCard key={item.id} item={item} />)
                                    )}
                                    {!searchState.term && (
                                        <div className="text-center py-10">
                                            <p className="text-industrial-600 mb-4 text-sm font-bold">ç†±é–€å“ç‰ŒæŸ¥è©¢</p>
                                            <div className="flex flex-wrap justify-center gap-2">
                                                {['å¤§é‡‘', 'æ—¥ç«‹', 'åœ‹éš›ç‰Œ', 'TECO'].map(brand => (
                                                    <button 
                                                        key={brand}
                                                        onClick={() => {
                                                            const results = AC_DATABASE.filter(item => item.brandCN.includes(brand));
                                                            setSearchState({ term: brand, results });
                                                        }}
                                                        className="px-4 py-1.5 bg-industrial-800 border border-industrial-700 rounded-full text-xs hover:border-industrial-accent transition"
                                                    >
                                                        {brand}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'capacity' && <CapacityCalculator state={capacityState} setState={setCapacityState} addToHistory={addToHistory} />}
                        {activeTab === 'calc' && <RefrigerantCalculator state={refrigerantState} setState={setRefrigerantState} addToHistory={addToHistory} />}
                        {activeTab === 'cooling' && <CoolingTimeCalculator state={coolingState} setState={setCoolingState} addToHistory={addToHistory} />}
                        {activeTab === 'ducted' && <DuctedCalculator state={ductedState} setState={setDuctedState} addToHistory={addToHistory} />}

                        {activeTab === 'history' && (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">æ“ä½œç´€éŒ„</h2>
                                    {history.length > 0 && (
                                        <button onClick={clearHistory} className="text-xs text-red-400 flex items-center gap-1 border border-red-900 bg-red-900/20 px-2 py-1 rounded">
                                            <i data-lucide="trash-2" className="w-3 h-3"></i> æ¸…é™¤
                                        </button>
                                    )}
                                </div>
                                {history.length === 0 ? (
                                    <div className="text-center py-12 text-gray-500"><p>å°šç„¡æ“ä½œç´€éŒ„</p></div>
                                ) : (
                                    <div className="space-y-3">
                                        {history.map(item => (
                                            <div key={item.id} onClick={() => setSelectedHistoryItem(item)} className="bg-industrial-800 p-4 rounded-lg border-l-4 border-industrial-600 flex justify-between items-center cursor-pointer hover:bg-industrial-700 transition group">
                                                <div>
                                                    <span className="text-gray-500 text-[10px] block">{item.date}</span>
                                                    <div className="text-sm font-mono text-gray-200">{item.title}</div>
                                                </div>
                                                <i data-lucide="chevron-right" className="text-gray-600 group-hover:text-industrial-accent w-4 h-4"></i>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {selectedHistoryItem && (
                            <div className="fixed inset-0 z-[60] flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in">
                                <div className="absolute inset-0 bg-black/70 backdrop-blur-sm" onClick={() => setSelectedHistoryItem(null)}></div>
                                <div className="bg-industrial-900 w-full max-w-md rounded-t-2xl sm:rounded-2xl border border-industrial-700 shadow-2xl overflow-hidden flex flex-col max-h-[85vh]">
                                    <div className="p-4 border-b border-industrial-700 flex justify-between items-center bg-industrial-800">
                                        <h3 className="text-lg font-bold">æ­·å²è©³ç´°å…§å®¹</h3>
                                        <button onClick={() => setSelectedHistoryItem(null)} className="p-1 text-gray-400 hover:text-white"><i data-lucide="x"></i></button>
                                    </div>
                                    <div className="p-5 overflow-y-auto text-sm">
                                        {selectedHistoryItem.type === 'search' && selectedHistoryItem.data?.results?.map(item => <ResultCard key={item.id} item={item} />)}
                                        {selectedHistoryItem.type === 'calc' && (
                                            <div className="bg-industrial-800 p-6 rounded-xl border border-industrial-700 text-center">
                                                <div className="text-gray-500 text-xs mb-2">éœ€è£œå……å†·åª’é‡</div>
                                                <div className="text-5xl font-mono font-bold text-green-400">{selectedHistoryItem.data?.result} <span className="text-lg">g</span></div>
                                            </div>
                                        )}
                                        {selectedHistoryItem.type === 'ducted' && (
                                            <div className="space-y-4">
                                                <div className="bg-industrial-800 p-6 rounded-xl border border-industrial-700 text-center">
                                                    <div className="text-gray-500 text-xs mb-2">å»ºè­°å­”æ•¸èˆ‡å­”å¾‘</div>
                                                    <div className="text-3xl font-mono font-bold text-blue-400">
                                                        {selectedHistoryItem.data?.holeQty} å­” x {selectedHistoryItem.data?.holeSize}"
                                                    </div>
                                                </div>
                                                <div className="bg-industrial-950 p-4 rounded-lg text-xs leading-loose">
                                                    <div className="text-industrial-accent font-bold mb-1">æ–½å·¥æ¢ä»¶å›é¡§:</div>
                                                    <div>- æ³•è˜­å°ºå¯¸: {selectedHistoryItem.data?.flangeW}x{selectedHistoryItem.data?.flangeH} cm</div>
                                                    <div>- ç©ºé–“é¡å‹: {selectedHistoryItem.data?.spaceTypeCN}</div>
                                                    <div>- é›†é¢¨ç®±é¡å‹: {selectedHistoryItem.data?.plenumType}</div>
                                                </div>
                                            </div>
                                        )}
                                        {/* å…¶ä»–é¡å‹çœç•¥... */}
                                    </div>
                                    <div className="p-4 border-t border-industrial-700 bg-industrial-800">
                                        <button onClick={() => setSelectedHistoryItem(null)} className="w-full py-3 bg-industrial-700 text-white rounded-lg font-bold">é—œé–‰</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 w-full bg-industrial-900 border-t border-industrial-700 pb-safe z-40">
                        <div className="max-w-md mx-auto grid grid-cols-5 h-16">
                            <NavButton active={activeTab === 'search'} onClick={() => setActiveTab('search')} icon="search" label="æœå°‹" />
                            <NavButton active={activeTab === 'capacity'} onClick={() => setActiveTab('capacity')} icon="ruler" label="è² è¼‰" />
                            <NavButton active={activeTab === 'calc'} onClick={() => setActiveTab('calc')} icon="calculator" label="å†·åª’" />
                            <NavButton active={activeTab === 'ducted'} onClick={() => setActiveTab('ducted')} icon="box" label="åŠéš±" />
                            <NavButton active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon="history" label="ç´€éŒ„" />
                        </div>
                    </nav>
                </div>
            );
        }

        // --- NEW: åŠéš±å¼å‡ºé¢¨è¨ˆç®—å…ƒä»¶ ---
        function DuctedCalculator({ state, setState, addToHistory }) {
            const { flangeW, flangeH, spaceType, unitPos, result } = state;

            const calculate = () => {
                const fw = parseFloat(flangeW), fh = parseFloat(flangeH);
                if (!fw || !fh) return alert('è«‹è¼¸å…¥å®Œæ•´çš„æ³•è˜­é•·å¯¬');

                const area = fw * fh;
                let holeSize = 8; // é è¨­ 8 è‹±å‹
                let holeQty = 2;
                let plenumType = "æ¨™æº–æ–¹å½¢é›†é¢¨ç®±";
                let airflowNote = "";

                // 1. ç©ºé–“é¡å‹æ±ºå®šå­”å¾‘å‚¾å‘
                if (spaceType === 'square') holeSize = 10; // æ–¹å½¢ç©ºé–“é€šå¸¸é–‹å¤§å­” (é¢¨é‡å»£)
                if (spaceType === 'long' || spaceType === 'narrow') holeSize = 8; // é•·/çª„ç©ºé–“å»ºè­°å°å­” (é¢¨é€Ÿå¿«ã€æ‰“å¾—é )

                // 2. ç‰¹æ®Šæƒ…æ³ï¼šæ³•è˜­é«˜åº¦éå° (ä¸‰è§’å½¢é›†é¢¨ç®±è¦å‰‡)
                if (fh < 20) {
                    plenumType = "ä¸‰è§’å½¢é›†é¢¨ç®± (æ³•è˜­éçª„å»ºè­°)";
                    holeSize = 8;
                    holeQty = 2;
                    airflowNote = "æ³•è˜­å°ºå¯¸ä¸è¶³ï¼Œå¼·åˆ¶æ¡ç”¨ä¸‰è§’å½¢é›†é¢¨ç®±é…é›™ 8 å‹å­”ã€‚";
                } else {
                    // æ¨™æº–è¨ˆç®—: ä¸€å€‹ 8 å‹å­”é¢ç©ç´„ç‚º 324 cm2, 10 å‹ç´„ 506 cm2
                    const singleHoleArea = Math.PI * Math.pow((holeSize * 2.54 / 2), 2);
                    holeQty = Math.max(2, Math.ceil(area / (singleHoleArea * 0.9))); // ç¨å¾®ç•™é»é¤˜è£•
                }

                // 3. æ ¹æ“šä½ç½®èª¿æ•´å»ºè­°
                // 0, 2, 6, 8 ç‚ºè§’è½; 4 ç‚ºä¸­å¿ƒ; 1, 3, 5, 7 ç‚ºé‚Šç·£
                const isCorner = [0, 2, 6, 8].includes(unitPos);
                const isCenter = unitPos === 4;

                if (isCorner && spaceType === 'long') {
                    airflowNote = "è§’è½å®‰è£ä¸”ç‚ºé•·è·é›¢ç©ºé–“ï¼šå»ºè­°ç¸®å°å­”å¾‘ï¼ˆç¶­æŒ 8 å‹ï¼‰ä»¥æå‡æœ«ç«¯é¢¨é€Ÿã€‚";
                } else if (isCenter && spaceType === 'square') {
                    airflowNote = "ä¸­å¿ƒå®‰è£ä¸”ç‚ºæ–¹å½¢ç©ºé–“ï¼šå»ºè­°åŠ å¤§å­”å¾‘ï¼ˆ10~12 å‹ï¼‰ä»¥è¿½æ±‚å»£åŸŸæ“´æ•£ã€‚";
                    if (fw > 100) holeSize = 10;
                }

                const res = { holeSize, holeQty, plenumType, airflowNote, area };
                setState(p => ({ ...p, result: res }));

                const stCN = { long: 'é•·è·é›¢', narrow: 'çª„ç©ºé–“', square: 'æ–¹å½¢ç©ºé–“' };
                addToHistory(`åŠéš±è¨ˆç®—: ${fw}x${fh} | å»ºè­° ${holeQty}å­”x${holeSize}"`, 'ducted', {
                    flangeW: fw, flangeH: fh, holeSize, holeQty, plenumType, spaceTypeCN: stCN[spaceType]
                });
            };

            const reset = () => {
                setState({ flangeW: '', flangeH: '', spaceType: 'long', unitPos: 4, result: null });
            };

            return (
                <div className="animate-fade-in space-y-4 pb-10">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-lg font-bold text-blue-400 flex items-center gap-2"><i data-lucide="box" className="w-5 h-5"></i> åŠéš±å¼å‡ºé¢¨é…ç½®</h2>
                            <button onClick={reset} className="text-xs bg-industrial-700 px-2 py-1 rounded">é‡ç½®</button>
                        </div>

                        <div className="space-y-6">
                            {/* 1. æ³•è˜­å°ºå¯¸ */}
                            <div>
                                <label className="text-xs text-gray-500 mb-2 block font-bold uppercase">1. å‡ºé¢¨å£æ³•è˜­å°ºå¯¸ (cm)</label>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="relative">
                                        <span className="absolute left-3 top-2 text-[10px] text-gray-500 uppercase">å¯¬ Width</span>
                                        <input type="number" value={flangeW} onChange={e=>setState(p=>({...p, flangeW:e.target.value}))} className="w-full pt-6 pb-2 px-3 bg-industrial-900 border border-industrial-600 rounded text-center text-white text-xl font-mono" placeholder="0" />
                                    </div>
                                    <div className="relative">
                                        <span className="absolute left-3 top-2 text-[10px] text-gray-500 uppercase">é«˜ Height</span>
                                        <input type="number" value={flangeH} onChange={e=>setState(p=>({...p, flangeH:e.target.value}))} className="w-full pt-6 pb-2 px-3 bg-industrial-900 border border-industrial-600 rounded text-center text-white text-xl font-mono" placeholder="0" />
                                    </div>
                                </div>
                            </div>

                            {/* 2. ç©ºé–“é¡å‹ */}
                            <div>
                                <label className="text-xs text-gray-500 mb-2 block font-bold uppercase">2. ç©ºé–“é¡å‹æ¢ä»¶</label>
                                <div className="grid grid-cols-3 gap-2">
                                    {[
                                        { id: 'long', l: 'é•·è·é›¢', desc: 'é€é¢¨é ' },
                                        { id: 'narrow', l: 'çª„ç©ºé–“', desc: 'é¢¨é“æ·±' },
                                        { id: 'square', l: 'æ–¹å½¢ç©ºé–“', desc: 'ç¯„åœå»£' }
                                    ].map(t => (
                                        <button key={t.id} onClick={()=>setState(p=>({...p, spaceType:t.id}))} className={`p-2 rounded border transition ${spaceType===t.id ? 'bg-blue-600 border-blue-400 text-white' : 'bg-industrial-900 border-industrial-700 text-gray-400'}`}>
                                            <div className="text-xs font-bold">{t.l}</div>
                                            <div className="text-[10px] opacity-60">{t.desc}</div>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* 3. ä½ç½®é¸æ“‡ (åœ–å½¢åŒ–æŒ‰éˆ•) */}
                            <div>
                                <label className="text-xs text-gray-500 mb-2 block font-bold uppercase">3. ä¸»æ©Ÿæ–¼ç©ºé–“ä½ç½®</label>
                                <div className="bg-industrial-950 p-4 rounded-lg flex justify-center">
                                    <div className="grid grid-cols-3 gap-2 w-48">
                                        {[...Array(9)].map((_, i) => (
                                            <button 
                                                key={i} 
                                                onClick={() => setState(p => ({ ...p, unitPos: i }))}
                                                className={`grid-pos-btn ${unitPos === i ? 'active' : 'bg-industrial-900'}`}
                                            >
                                                {i === 4 ? <i data-lucide="air-vent" className="w-4 h-4"></i> : null}
                                                {unitPos === i && i !== 4 ? <i data-lucide="check" className="w-4 h-4"></i> : null}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div className="text-[10px] text-center text-gray-500 mt-2">é»é¸æ–¹æ ¼ä»£è¡¨ä¸»æ©Ÿä½ç½®</div>
                            </div>

                            <button onClick={calculate} className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center gap-2">
                                <i data-lucide="zap" className="w-5 h-5"></i> é–‹å§‹è¨ˆç®—é…ç½®
                            </button>
                        </div>
                    </div>

                    {result && (
                        <div className="bg-industrial-900 rounded-xl p-5 border border-blue-600/50 animate-slide-up relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-blue-600"></div>
                             <div className="grid grid-cols-2 gap-4">
                                 <div className="text-center border-r border-industrial-700">
                                     <div className="text-gray-500 text-[10px] mb-1">å»ºè­°å­”æ•¸</div>
                                     <div className="text-4xl font-mono font-bold text-white">{result.holeQty} <span className="text-xs text-blue-500">å­”</span></div>
                                 </div>
                                 <div className="text-center">
                                     <div className="text-gray-500 text-[10px] mb-1">å»ºè­°å­”å¾‘</div>
                                     <div className="text-4xl font-mono font-bold text-white">{result.holeSize}<span className="text-xs text-blue-500">"</span></div>
                                 </div>
                                 <div className="col-span-2 bg-industrial-800 p-3 rounded text-xs leading-relaxed">
                                     <div className="flex items-center gap-2 text-blue-400 font-bold mb-1">
                                         <i data-lucide="info" className="w-3 h-3"></i> å¸«å‚…æ–½å·¥å»ºè­°ï¼š
                                     </div>
                                     <div>- {result.plenumType}</div>
                                     <div className="mt-1 text-gray-300 italic">{result.airflowNote || "å»ºè­°æ¡ç”¨ 8" ä»¥ä¸Šé…ç½®ä»¥ç¶­æŒå‡ºé¢¨æ•ˆèƒ½ã€‚"}</div>
                                 </div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- å…¶ä»–å…ƒä»¶ (è¤‡ç”¨å…ˆå‰é‚è¼¯ä¸¦å„ªåŒ–) ---
        function CapacityCalculator({ state, setState, addToHistory }) {
            const { unit, length, width, ping, conditions, result } = state;
            useEffect(() => {
                const l = parseFloat(length) || 0, w = parseFloat(width) || 0;
                let areaM2 = unit === 'm' ? l * w : (l / 100) * (w / 100);
                setState(prev => ({ ...prev, ping: (areaM2 * 0.3025).toFixed(1) }));
            }, [length, width, unit]);
            const calculate = () => {
                if(ping <= 0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆé•·å¯¬');
                let baseKcal = 450, multiplier = 1.0, conditionList = [];
                if (conditions.westSun) { multiplier += 0.2; conditionList.push('è¥¿æ›¬'); }
                if (conditions.allDaySun) { multiplier += 0.3; conditionList.push('ç™½å¤©æ—¥æ›¬'); }
                if (conditions.topFloor) { multiplier += 0.2; conditionList.push('é ‚æ¨“/å¹³æˆ¿'); }
                if (conditions.highCeiling) { multiplier += 0.2; conditionList.push('æŒ‘é«˜'); } 
                if (conditions.blackIron) { multiplier += 0.8; conditionList.push('é»‘è‰²éµçš®'); } 
                else if (conditions.ironSheet) { multiplier += 0.5; conditionList.push('ä¸€èˆ¬éµçš®'); }
                const totalKcal = baseKcal * multiplier * ping;
                const kw = (totalKcal / 860).toFixed(2), tons = (totalKcal / 2500).toFixed(1);
                setState(prev => ({ ...prev, result: { kw, tons } }));
                addToHistory(`è² è¼‰è¨ˆç®—: ${ping}åª / éœ€ ${kw} KW`, 'capacity', { ping, conditions: conditionList, kw, tons });
            };
            const reset = () => setState({ unit: 'm', length: '', width: '', ping: 0, conditions: { westSun: false, allDaySun: false, topFloor: false, highCeiling: false, ironSheet: false, blackIron: false }, result: null });
            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-4"><h2 className="text-lg font-bold flex items-center gap-2 text-yellow-400"><i data-lucide="ruler"></i> ç©ºé–“è² è¼‰è©¦ç®—</h2><button onClick={reset} className="text-xs bg-industrial-700 px-2 py-1 rounded">é‡ç½®</button></div>
                        <div className="flex bg-industrial-900 rounded-lg p-1 mb-4">{['m', 'cm'].map(u => <button key={u} onClick={() => setState(p=>({...p, unit:u}))} className={`flex-1 py-1 text-sm rounded transition ${unit===u ? 'bg-industrial-700 text-white' : 'text-gray-500'}`}>{u === 'm' ? 'å…¬å°º' : 'å…¬åˆ†'}</button>)}</div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value={length} onChange={e=>setState(p=>({...p, length:e.target.value}))} placeholder="é•·åº¦" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" />
                            <input type="number" value={width} onChange={e=>setState(p=>({...p, width:e.target.value}))} placeholder="å¯¬åº¦" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" />
                        </div>
                        <div className="text-center mb-6 py-2 bg-industrial-900/50 rounded border border-industrial-700/50"><div className="text-3xl font-mono font-bold text-white">{ping} <span className="text-sm text-gray-500">åª</span></div></div>
                        <div className="grid grid-cols-2 gap-2 mb-6">
                            {Object.entries({ westSun:'ğŸŒ è¥¿æ›¬', allDaySun:'â˜€ï¸ ç™½å¤©æ—¥æ›¬', topFloor:'ğŸ  é ‚æ¨“/å¹³æˆ¿', highCeiling:'ğŸ“ æŒ‘é«˜(>3m)', ironSheet:'ğŸ­ éµçš®å±‹', blackIron:'ğŸ”¥ é»‘è‰²éµçš®' }).map(([k, l]) => (
                                <label key={k} className={`flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer ${k === 'ironSheet' && conditions.blackIron ? 'opacity-30' : ''}`}>
                                    <input type="checkbox" checked={conditions[k]} onChange={()=>{
                                        const newState = { ...conditions, [k]: !conditions[k] };
                                        if (k === 'blackIron' && newState.blackIron) newState.ironSheet = false;
                                        if (k === 'ironSheet' && newState.ironSheet) newState.blackIron = false;
                                        setState(p=>({...p, conditions: newState}));
                                    }} disabled={k === 'ironSheet' && conditions.blackIron} className="rounded text-industrial-accent" /><span className="text-[10px]">{l}</span>
                                </label>
                            ))}
                        </div>
                        <button onClick={calculate} className="w-full py-3 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-lg shadow-lg">è¨ˆç®—å†·æˆ¿èƒ½åŠ›</button>
                    </div>
                </div>
            );
        }

        function RefrigerantCalculator({ state, setState, addToHistory }) {
            const { baseLen, totalLen, gramPerMeter, result } = state;
            const calculate = () => {
                const total = parseFloat(totalLen);
                if (isNaN(total) || total < 0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆç®¡é•·');
                const addAmount = Math.max(0, Math.round((total - baseLen) * gramPerMeter));
                setState(p=>({...p, result: addAmount}));
                addToHistory(`å†·åª’è¨ˆç®—: éœ€è£œ ${addAmount}g`, 'calc', { baseLen, totalLen: total, result: addAmount });
            };
            const reset = () => setState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null });
            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-6"><h2 className="text-lg font-bold text-green-400 flex items-center gap-2"><i data-lucide="scale"></i> å†·åª’è£œå……é‡è¨ˆç®—</h2><button onClick={reset} className="text-xs bg-industrial-700 px-2 py-1 rounded">é‡ç½®</button></div>
                        <div className="space-y-4">
                            <div><label className="text-xs text-gray-500 mb-1 block">åŸå» åŸºæº–é•·åº¦ (m)</label><div className="flex gap-2">{[5, 8].map(l => <button key={l} onClick={()=>setState(p=>({...p, baseLen:l}))} className={`flex-1 py-2 rounded text-sm font-bold border ${baseLen===l ? 'bg-green-600 border-green-500 text-white' : 'bg-industrial-900 border-industrial-600 text-gray-400'}`}>{l}m</button>)}</div></div>
                            <div><label className="text-xs text-gray-500 mb-1 block">æ¯ç±³è£œå……é‡ (g/m)</label><div className="grid grid-cols-3 gap-2">{[15, 20, 30].map(v => <button key={v} onClick={()=>setState(p=>({...p, gramPerMeter:v}))} className={`py-2 rounded text-sm font-bold border ${gramPerMeter===v ? 'bg-green-600 border-green-500 text-white' : 'bg-industrial-900 border-industrial-600 text-gray-400'}`}>{v}g</button>)}</div></div>
                            <div><label className="text-xs text-gray-500 mb-1 block">å¯¦éš›ç®¡é•· (m)</label><input type="number" value={totalLen} onChange={e=>setState(p=>({...p, totalLen:e.target.value}))} className="w-full text-2xl py-3 px-4 bg-industrial-900 border-2 border-industrial-600 focus:border-green-500 rounded-lg text-center" /></div>
                            <button onClick={calculate} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg shadow-lg flex items-center justify-center gap-2"><i data-lucide="calculator"></i> é–‹å§‹è¨ˆç®—</button>
                        </div>
                    </div>
                </div>
            );
        }

        function CoolingTimeCalculator({ state, setState, addToHistory }) {
            const { ping, height, currentTemp, targetTemp, acKw, minutes } = state;
            const calculate = () => {
                const p = parseFloat(ping), h = parseFloat(height), kw = parseFloat(acKw), dt = currentTemp - targetTemp;
                if (!p || !kw || dt <= 0) return alert('è«‹æª¢æŸ¥æ•¸å€¼');
                const totalLoadKJ = (p * 3.3058 * h) * 1.2 * 1.005 * dt * 10;
                const timeMinutes = Math.round((totalLoadKJ / kw) / 60);
                setState(p=>({...p, minutes: timeMinutes}));
                addToHistory(`é™æº«ä¼°ç®—: ${p}åª / ç´„ ${timeMinutes} åˆ†é˜`, 'cooling', { ping: p, height: h, currentTemp, targetTemp, acKw: kw, minutes: timeMinutes });
            };
            const reset = () => setState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null });
            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-4"><h2 className="text-lg font-bold flex items-center gap-2 text-purple-400"><i data-lucide="thermometer"></i> é™æº«æ™‚é–“ä¼°ç®—</h2><button onClick={reset} className="text-xs bg-industrial-700 px-2 py-1 rounded">é‡ç½®</button></div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value={ping} onChange={e=>setState(p=>({...p, ping:e.target.value}))} placeholder="åªæ•¸" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" />
                            <input type="number" value={height} onChange={e=>setState(p=>({...p, height:e.target.value}))} placeholder="é«˜åº¦(m)" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" step="0.1" />
                        </div>
                        <button onClick={calculate} className="w-full py-3 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-lg shadow-lg">é–‹å§‹æ¨¡æ“¬è¨ˆç®—</button>
                    </div>
                </div>
            );
        }

        function NavButton({ active, onClick, icon, label }) {
            return (
                <button onClick={onClick} className={`flex flex-col items-center justify-center w-full h-full transition-colors ${active ? 'text-industrial-accent' : 'text-gray-500 hover:text-gray-300'}`}>
                    <i data-lucide={icon} className={`w-5 h-5 mb-1 ${active ? 'fill-current/20' : ''}`}></i>
                    <span className="text-[10px] font-bold">{label}</span>
                </button>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
