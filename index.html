<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾ç¥ç©ºèª¿å¹«æ‰‹ | å°ˆæ¥­å†·æ°£å¸«å‚…å·¥å…·ç®±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        industrial: {
                            900: '#0f172a', // æ·±éµç°èƒŒæ™¯
                            800: '#1e293b', // å¡ç‰‡èƒŒæ™¯
                            700: '#334155', // é‚Šæ¡†
                            600: '#475569', // æ¬¡è¦æ–‡å­—
                            accent: '#f59e0b', // å·¥ç¨‹é»ƒ (è­¦ç¤º/æŒ‰éˆ•)
                            text: '#e2e8f0', // ä¸»è¦æ–‡å­—
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        /* è‡ªå®šç¾©æ²è»¸ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ç®­é ­ */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- æ¨¡æ“¬è³‡æ–™åº« (Mock Data) ---
        const AC_DATABASE = [
            {
                id: 'daikin-001',
                brand: 'Daikin',
                brandCN: 'å¤§é‡‘',
                model: 'RXV36UVLT',
                type: 'å†·æš–è®Šé »',
                pipes: '2åˆ† / 3åˆ†',
                dims: 'å¯¬825 x é«˜283 x æ·±233 mm',
                power: '220V / 4.5A',
                refrigerant: 'R32'
            },
            {
                id: 'hitachi-001',
                brand: 'Hitachi',
                brandCN: 'æ—¥ç«‹',
                model: 'RAC-40NK',
                type: 'å†·å°ˆè®Šé »',
                pipes: '2åˆ† / 4åˆ†',
                dims: 'å¯¬900 x é«˜300 x æ·±250 mm',
                power: '220V / 5.2A',
                refrigerant: 'R410A'
            },
            {
                id: 'panasonic-001',
                brand: 'Panasonic',
                brandCN: 'åœ‹éš›ç‰Œ',
                model: 'CU-PX28FCA2',
                type: 'å†·æš–æ——è‰¦',
                pipes: '2åˆ† / 3åˆ†',
                dims: 'å¯¬780 x é«˜290 x æ·±240 mm',
                power: '220V / 3.8A',
                refrigerant: 'R32'
            },
            {
                id: 'midea-001',
                brand: 'Midea',
                brandCN: 'ç¾çš„',
                model: 'MV-36HP',
                type: 'å®šé »å†·æ°£',
                pipes: '3åˆ† / 5åˆ†',
                dims: 'å¯¬850 x é«˜270 x æ·±220 mm',
                power: '220V / 6.0A',
                refrigerant: 'R410A'
            },
             {
                id: 'teco-001',
                brand: 'TECO',
                brandCN: 'æ±å…ƒ',
                model: 'MA-28IH-ZR',
                type: 'è®Šé »å†·æš–',
                pipes: '2åˆ† / 3åˆ†',
                dims: 'å¯¬815 x é«˜275 x æ·±210 mm',
                power: '110V / 8.5A',
                refrigerant: 'R32'
            }
        ];

        // --- å…±ç”¨å…ƒä»¶: æ©Ÿå‹å¡ç‰‡ ---
        function ResultCard({ item }) {
            return (
                <div className="bg-industrial-800 rounded-xl p-5 border border-industrial-700 shadow-lg relative overflow-hidden group hover:border-industrial-accent transition-colors">
                    <div className="absolute top-0 left-0 w-1 h-full bg-industrial-accent"></div>
                    <div className="flex justify-between items-start mb-3">
                        <div>
                            <span className="text-xs font-bold text-industrial-accent uppercase tracking-wider bg-industrial-900 px-2 py-1 rounded">
                                {item.brandCN} / {item.brand}
                            </span>
                            <h3 className="text-xl font-bold mt-2 font-mono">{item.model}</h3>
                        </div>
                        <div className="text-right">
                            <span className={`inline-block px-2 py-1 text-xs rounded font-bold ${item.type.includes('æš–') ? 'bg-red-900 text-red-200' : 'bg-blue-900 text-blue-200'}`}>
                                {item.type}
                            </span>
                        </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4 text-sm mt-4 pt-4 border-t border-industrial-700">
                        <div>
                            <span className="block text-gray-500 text-xs mb-1">éŠ…ç®¡è¦æ ¼</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="circle-dot" className="w-3 h-3"></i> {item.pipes}
                            </span>
                        </div>
                        <div>
                            <span className="block text-gray-500 text-xs mb-1">é›»æºè¦æ ¼</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="zap" className="w-3 h-3"></i> {item.power}
                            </span>
                        </div>
                        <div className="col-span-2">
                            <span className="block text-gray-500 text-xs mb-1">æ©Ÿé«”å°ºå¯¸</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="box" className="w-3 h-3"></i> {item.dims}
                            </span>
                        </div>
                            <div className="col-span-2">
                            <span className="block text-gray-500 text-xs mb-1">å†·åª’ç¨®é¡</span>
                            <span className="font-mono text-white">{item.refrigerant}</span>
                        </div>
                    </div>
                </div>
            );
        }

        // --- æ‡‰ç”¨ç¨‹å¼ä¸»å…ƒä»¶ ---
        function App() {
            const [activeTab, setActiveTab] = useState('search'); 
            const [searchTerm, setSearchTerm] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [history, setHistory] = useState([]);
            const [selectedHistoryItem, setSelectedHistoryItem] = useState(null);

            useEffect(() => {
                const savedHistory = localStorage.getItem('yiGeHistory');
                if (savedHistory) {
                    setHistory(JSON.parse(savedHistory));
                }
                if (window.lucide) window.lucide.createIcons();
            }, []);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, searchResults, selectedHistoryItem, history, searchTerm]);

            const getSearchResults = (term) => {
                if (!term) return [];
                const lowerTerm = term.toLowerCase();
                return AC_DATABASE.filter(item => 
                    item.brand.toLowerCase().includes(lowerTerm) ||
                    item.brandCN.includes(lowerTerm) ||
                    item.model.toLowerCase().includes(lowerTerm)
                );
            };

            const handleSearch = (term) => {
                setSearchTerm(term);
                const results = getSearchResults(term);
                setSearchResults(results);
            };

            const triggerSearchAndSave = () => {
                if (searchTerm) {
                    const currentResults = getSearchResults(searchTerm);
                    addToHistory(`æœå°‹: ${searchTerm}`, 'search', { 
                        term: searchTerm, 
                        results: currentResults 
                    });
                }
            };

            const addToHistory = (title, type, data = {}) => {
                const newEntry = {
                    id: Date.now(),
                    title: title,
                    type: type, 
                    date: new Date().toLocaleString(),
                    data: data 
                };
                const newHistory = [newEntry, ...history].slice(0, 20);
                setHistory(newHistory);
                localStorage.setItem('yiGeHistory', JSON.stringify(newHistory));
            };

            const clearHistory = () => {
                if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ')) {
                    setHistory([]);
                    localStorage.removeItem('yiGeHistory');
                }
            };

            // ä¾æ“šé¡å‹æ¸²æŸ“ä¸åŒçš„åœ–ç¤º
            const renderHistoryIcon = (type) => {
                switch(type) {
                    case 'calc': return <i data-lucide="calculator" className="text-green-400 w-5 h-5"></i>;
                    case 'search': return <i data-lucide="search" className="text-blue-400 w-5 h-5"></i>;
                    case 'capacity': return <i data-lucide="ruler" className="text-yellow-400 w-5 h-5"></i>;
                    case 'cooling': return <i data-lucide="thermometer" className="text-purple-400 w-5 h-5"></i>;
                    default: return <i data-lucide="file" className="text-gray-400 w-5 h-5"></i>;
                }
            };

            // ä¾æ“šé¡å‹æ¸²æŸ“ä¸åŒçš„æ¨™ç±¤
            const renderHistoryBadge = (type) => {
                switch(type) {
                    case 'calc': return <span className="bg-green-900 text-green-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">å†·åª’</span>;
                    case 'search': return <span className="bg-blue-900 text-blue-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">æœå°‹</span>;
                    case 'capacity': return <span className="bg-yellow-900 text-yellow-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">è² è¼‰</span>;
                    case 'cooling': return <span className="bg-purple-900 text-purple-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">é™æº«</span>;
                    default: return null;
                }
            };

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    <header className="bg-industrial-900 border-b border-industrial-700 sticky top-0 z-50">
                        <div className="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <i data-lucide="wrench" className="text-industrial-accent w-6 h-6"></i>
                                <h1 className="text-xl font-bold tracking-wider">
                                    é¾ç¥<span className="text-industrial-accent">ç©ºèª¿</span>å¹«æ‰‹
                                </h1>
                            </div>
                            <div className="text-xs text-industrial-600 font-mono border border-industrial-700 px-2 py-1 rounded">
                                V1.1
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-md mx-auto w-full p-4 pb-24 relative">
                        
                        {/* Tab Content: Search */}
                        {activeTab === 'search' && (
                            <div className="animate-fade-in">
                                <div className="relative mb-6">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i data-lucide="search" className="text-gray-400 w-5 h-5"></i>
                                    </div>
                                    <input
                                        type="text"
                                        className="block w-full pl-10 pr-10 py-3 border border-industrial-600 rounded-lg leading-5 bg-industrial-800 text-gray-100 placeholder-gray-500 focus:outline-none focus:border-industrial-accent focus:ring-1 focus:ring-industrial-accent sm:text-sm transition-colors"
                                        placeholder="è¼¸å…¥å“ç‰Œ (å¦‚:å¤§é‡‘) æˆ– å‹è™Ÿ..."
                                        value={searchTerm}
                                        onChange={(e) => handleSearch(e.target.value)}
                                        onKeyDown={(e) => {
                                            if (e.key === 'Enter') {
                                                triggerSearchAndSave();
                                            }
                                        }}
                                    />
                                    {searchTerm && (
                                        <button
                                            onClick={() => handleSearch('')}
                                            className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white transition-colors"
                                            title="æ¸…é™¤æœå°‹"
                                        >
                                            <i data-lucide="x" className="w-5 h-5"></i>
                                        </button>
                                    )}
                                </div>
                                <div className="space-y-4">
                                    {searchTerm && searchResults.length === 0 ? (
                                        <div className="text-center py-10 text-gray-500">
                                            <i data-lucide="archive-x" className="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                            <p>æ‰¾ä¸åˆ°ç¬¦åˆ "{searchTerm}" çš„è³‡æ–™</p>
                                        </div>
                                    ) : (
                                        searchResults.map(item => <ResultCard key={item.id} item={item} />)
                                    )}
                                    {!searchTerm && (
                                        <div className="text-center py-10">
                                            <p className="text-industrial-600 mb-4">è¼¸å…¥å“ç‰Œæˆ–å‹è™Ÿé–‹å§‹æŸ¥è©¢</p>
                                            <div className="flex flex-wrap justify-center gap-2">
                                                {['å¤§é‡‘', 'æ—¥ç«‹', 'åœ‹éš›ç‰Œ', 'TECO'].map(brand => (
                                                    <button 
                                                        key={brand}
                                                        onClick={() => {
                                                            setSearchTerm(brand);
                                                            const results = getSearchResults(brand);
                                                            setSearchResults(results);
                                                            addToHistory(`æœå°‹: ${brand}`, 'search', { term: brand, results: results });
                                                        }}
                                                        className="px-3 py-1 bg-industrial-800 border border-industrial-600 rounded-full text-sm hover:bg-industrial-700 transition"
                                                    >
                                                        {brand}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Tab Content: Capacity Calculator (NEW åŠŸèƒ½) */}
                        {activeTab === 'capacity' && (
                            <CapacityCalculator addToHistory={addToHistory} />
                        )}

                        {/* Tab Content: Refrigerant Calculator (åŠŸèƒ½ B) */}
                        {activeTab === 'calc' && (
                            <Calculator addToHistory={addToHistory} />
                        )}

                        {/* Tab Content: Cooling Time Calculator (NEW åŠŸèƒ½) */}
                        {activeTab === 'cooling' && (
                            <CoolingTimeCalculator addToHistory={addToHistory} />
                        )}

                        {/* Tab Content: History (åŠŸèƒ½ D) */}
                        {activeTab === 'history' && (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">æ“ä½œç´€éŒ„</h2>
                                    {history.length > 0 && (
                                        <button 
                                            onClick={clearHistory}
                                            className="text-xs text-red-400 hover:text-red-300 flex items-center gap-1 border border-red-900 bg-red-900/20 px-2 py-1 rounded"
                                        >
                                            <i data-lucide="trash-2" className="w-3 h-3"></i> æ¸…é™¤
                                        </button>
                                    )}
                                </div>

                                {history.length === 0 ? (
                                    <div className="text-center py-12 text-gray-500">
                                        <i data-lucide="history" className="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                        <p>å°šç„¡æ“ä½œç´€éŒ„</p>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {history.map(item => (
                                            <div 
                                                key={item.id} 
                                                onClick={() => setSelectedHistoryItem(item)}
                                                className="bg-industrial-800 p-4 rounded-lg border-l-4 border-industrial-600 flex justify-between items-center cursor-pointer hover:bg-industrial-700 transition-colors group"
                                            >
                                                <div>
                                                    <div className="flex items-center gap-2 mb-1">
                                                        {renderHistoryBadge(item.type)}
                                                        <span className="text-gray-400 text-xs">{item.date}</span>
                                                    </div>
                                                    <div className="text-sm font-mono text-gray-200">{item.title}</div>
                                                </div>
                                                <i data-lucide="chevron-right" className="text-gray-600 group-hover:text-industrial-accent w-5 h-5"></i>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {/* History Detail Modal */}
                        {selectedHistoryItem && (
                            <div className="fixed inset-0 z-[60] flex items-end sm:items-center justify-center p-0 sm:p-4">
                                <div 
                                    className="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
                                    onClick={() => setSelectedHistoryItem(null)}
                                ></div>
                                <div className="bg-industrial-900 w-full max-w-md rounded-t-2xl sm:rounded-2xl border border-industrial-700 shadow-2xl overflow-hidden transform transition-all animate-slide-up flex flex-col max-h-[85vh]">
                                    <div className="p-4 border-b border-industrial-700 flex justify-between items-center bg-industrial-800">
                                        <h3 className="text-lg font-bold flex items-center gap-2">
                                            {renderHistoryIcon(selectedHistoryItem.type)}
                                            è©³ç´°ç´€éŒ„
                                        </h3>
                                        <button 
                                            onClick={() => setSelectedHistoryItem(null)}
                                            className="p-1 rounded-full hover:bg-industrial-700 text-gray-400 hover:text-white"
                                        >
                                            <i data-lucide="x" className="w-6 h-6"></i>
                                        </button>
                                    </div>

                                    <div className="p-5 overflow-y-auto text-sm">
                                        <div className="mb-4 text-xs text-gray-500 flex items-center gap-1">
                                            <i data-lucide="clock" className="w-3 h-3"></i>
                                            è¨˜éŒ„æ™‚é–“: {selectedHistoryItem.date}
                                        </div>

                                        {/* Render Logic based on type */}
                                        {selectedHistoryItem.type === 'search' && (
                                            <div>
                                                <div className="mb-4">
                                                    <span className="text-gray-500 text-sm">æœå°‹é—œéµå­—ï¼š</span>
                                                    <span className="text-industrial-accent font-bold text-lg ml-2">{selectedHistoryItem.data?.term}</span>
                                                </div>
                                                <h4 className="text-sm font-bold text-gray-300 mb-3 border-b border-industrial-700 pb-1">ç•¶æ™‚æœå°‹çµæœ</h4>
                                                <div className="space-y-3">
                                                    {selectedHistoryItem.data?.results?.map(item => (
                                                        <div key={item.id} className="scale-95 origin-left w-full"><ResultCard item={item} /></div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}

                                        {selectedHistoryItem.type === 'calc' && (
                                            <div className="space-y-4">
                                                <div className="bg-industrial-800 p-4 rounded-lg border border-industrial-700">
                                                    <span className="block text-gray-500 text-xs mb-1">è¨ˆç®—çµæœ (éœ€è£œå……)</span>
                                                    <div className="text-4xl font-mono font-bold text-green-400 flex items-baseline gap-2">
                                                        {selectedHistoryItem.data?.result} <span className="text-sm text-gray-400">g</span>
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-3 text-sm">
                                                    <div className="bg-industrial-950 p-3 rounded border border-industrial-800">
                                                        <span className="block text-gray-500 text-xs mb-1">å¯¦éš›ç®¡é•·</span>
                                                        <span className="text-white font-mono">{selectedHistoryItem.data?.totalLen} m</span>
                                                    </div>
                                                    <div className="bg-industrial-950 p-3 rounded border border-industrial-800">
                                                        <span className="block text-gray-500 text-xs mb-1">åŸå» åŸºæº–</span>
                                                        <span className="text-white font-mono">{selectedHistoryItem.data?.baseLen} m</span>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {selectedHistoryItem.type === 'capacity' && (
                                            <div className="space-y-4">
                                                <div className="bg-industrial-800 p-4 rounded-lg border border-industrial-700">
                                                    <span className="block text-gray-500 text-xs mb-1">å»ºè­°èƒ½åŠ›</span>
                                                    <div className="text-3xl font-mono font-bold text-yellow-400">
                                                        {selectedHistoryItem.data?.kw} KW
                                                    </div>
                                                    <div className="text-gray-400 text-sm">
                                                        ç´„ {selectedHistoryItem.data?.tons} é “
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div className="bg-industrial-950 p-2 rounded">åªæ•¸: {selectedHistoryItem.data?.ping} åª</div>
                                                    <div className="bg-industrial-950 p-2 rounded">ä¿‚æ•¸: +{Math.round((selectedHistoryItem.data?.multiplier - 1)*100)}%</div>
                                                </div>
                                                <div className="text-xs text-gray-400 mt-2">
                                                    æ¢ä»¶: {selectedHistoryItem.data?.conditions?.join(', ') || 'ç„¡ç‰¹æ®Šæ¢ä»¶'}
                                                </div>
                                            </div>
                                        )}

                                        {selectedHistoryItem.type === 'cooling' && (
                                            <div className="space-y-4">
                                                <div className="bg-industrial-800 p-4 rounded-lg border border-industrial-700">
                                                    <span className="block text-gray-500 text-xs mb-1">ä¼°è¨ˆé™æº«æ™‚é–“</span>
                                                    <div className="text-3xl font-mono font-bold text-purple-400">
                                                        {selectedHistoryItem.data?.minutes} åˆ†é˜
                                                    </div>
                                                </div>
                                                <div className="bg-industrial-950 p-3 rounded border border-industrial-800">
                                                    <div>æº«å·®: {selectedHistoryItem.data?.deltaT}Â°C</div>
                                                    <div>ç©ºé–“: {selectedHistoryItem.data?.ping} åª (é«˜ {selectedHistoryItem.data?.height}m)</div>
                                                    <div>å†·æ°£èƒ½åŠ›: {selectedHistoryItem.data?.acKw} KW</div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    
                                    <div className="p-4 border-t border-industrial-700 bg-industrial-800">
                                        <button 
                                            onClick={() => setSelectedHistoryItem(null)}
                                            className="w-full py-3 bg-industrial-700 hover:bg-industrial-600 text-white rounded-lg font-bold transition"
                                        >
                                            é—œé–‰
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                    </main>

                    <nav className="fixed bottom-0 w-full bg-industrial-900 border-t border-industrial-700 pb-safe z-40">
                        <div className="max-w-md mx-auto grid grid-cols-5 h-16">
                            <NavButton active={activeTab === 'search'} onClick={() => setActiveTab('search')} icon="search" label="æœå°‹" />
                            <NavButton active={activeTab === 'capacity'} onClick={() => setActiveTab('capacity')} icon="ruler" label="è² è¼‰" />
                            <NavButton active={activeTab === 'calc'} onClick={() => setActiveTab('calc')} icon="calculator" label="å†·åª’" />
                            <NavButton active={activeTab === 'cooling'} onClick={() => setActiveTab('cooling')} icon="thermometer" label="é™æº«" />
                            <NavButton active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon="history" label="ç´€éŒ„" />
                        </div>
                    </nav>
                </div>
            );
        }

        // --- NEW: Capacity Calculator (å†·æˆ¿èƒ½åŠ›è©¦ç®—) ---
        function CapacityCalculator({ addToHistory }) {
            const [unit, setUnit] = useState('m'); // m or cm
            const [length, setLength] = useState('');
            const [width, setWidth] = useState('');
            const [ping, setPing] = useState(0);
            
            // ç’°å¢ƒå› å­
            const [conditions, setConditions] = useState({
                westSun: false,
                allDaySun: false, // New: ç™½å¤©éƒ½æœƒæ›¬åˆ°å¤ªé™½
                topFloor: false,
                highCeiling: false,
                ironSheet: false,
                blackIron: false
            });

            const [result, setResult] = useState(null);

            // æ›ç®—åªæ•¸
            useEffect(() => {
                const l = parseFloat(length) || 0;
                const w = parseFloat(width) || 0;
                let areaM2 = 0;

                if (unit === 'm') {
                    areaM2 = l * w;
                } else {
                    areaM2 = (l / 100) * (w / 100);
                }

                // 1 å¹³æ–¹å…¬å°º = 0.3025 åª
                setPing((areaM2 * 0.3025).toFixed(1));
            }, [length, width, unit]);

            const toggleCondition = (key) => {
                setConditions(prev => {
                    const newState = { ...prev, [key]: !prev[key] };
                    // äº’æ–¥é‚è¼¯: å¦‚æœé¸æ“‡é»‘è‰²éµçš®ï¼Œéµçš®å±‹å‰‡ä¸è¨±é¸æ“‡ (å¼·åˆ¶å–æ¶ˆä¸€èˆ¬éµçš®)
                    if (key === 'blackIron' && newState.blackIron) {
                        newState.ironSheet = false;
                    }
                    // åä¹‹äº¦ç„¶ï¼Œå¦‚æœé¸äº†ä¸€èˆ¬éµçš®ï¼Œå–æ¶ˆé»‘è‰²éµçš® (å¯é¸ï¼Œå„ªåŒ– UX)
                    if (key === 'ironSheet' && newState.ironSheet) {
                        newState.blackIron = false;
                    }
                    return newState;
                });
            };

            const calculate = () => {
                if(ping <= 0) {
                    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é•·å¯¬');
                    return;
                }

                // åŸºç¤: 1åªç´„éœ€ 450 kcal/hr
                let baseKcal = 450;
                let multiplier = 1.0;
                let conditionList = [];

                if (conditions.westSun) { multiplier += 0.2; conditionList.push('è¥¿æ›¬'); }
                if (conditions.allDaySun) { multiplier += 0.3; conditionList.push('ç™½å¤©æ—¥æ›¬'); } // ç™½å¤©æ—¥æ›¬åŠ æˆè¼ƒé«˜
                if (conditions.topFloor) { multiplier += 0.2; conditionList.push('é ‚æ¨“'); }
                if (conditions.highCeiling) { multiplier += 0.2; conditionList.push('æŒ‘é«˜'); } 
                
                // éµçš®å±‹åŠ æˆ
                if (conditions.blackIron) { 
                    multiplier += 0.8; conditionList.push('é»‘è‰²éµçš®'); 
                } else if (conditions.ironSheet) {
                    multiplier += 0.5; conditionList.push('ä¸€èˆ¬éµçš®');
                }

                const totalKcalPerPing = baseKcal * multiplier;
                const totalKcal = totalKcalPerPing * ping;
                
                // 1 kW = 860 kcal/hr
                const requiredKW = (totalKcal / 860).toFixed(2);
                
                // å°ç£ä¿—ç¨±å™¸æ•¸ (ç´„2500kcalç‚ºä¸€å™¸)
                const requiredTons = (totalKcal / 2500).toFixed(1);

                setResult({ kw: requiredKW, tons: requiredTons });

                addToHistory(`è² è¼‰è¨ˆç®—: ${ping}åª / éœ€ ${requiredKW} KW`, 'capacity', {
                    ping,
                    conditions: conditionList,
                    multiplier,
                    kw: requiredKW,
                    tons: requiredTons
                });
            };

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                         <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-yellow-400">
                            <i data-lucide="ruler" className="w-5 h-5"></i>
                            ç©ºé–“èˆ‡è² è¼‰è©¦ç®—
                        </h2>
                        
                        {/* å–®ä½åˆ‡æ› */}
                        <div className="flex bg-industrial-900 rounded-lg p-1 mb-4">
                            <button 
                                onClick={() => setUnit('m')}
                                className={`flex-1 py-1 text-sm rounded transition ${unit==='m' ? 'bg-industrial-700 text-white shadow' : 'text-gray-500'}`}
                            >å…¬å°º (m)</button>
                            <button 
                                onClick={() => setUnit('cm')}
                                className={`flex-1 py-1 text-sm rounded transition ${unit==='cm' ? 'bg-industrial-700 text-white shadow' : 'text-gray-500'}`}
                            >å…¬åˆ† (cm)</button>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">é•·åº¦ ({unit})</label>
                                <input 
                                    type="number" 
                                    value={length} 
                                    onChange={(e)=>setLength(e.target.value)} 
                                    className="w-full bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white"
                                />
                            </div>
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">å¯¬åº¦ ({unit})</label>
                                <input 
                                    type="number" 
                                    value={width} 
                                    onChange={(e)=>setWidth(e.target.value)} 
                                    className="w-full bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white"
                                />
                            </div>
                        </div>

                        <div className="text-center mb-6 py-2 bg-industrial-900/50 rounded border border-industrial-700/50">
                            <span className="text-sm text-gray-400">æ›ç®—åªæ•¸</span>
                            <div className="text-3xl font-mono font-bold text-white">{ping} <span className="text-sm text-gray-500">åª</span></div>
                        </div>

                        <div className="space-y-2 mb-6">
                            <label className="text-xs text-gray-500 block mb-2">ç’°å¢ƒç†±æºæ¢ä»¶ (å¯è¤‡é¸)</label>
                            <div className="grid grid-cols-2 gap-2">
                                <label className="flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer hover:bg-industrial-700/50">
                                    <input type="checkbox" checked={conditions.westSun} onChange={()=>toggleCondition('westSun')} className="rounded text-industrial-accent focus:ring-0" />
                                    <span className="text-sm">ğŸŒ è¥¿æ›¬</span>
                                </label>
                                <label className="flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer hover:bg-industrial-700/50">
                                    <input type="checkbox" checked={conditions.allDaySun} onChange={()=>toggleCondition('allDaySun')} className="rounded text-industrial-accent focus:ring-0" />
                                    <span className="text-sm">â˜€ï¸ ç™½å¤©æ—¥æ›¬</span>
                                </label>
                                <label className="flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer hover:bg-industrial-700/50">
                                    <input type="checkbox" checked={conditions.topFloor} onChange={()=>toggleCondition('topFloor')} className="rounded text-industrial-accent focus:ring-0" />
                                    <span className="text-sm">ğŸ  é ‚æ¨“</span>
                                </label>
                                <label className="flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer hover:bg-industrial-700/50">
                                    <input type="checkbox" checked={conditions.highCeiling} onChange={()=>toggleCondition('highCeiling')} className="rounded text-industrial-accent focus:ring-0" />
                                    <span className="text-sm">ğŸ“ æŒ‘é«˜ (>3m)</span>
                                </label>
                                <label className={`flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer ${conditions.blackIron ? 'opacity-50 cursor-not-allowed' : 'hover:bg-industrial-700/50'}`}>
                                    <input 
                                        type="checkbox" 
                                        checked={conditions.ironSheet} 
                                        onChange={() => !conditions.blackIron && toggleCondition('ironSheet')} 
                                        disabled={conditions.blackIron}
                                        className="rounded text-industrial-accent focus:ring-0" 
                                    />
                                    <span className="text-sm">ğŸ­ éµçš®å±‹</span>
                                </label>
                                <label className="flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer hover:bg-industrial-700/50">
                                    <input type="checkbox" checked={conditions.blackIron} onChange={()=>toggleCondition('blackIron')} className="rounded text-industrial-accent focus:ring-0" />
                                    <span className="text-sm">ğŸ”¥ é»‘è‰²éµçš®</span>
                                </label>
                            </div>
                        </div>

                        <button 
                            onClick={calculate}
                            className="w-full py-3 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-lg shadow-lg transition flex items-center justify-center gap-2"
                        >
                            è¨ˆç®—å»ºè­°å†·æˆ¿èƒ½åŠ›
                        </button>
                    </div>

                    {result && (
                        <div className="bg-industrial-900 rounded-lg p-5 border border-yellow-600/50 text-center animate-slide-up relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-yellow-600"></div>
                             <div className="text-sm text-gray-400 mb-2">å»ºè­°å®‰è£è¦æ ¼</div>
                             <div className="flex justify-center items-end gap-4">
                                 <div>
                                    <div className="text-4xl font-bold text-white font-mono">{result.kw}</div>
                                    <div className="text-xs text-yellow-500">KW</div>
                                 </div>
                                 <div className="text-gray-500 pb-2">/</div>
                                 <div>
                                    <div className="text-2xl font-bold text-white font-mono">{result.tons}</div>
                                    <div className="text-xs text-yellow-500">é “ (åƒè€ƒ)</div>
                                 </div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- NEW: Cooling Time Calculator (é™æº«æ™‚é–“ä¼°ç®—) ---
        function CoolingTimeCalculator({ addToHistory }) {
            const [ping, setPing] = useState('');
            const [height, setHeight] = useState(3.0); // é è¨­ 3ç±³
            const [currentTemp, setCurrentTemp] = useState(32);
            const [targetTemp, setTargetTemp] = useState(26);
            const [acKw, setAcKw] = useState('');
            const [resultMinutes, setResultMinutes] = useState(null);

            const calculateTime = () => {
                const p = parseFloat(ping);
                const h = parseFloat(height);
                const kw = parseFloat(acKw);
                const deltaT = parseFloat(currentTemp) - parseFloat(targetTemp);

                if (!p || !kw || deltaT <= 0) {
                    alert('è«‹æª¢æŸ¥è¼¸å…¥æ•¸å€¼ (å†·æ°£èƒ½åŠ›å¿…é ˆå¤§æ–¼0ï¼Œä¸”ç›®æ¨™æº«éœ€ä½æ–¼å®¤æº«)');
                    return;
                }

                // 1. è¨ˆç®—ç©ºé–“é«”ç© (m3)
                // 1åª = 3.3058 m2
                const areaM2 = p * 3.3058;
                const volume = areaM2 * h;

                // 2. ç©ºæ°£ç†±èƒ½è¨ˆç®—
                // ç©ºæ°£å¯†åº¦ ~ 1.2 kg/m3
                // ç©ºæ°£æ¯”ç†± ~ 1.005 kJ/kgÂ·K
                // Q_air (kJ) = m * c * deltaT
                const airMass = volume * 1.2;
                const energyKJ = airMass * 1.005 * deltaT;

                // 3. ç‰†å£/å®¶å…·ç†±è“„ç©ä¿‚æ•¸ (Thermal Mass Factor)
                // ç©ºæ°£é™æº«å¾ˆå¿«ï¼Œä½†ç‰†å£æœƒæŒçºŒæ”¾ç†±ã€‚ç¶“é©—æ³•å‰‡ï¼šè² è¼‰ç´„ç‚ºç©ºæ°£çš„ 8~12å€
                // æˆ‘å€‘å– 10 å€åšç‚ºä¼°ç®—
                const totalLoadKJ = energyKJ * 10; 

                // 4. è¨ˆç®—æ™‚é–“ (å‡è¨­å†·æ°£å…¨é€Ÿé‹è½‰æ•ˆç‡ 100% - ç†æƒ³å€¼ï¼Œå¯¦éš›æœƒæ›´æ…¢)
                // Power (KW) = Energy (kJ) / Time (s)
                // Time (s) = Energy / Power
                const timeSeconds = totalLoadKJ / kw;
                const timeMinutes = Math.round(timeSeconds / 60);

                setResultMinutes(timeMinutes);

                addToHistory(`é™æº«ä¼°ç®—: ${p}åª/${kw}KW -> ç´„ ${timeMinutes} åˆ†é˜`, 'cooling', {
                    ping: p,
                    height: h,
                    deltaT: deltaT,
                    acKw: kw,
                    minutes: timeMinutes
                });
            };

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-purple-400">
                            <i data-lucide="thermometer" className="w-5 h-5"></i>
                            é™æº«æ™‚é–“ä¼°ç®— (ç‰©ç†æ¨¡æ“¬)
                        </h2>
                        
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">ç©ºé–“åªæ•¸</label>
                                <input type="number" value={ping} onChange={(e)=>setPing(e.target.value)} className="w-full bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" placeholder="ä¾‹å¦‚ 5" />
                            </div>
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">å¤©èŠ±æ¿é«˜åº¦ (m)</label>
                                <input type="number" value={height} onChange={(e)=>setHeight(e.target.value)} className="w-full bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" step="0.1" />
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">ç›®å‰å®¤æº« (Â°C)</label>
                                <input type="number" value={currentTemp} onChange={(e)=>setCurrentTemp(e.target.value)} className="w-full bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-red-300" />
                            </div>
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">ç›®æ¨™æº«åº¦ (Â°C)</label>
                                <input type="number" value={targetTemp} onChange={(e)=>setTargetTemp(e.target.value)} className="w-full bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-blue-300" />
                            </div>
                        </div>

                        <div className="mb-6">
                            <label className="text-xs text-gray-500 mb-1 block">å†·æ°£èƒ½åŠ› (KW)</label>
                            <input type="number" value={acKw} onChange={(e)=>setAcKw(e.target.value)} className="w-full bg-industrial-900 border border-industrial-600 rounded p-3 text-center text-white font-bold text-lg" placeholder="ä¾‹å¦‚ 3.6" />
                        </div>

                        <button 
                            onClick={calculateTime}
                            className="w-full py-3 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-lg shadow-lg transition flex items-center justify-center gap-2"
                        >
                            é–‹å§‹æ¨¡æ“¬è¨ˆç®—
                        </button>
                    </div>

                    {resultMinutes !== null && (
                         <div className="bg-industrial-900 rounded-lg p-5 border border-purple-500/50 text-center animate-slide-up relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-purple-500"></div>
                             <div className="text-sm text-gray-400 mb-2">ç†è«–é™æº«æ™‚é–“</div>
                             <div className="text-4xl font-bold text-white font-mono mb-1">{resultMinutes} <span className="text-sm font-sans font-normal text-gray-400">åˆ†é˜</span></div>
                             <div className="text-[10px] text-gray-500">*æ­¤ç‚ºç‰©ç†ä¼°ç®—å€¼ï¼Œå¯¦éš›æƒ…æ³å—éš”ç†±ã€é–€çª—é–‹é—œå½±éŸ¿</div>
                        </div>
                    )}
                </div>
            );
        }

        // --- å­å…ƒä»¶: å†·åª’è¨ˆç®—æ©Ÿ ---
        function Calculator({ addToHistory }) {
            const [baseLen, setBaseLen] = useState(5); 
            const [totalLen, setTotalLen] = useState('');
            const [gramPerMeter, setGramPerMeter] = useState(20); 
            const [result, setResult] = useState(null);

            const calculate = () => {
                const total = parseFloat(totalLen);
                const base = parseFloat(baseLen);
                const rate = parseFloat(gramPerMeter);

                if (isNaN(total) || total < 0) {
                    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„å¯¦éš›ç®¡é•·');
                    return;
                }

                let addAmount = 0;
                if (total > base) {
                    addAmount = (total - base) * rate;
                }
                
                addAmount = Math.round(addAmount);
                setResult(addAmount);

                addToHistory(
                    `è¨ˆç®—: éœ€è£œ ${addAmount}g (ç®¡é•·${total}m)`, 
                    'calc', 
                    { baseLen: base, totalLen: total, gramPerMeter: rate, result: addAmount }
                );
            };

            return (
                <div className="animate-fade-in">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <h2 className="text-lg font-bold mb-6 flex items-center gap-2 text-green-400">
                            <i data-lucide="scale" className="w-5 h-5"></i>
                            å†·åª’è£œå……é‡è¨ˆç®—
                        </h2>
                        
                        <div className="space-y-5">
                            <div>
                                <label className="block text-xs font-bold text-gray-400 mb-1 uppercase">åŸå» åŸºæº–é•·åº¦ (ç±³)</label>
                                <div className="flex items-center gap-2">
                                    <button onClick={()=>setBaseLen(5)} className={`flex-1 py-2 rounded text-sm font-bold border ${baseLen===5 ? 'bg-green-600 text-white border-green-500' : 'bg-industrial-900 border-industrial-600'}`}>5m</button>
                                    <button onClick={()=>setBaseLen(8)} className={`flex-1 py-2 rounded text-sm font-bold border ${baseLen===8 ? 'bg-green-600 text-white border-green-500' : 'bg-industrial-900 border-industrial-600'}`}>8m</button>
                                    <input 
                                        type="number" 
                                        value={baseLen}
                                        onChange={(e)=>setBaseLen(e.target.value)}
                                        className="w-20 py-2 px-3 bg-industrial-900 border border-industrial-600 rounded text-center font-mono"
                                    />
                                </div>
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-gray-400 mb-1 uppercase">æ¯ç±³è£œå……é‡ (g/m)</label>
                                <div className="grid grid-cols-3 gap-2">
                                    {[15, 20, 30].map(val => (
                                        <button 
                                            key={val}
                                            onClick={()=>setGramPerMeter(val)} 
                                            className={`py-2 rounded text-sm font-bold border ${gramPerMeter===val ? 'bg-green-600 text-white border-green-500' : 'bg-industrial-900 border-industrial-600'}`}
                                        >
                                            {val}g
                                        </button>
                                    ))}
                                </div>
                                <div className="mt-2 flex items-center gap-2">
                                     <span className="text-xs text-gray-500">è‡ªè¨‚:</span>
                                     <input 
                                        type="number" 
                                        value={gramPerMeter}
                                        onChange={(e)=>setGramPerMeter(e.target.value)}
                                        className="flex-1 py-1 px-3 bg-industrial-900 border border-industrial-600 rounded text-sm font-mono"
                                        placeholder="è¼¸å…¥å…‹æ•¸"
                                    />
                                </div>
                            </div>

                            <div className="pt-4 border-t border-industrial-700">
                                <label className="block text-sm font-bold text-industrial-accent mb-2 uppercase">å¯¦éš›å®‰è£ç®¡é•· (ç±³)</label>
                                <input 
                                    type="number" 
                                    value={totalLen}
                                    onChange={(e)=>setTotalLen(e.target.value)}
                                    placeholder="ä¾‹å¦‚: 12.5"
                                    className="w-full text-2xl py-3 px-4 bg-industrial-900 border-2 border-industrial-600 focus:border-green-500 rounded-lg font-mono text-center outline-none"
                                />
                            </div>

                            <button 
                                onClick={calculate}
                                className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg shadow-lg transform active:scale-95 transition flex items-center justify-center gap-2"
                            >
                                <i data-lucide="calculator" className="w-5 h-5"></i>
                                é–‹å§‹è¨ˆç®—
                            </button>
                        </div>

                        {result !== null && (
                            <div className="mt-6 bg-industrial-900 rounded-lg p-4 border border-industrial-600 text-center animate-bounce-in">
                                <span className="block text-gray-500 text-xs mb-1">éœ€è£œå……å†·åª’é‡</span>
                                <div className="text-4xl font-mono font-bold text-green-400">
                                    {result} <span className="text-lg">g</span>
                                </div>
                                <div className="text-xs text-gray-600 mt-2">
                                    å…¬å¼: (å¯¦éš›é•· {totalLen}m - åŸºæº– {baseLen}m) Ã— {gramPerMeter}g
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- å­å…ƒä»¶: å°èˆªæŒ‰éˆ• ---
        function NavButton({ active, onClick, icon, label }) {
            return (
                <button 
                    onClick={onClick}
                    className={`flex flex-col items-center justify-center w-full h-full transition-colors ${active ? 'text-industrial-accent' : 'text-gray-500 hover:text-gray-300'}`}
                >
                    <i data-lucide={icon} className={`w-6 h-6 mb-1 ${active ? 'fill-current/20' : ''}`}></i>
                    <span className="text-[10px] font-bold">{label}</span>
                </button>
            );
        }

        // Render
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
