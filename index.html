<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾ç¥ç©ºèª¿å¹«æ‰‹ | å°ˆæ¥­å†·æ°£å¸«å‚…å·¥å…·ç®±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        // --- é˜²æŠ„è¥²èˆ‡å³éµä¿è­· ---
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                return false;
            }
        });

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        industrial: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                            accent: '#f59e0b',
                            text: '#e2e8f0',
                        }
                    },
                    animation: { 'fade-in': 'fadeIn 0.3s ease-out', 'slide-up': 'slideUp 0.3s ease-out' },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(15px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; user-select: none; -webkit-user-select: none; font-family: sans-serif; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input { user-select: auto; -webkit-user-select: auto; outline: none; }
        .grid-pos-btn { aspect-ratio: 1/1; border: 1px solid #334155; display: flex; align-items: center; justify-content: center; border-radius: 6px; }
        .grid-pos-btn.active { background-color: #f59e0b; color: #0f172a; border-color: #f59e0b; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- æ¨¡æ“¬è³‡æ–™åº« ---
        const AC_DATABASE = [
            { id: 'daikin-001', brand: 'Daikin', brandCN: 'å¤§é‡‘', model: 'RXV36UVLT', type: 'å†·æš–è®Šé »', pipes: '2åˆ† / 3åˆ†', dims: '825x283x233', power: '220V/4.5A', refrigerant: 'R32' },
            { id: 'hitachi-001', brand: 'Hitachi', brandCN: 'æ—¥ç«‹', model: 'RAC-40NK', type: 'å†·å°ˆè®Šé »', pipes: '2åˆ† / 4åˆ†', dims: '900x300x250', power: '220V/5.2A', refrigerant: 'R410A' },
            { id: 'panasonic-001', brand: 'Panasonic', brandCN: 'åœ‹éš›ç‰Œ', model: 'CU-PX28FCA2', type: 'å†·æš–æ——è‰¦', pipes: '2åˆ† / 3åˆ†', dims: '780x290x240', power: '220V/3.8A', refrigerant: 'R32' },
            { id: 'teco-001', brand: 'TECO', brandCN: 'æ±å…ƒ', model: 'MA-28IH-ZR', type: 'è®Šé »å†·æš–', pipes: '2åˆ† / 3åˆ†', dims: '815x275x210', power: '110V/8.5A', refrigerant: 'R32' }
        ];

        // --- å­å…ƒä»¶: æœå°‹å¡ç‰‡ ---
        const ResultCard = ({ item }) => (
            <div className="bg-industrial-800 rounded-xl p-4 border border-industrial-700 shadow-md relative overflow-hidden group hover:border-industrial-accent transition-all animate-fade-in mb-3">
                <div className="absolute top-0 left-0 w-1 h-full bg-industrial-accent"></div>
                <div className="flex justify-between items-start mb-2">
                    <div>
                        <span className="text-[10px] font-bold text-industrial-accent bg-industrial-900 px-2 py-0.5 rounded uppercase">{item.brandCN}</span>
                        <h3 className="text-lg font-bold mt-1 font-mono text-white">{item.model}</h3>
                    </div>
                    <span className="px-2 py-1 text-[10px] rounded font-bold bg-blue-900 text-blue-200">{item.type}</span>
                </div>
                <div className="grid grid-cols-2 gap-2 text-[11px] border-t border-industrial-700 pt-3 text-gray-400">
                    <div>ç®¡è·¯: <span className="text-gray-200">{item.pipes}</span></div>
                    <div>é›»æº: <span className="text-gray-200">{item.power}</span></div>
                    <div className="col-span-2">å°ºå¯¸: <span className="text-gray-200">{item.dims}</span> | å†·åª’: <span className="text-gray-200">{item.refrigerant}</span></div>
                </div>
            </div>
        );

        function App() {
            const [activeTab, setActiveTab] = useState('search'); 
            const [history, setHistory] = useState([]);
            const [selectedHistoryItem, setSelectedHistoryItem] = useState(null);

            // --- æŒä¹…åŒ–ç‹€æ…‹ç®¡ç† ---
            const [searchState, setSearchState] = useState({ term: '', results: [] });
            const [capacityState, setCapacityState] = useState({ 
                unit: 'm', length: '', width: '', ping: 0, 
                conditions: { westSun: false, allDaySun: false, topFloor: false, highCeiling: false, ironSheet: false, blackIron: false }, 
                result: null 
            });
            const [refrigerantState, setRefrigerantState] = useState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null });
            const [coolingState, setCoolingState] = useState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null });
            const [ductedState, setDuctedState] = useState({ flangeW: '', flangeH: '', spaceType: 'long', unitPos: 4, result: null });

            // è®€å–ç´€éŒ„
            useEffect(() => {
                try {
                    const saved = localStorage.getItem('yiGeHistory');
                    if (saved) setHistory(JSON.parse(saved));
                } catch (e) {
                    setHistory([]);
                }
            }, []);

            // æ›´æ–°åœ–ç¤º
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, history, selectedHistoryItem, ductedState.unitPos, capacityState.result, coolingState.minutes]);

            const addToHistory = useCallback((title, type, data) => {
                setHistory(prev => {
                    const newH = [{ id: Date.now(), title, type, date: new Date().toLocaleString(), data }, ...prev].slice(0, 20);
                    localStorage.setItem('yiGeHistory', JSON.stringify(newH));
                    return newH;
                });
            }, []);

            const clearHistory = () => {
                if(window.confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ“ä½œç´€éŒ„å—ï¼Ÿ')) {
                    setHistory([]);
                    localStorage.removeItem('yiGeHistory');
                }
            };

            return (
                <div className="min-h-screen flex flex-col font-sans select-none">
                    <header className="bg-industrial-900 border-b border-industrial-700 sticky top-0 z-50 px-4 py-3">
                        <div className="max-w-md mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-2">
                                <i data-lucide="wrench" className="text-industrial-accent w-5 h-5"></i>
                                <h1 className="text-lg font-bold tracking-tighter text-white">é¾ç¥<span className="text-industrial-accent">ç©ºèª¿</span>å¹«æ‰‹</h1>
                            </div>
                            <span className="text-[10px] text-industrial-600 font-mono">V1.5.1 FIXED</span>
                        </div>
                    </header>

                    <main className="flex-1 max-w-md mx-auto w-full p-4 pb-24 overflow-x-hidden">
                        {activeTab === 'search' && (
                            <div className="animate-fade-in">
                                <div className="relative mb-6">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500">
                                        <i data-lucide="search" className="w-4 h-4"></i>
                                    </div>
                                    <input
                                        type="text"
                                        className="w-full pl-9 pr-10 py-3 bg-industrial-800 border border-industrial-700 rounded-xl text-sm text-white focus:border-industrial-accent transition-all shadow-inner"
                                        placeholder="æœå°‹å“ç‰Œã€å‹è™Ÿ..."
                                        value={searchState.term}
                                        onChange={(e) => {
                                            const term = e.target.value;
                                            const low = term.toLowerCase();
                                            const res = term ? AC_DATABASE.filter(i => i.brand.toLowerCase().includes(low) || i.brandCN.includes(low) || i.model.toLowerCase().includes(low)) : [];
                                            setSearchState({ term, results: res });
                                        }}
                                    />
                                    {searchState.term && (
                                        <button onClick={() => setSearchState({ term: '', results: [] })} className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white">
                                            <i data-lucide="x" className="w-4 h-4"></i>
                                        </button>
                                    )}
                                </div>
                                {searchState.term ? (
                                    searchState.results.length > 0 ? searchState.results.map(i => <ResultCard key={i.id} item={i} />) : <p className="text-center text-gray-500 text-sm py-10">æŸ¥ç„¡çµæœ</p>
                                ) : (
                                    <div className="grid grid-cols-2 gap-2 mt-4 opacity-70">
                                        {['å¤§é‡‘', 'æ—¥ç«‹', 'åœ‹éš›ç‰Œ', 'æ±å…ƒ'].map(b => (
                                            <button key={b} onClick={() => setSearchState({ term: b, results: AC_DATABASE.filter(i => i.brandCN.includes(b)) })} className="bg-industrial-800 border border-industrial-700 p-3 rounded-lg text-xs font-bold hover:bg-industrial-700 text-white">{b}</button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'capacity' && <CapacityCalculator state={capacityState} setState={setCapacityState} addToHistory={addToHistory} />}
                        {activeTab === 'calc' && <RefrigerantCalculator state={refrigerantState} setState={setRefrigerantState} addToHistory={addToHistory} />}
                        {activeTab === 'cooling' && <CoolingTimeCalculator state={coolingState} setState={setCoolingState} addToHistory={addToHistory} />}
                        {activeTab === 'ducted' && <DuctedCalculator state={ductedState} setState={setDuctedState} addToHistory={addToHistory} />}

                        {activeTab === 'history' && (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="font-bold text-white">ç´€éŒ„å…§å®¹</h2>
                                    <button onClick={clearHistory} className="text-[10px] text-red-400 border border-red-900/30 px-2 py-1 rounded bg-red-900/10 hover:bg-red-900/20 transition-all">æ¸…é™¤ç´€éŒ„</button>
                                </div>
                                {history.length === 0 ? <p className="text-center text-gray-600 py-20 text-sm">ç›®å‰æ²’æœ‰æ­·å²è³‡æ–™</p> : (
                                    <div className="space-y-3">
                                        {history.map(item => (
                                            <div key={item.id} onClick={() => setSelectedHistoryItem(item)} className="bg-industrial-800 p-3 rounded-lg border-l-4 border-industrial-600 flex justify-between items-center cursor-pointer hover:bg-industrial-700 transition-all">
                                                <div>
                                                    <span className="text-[9px] text-gray-500 block leading-none mb-1 uppercase tracking-tighter">{item.type} | {item.date}</span>
                                                    <div className="text-sm font-bold text-gray-100 truncate w-48">{item.title}</div>
                                                </div>
                                                <i data-lucide="chevron-right" className="text-gray-600 w-4 h-4"></i>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* æ­·å²å½ˆçª— */}
                    {selectedHistoryItem && (
                        <div className="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4 animate-fade-in">
                            <div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={() => setSelectedHistoryItem(null)}></div>
                            <div className="bg-industrial-900 w-full max-w-md rounded-t-3xl sm:rounded-2xl border border-industrial-700 shadow-2xl overflow-hidden flex flex-col max-h-[80vh] relative z-10">
                                <div className="p-4 border-b border-industrial-700 flex justify-between items-center bg-industrial-800/50">
                                    <h3 className="font-bold text-sm text-white">è©³ç´°è³‡è¨Š</h3>
                                    <button onClick={() => setSelectedHistoryItem(null)} className="p-1 text-gray-400 hover:text-white"><i data-lucide="x" className="w-5 h-5"></i></button>
                                </div>
                                <div className="p-6 overflow-y-auto custom-scroll">
                                    <div className="text-[10px] text-gray-500 mb-4 bg-industrial-950 p-2 rounded text-center uppercase tracking-widest">{selectedHistoryItem.type} | {selectedHistoryItem.date}</div>
                                    
                                    {selectedHistoryItem.type === 'search' && selectedHistoryItem.data?.results?.map(i => <ResultCard key={i.id} item={i} />)}
                                    {selectedHistoryItem.type === 'calc' && (
                                        <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                            <div className="text-gray-500 text-xs mb-1 uppercase">éœ€è£œå……é‡</div>
                                            <div className="text-5xl font-mono font-bold text-green-400">{selectedHistoryItem.data?.result}<span className="text-sm ml-1 text-gray-400 uppercase">g</span></div>
                                            <div className="text-[10px] text-gray-500 mt-4 border-t border-industrial-700 pt-3">ç®¡é•· {selectedHistoryItem.data?.totalLen}m / åŸºæº– {selectedHistoryItem.data?.baseLen}m</div>
                                        </div>
                                    )}
                                    {selectedHistoryItem.type === 'capacity' && (
                                        <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                            <div className="text-3xl font-mono font-bold text-yellow-400">{selectedHistoryItem.data?.kw} KW</div>
                                            <div className="text-[10px] text-gray-500 mt-2">{selectedHistoryItem.data?.tons} é “ / {selectedHistoryItem.data?.ping} åª</div>
                                            <div className="text-[10px] text-gray-400 mt-2">æ¢ä»¶: {selectedHistoryItem.data?.conditions?.join(', ') || 'ç„¡'}</div>
                                        </div>
                                    )}
                                    {selectedHistoryItem.type === 'ducted' && (
                                        <div className="space-y-4">
                                            <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                                <div className="text-3xl font-mono font-bold text-blue-400">{selectedHistoryItem.data?.holeQty}å­” Ã— {selectedHistoryItem.data?.holeSize}å‹</div>
                                                <div className="text-[10px] text-gray-500 mt-1 uppercase tracking-widest">{selectedHistoryItem.data?.plenumType}</div>
                                            </div>
                                            <div className="bg-industrial-950 p-4 rounded-xl text-xs leading-relaxed text-gray-300">å°ºå¯¸: {selectedHistoryItem.data?.flangeW}Ã—{selectedHistoryItem.data?.flangeH} cm</div>
                                        </div>
                                    )}
                                    {selectedHistoryItem.type === 'cooling' && (
                                        <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 text-center">
                                            <div className="text-4xl font-mono font-bold text-purple-400">{selectedHistoryItem.data?.minutes} åˆ†é˜</div>
                                            <div className="text-[10px] text-gray-400 mt-4">å®¤æº« {selectedHistoryItem.data?.currentTemp}Â°C â†’ ç›®æ¨™ {selectedHistoryItem.data?.targetTemp}Â°C</div>
                                        </div>
                                    )}
                                </div>
                                <div className="p-4 bg-industrial-800/50 border-t border-industrial-700">
                                    <button onClick={() => setSelectedHistoryItem(null)} className="w-full py-3 bg-industrial-700 text-white rounded-xl font-bold text-sm">é—œé–‰</button>
                                </div>
                            </div>
                        </div>
                    )}

                    <nav className="fixed bottom-0 w-full bg-industrial-900 border-t border-industrial-700 pb-safe z-50">
                        <div className="max-w-md mx-auto grid grid-cols-5 h-16">
                            <NavBtn active={activeTab === 'search'} onClick={() => setActiveTab('search')} icon="search" label="æœå°‹" />
                            <NavBtn active={activeTab === 'capacity'} onClick={() => setActiveTab('capacity')} icon="ruler" label="è² è¼‰" />
                            <NavBtn active={activeTab === 'calc'} onClick={() => setActiveTab('calc')} icon="calculator" label="å†·åª’" />
                            <NavBtn active={activeTab === 'ducted'} onClick={() => setActiveTab('ducted')} icon="box" label="åŠéš±" />
                            <NavBtn active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon="history" label="ç´€éŒ„" />
                        </div>
                    </nav>
                </div>
            );
        }

        // --- åŠŸèƒ½å…ƒä»¶ ---

        function CapacityCalculator({ state, setState, addToHistory }) {
            useEffect(() => {
                const l = parseFloat(state.length) || 0, w = parseFloat(state.width) || 0;
                let area = state.unit === 'm' ? l * w : (l / 100) * (w / 100);
                setState(p => ({ ...p, ping: (area * 0.3025).toFixed(1) }));
            }, [state.length, state.width, state.unit]);

            const calculate = () => {
                if(state.ping <= 0) return alert('è«‹è¼¸å…¥ç©ºé–“å°ºå¯¸');
                let kcal = 450, mult = 1.0, conds = [];
                if (state.conditions.westSun) { mult += 0.2; conds.push('è¥¿æ›¬'); }
                if (state.conditions.allDaySun) { mult += 0.3; conds.push('å…¨æ—¥æ›¬'); }
                if (state.conditions.topFloor) { mult += 0.2; conds.push('é ‚æ¨“/å¹³æˆ¿'); }
                if (state.conditions.highCeiling) { mult += 0.2; conds.push('æŒ‘é«˜'); }
                if (state.conditions.blackIron) { mult += 0.8; conds.push('é»‘éµçš®'); }
                else if (state.conditions.ironSheet) { mult += 0.5; conds.push('éµçš®å±‹'); }
                
                const totalKcal = kcal * mult * state.ping;
                const kw = (totalKcal / 860).toFixed(2), tons = (totalKcal / 2500).toFixed(1);
                setState(p => ({ ...p, result: { kw, tons } }));
                addToHistory(`è² è¼‰: ${state.ping}åª / ${kw}KW`, 'capacity', { kw, tons, ping: state.ping, conditions: conds });
            };

            const handleReset = () => {
                setState({ 
                    unit: 'm', length: '', width: '', ping: 0, 
                    conditions: { westSun: false, allDaySun: false, topFloor: false, highCeiling: false, ironSheet: false, blackIron: false }, 
                    result: null 
                });
            };

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-4 text-white">
                            <h2 className="text-yellow-400 font-bold flex items-center gap-2 text-sm"><i data-lucide="ruler" className="w-4 h-4"></i> ç©ºé–“è² è¼‰è©¦ç®—</h2>
                            <button onClick={handleReset} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="flex bg-industrial-950 p-1 rounded-xl mb-4 text-[10px] font-bold">
                            {['m', 'cm'].map(u => <button key={u} onClick={() => setState(p=>({...p, unit:u}))} className={`flex-1 py-1.5 rounded-lg transition-all ${state.unit===u ? 'bg-industrial-700 text-white shadow-md' : 'text-gray-500'}`}>{u==='m'?'å…¬å°º':'å…¬åˆ†'}</button>)}
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value={state.length} onChange={e=>setState(p=>({...p, length:e.target.value}))} placeholder="é•·åº¦" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-white text-sm" />
                            <input type="number" value={state.width} onChange={e=>setState(p=>({...p, width:e.target.value}))} placeholder="å¯¬åº¦" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-white text-sm" />
                        </div>
                        <div className="text-center mb-6 py-4 bg-industrial-950/50 rounded-2xl border border-industrial-700/50">
                            <div className="text-4xl font-mono font-bold text-white leading-none">{state.ping}</div>
                            <div className="text-[10px] text-gray-500 mt-1 uppercase tracking-widest font-bold">åªæ•¸ Area</div>
                        </div>
                        <div className="grid grid-cols-2 gap-2 mb-6">
                            {Object.entries({ westSun:'ğŸŒ è¥¿æ›¬', allDaySun:'â˜€ï¸ å…¨æ—¥æ›¬', topFloor:'ğŸ  é ‚æ¨“/å¹³æˆ¿', highCeiling:'ğŸ“ æŒ‘é«˜(>3m)', ironSheet:'ğŸ­ éµçš®å±‹', blackIron:'ğŸ”¥ é»‘è‰²éµçš®' }).map(([k, l]) => (
                                <label key={k} className={`flex items-center space-x-2 bg-industrial-900 p-2.5 rounded-xl border border-industrial-700 cursor-pointer transition-all ${k==='ironSheet' && state.conditions.blackIron ? 'opacity-20 pointer-events-none' : 'hover:border-industrial-accent'}`}>
                                    <input type="checkbox" checked={state.conditions[k]} onChange={()=>{
                                        const next = { ...state.conditions, [k]: !state.conditions[k] };
                                        if (k==='blackIron' && next.blackIron) next.ironSheet = false;
                                        if (k==='ironSheet' && next.ironSheet) next.blackIron = false;
                                        setState(p=>({...p, conditions: next}));
                                    }} className="rounded text-industrial-accent focus:ring-0" />
                                    <span className="text-[10px] font-bold text-white">{l}</span>
                                </label>
                            ))}
                        </div>
                        <button onClick={calculate} className="w-full py-4 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm">è¨ˆç®—å†·æˆ¿èƒ½åŠ›</button>
                    </div>
                    {state.result && (
                        <div className="bg-industrial-900 rounded-2xl p-5 border border-yellow-600/50 animate-slide-up shadow-2xl relative overflow-hidden text-center">
                             <div className="absolute top-0 left-0 w-full h-1 bg-yellow-600"></div>
                             <div className="flex justify-center items-end gap-3 text-white">
                                 <div><div className="text-3xl font-mono font-bold">{state.result.kw}</div><div className="text-[9px] text-yellow-500 font-bold uppercase">KW</div></div>
                                 <div className="text-gray-600 pb-2">/</div>
                                 <div><div className="text-2xl font-mono font-bold">{state.result.tons}</div><div className="text-[9px] text-yellow-500 font-bold uppercase">å™¸ (Tons)</div></div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        function RefrigerantCalculator({ state, setState, addToHistory }) {
            const calculate = () => {
                const total = parseFloat(state.totalLen);
                if (isNaN(total) || total < 0) return alert('è«‹è¼¸å…¥ç®¡é•·æ•¸å€¼');
                const res = Math.max(0, Math.round((total - state.baseLen) * state.gramPerMeter));
                setState(p=>({...p, result: res}));
                addToHistory(`è£œå†·åª’: ${res}g / ${total}m`, 'calc', { baseLen: state.baseLen, totalLen: total, result: res });
            };
            const handleReset = () => setState({ baseLen: 5, totalLen: '', gramPerMeter: 20, result: null });

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-6 text-white">
                            <h2 className="text-green-400 font-bold flex items-center gap-2 text-sm"><i data-lucide="scale" className="w-4 h-4"></i> å†·åª’è£œå¡«é‡è¨ˆç®—</h2>
                            <button onClick={handleReset} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="space-y-5">
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">åŸå» åŸºæº–é•·åº¦ (m)</label><div className="flex gap-2">{[5, 8].map(l => <button key={l} onClick={()=>setState(p=>({...p, baseLen:l}))} className={`flex-1 py-3 rounded-xl text-xs font-bold border transition-all ${state.baseLen===l ? 'bg-green-600 border-green-500 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{l}m</button>)}</div></div>
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">æ¯ç±³è£œå……é‡ (g/m)</label><div className="grid grid-cols-3 gap-2">{[15, 20, 30].map(v => <button key={v} onClick={()=>setState(p=>({...p, gramPerMeter:v}))} className={`py-3 rounded-xl text-xs font-bold border transition-all ${state.gramPerMeter===v ? 'bg-green-600 border-green-500 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{v}g</button>)}</div></div>
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest text-center">å¯¦éš›æ–½å·¥ç¸½ç®¡é•· (m)</label><input type="number" value={state.totalLen} onChange={e=>setState(p=>({...p, totalLen:e.target.value}))} className="w-full text-3xl py-4 bg-industrial-900 border-2 border-industrial-700 focus:border-green-500 rounded-2xl text-center text-white font-mono shadow-inner" placeholder="0" /></div>
                            <button onClick={calculate} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm flex items-center justify-center gap-2"><i data-lucide="calculator" className="w-4 h-4"></i> é–‹å§‹è¨ˆç®—</button>
                        </div>
                        {state.result !== null && (
                            <div className="mt-6 bg-industrial-900 rounded-2xl p-4 border border-green-600/30 text-center animate-fade-in">
                                <span className="block text-gray-500 text-[10px] mb-1 uppercase font-bold tracking-widest">å»ºè­°è£œå……é‡</span>
                                <div className="text-4xl font-mono font-bold text-green-400">{state.result} <span className="text-sm">g</span></div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function CoolingTimeCalculator({ state, setState, addToHistory }) {
            const calculate = () => {
                const { ping, height, currentTemp, targetTemp, acKw } = state;
                const p = parseFloat(ping), h = parseFloat(height), kw = parseFloat(acKw), dt = currentTemp - targetTemp;
                if (!p || !kw || dt <= 0) return alert('è«‹ç¢ºèªæ•¸å€¼æ˜¯å¦å¡«å¯«æ­£ç¢º');
                const time = Math.round(((p * 3.3 * h) * 1.2 * 1.0 * dt * 10) / kw / 60);
                setState(p=>({...p, minutes: time}));
                addToHistory(`é™æº«ä¼°ç®—: ${time} åˆ†é˜`, 'cooling', { ping: p, height: h, acKw: kw, minutes: time, currentTemp, targetTemp });
            };
            const handleReset = () => setState({ ping: '', height: 3.0, currentTemp: 32, targetTemp: 26, acKw: '', minutes: null });

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-4 text-white">
                            <h2 className="text-purple-400 font-bold flex items-center gap-2 text-sm"><i data-lucide="thermometer" className="w-4 h-4"></i> ç‰©ç†é™æº«æ¨¡æ“¬</h2>
                            <button onClick={handleReset} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="grid grid-cols-2 gap-3 mb-4">
                            <input type="number" value={state.ping} onChange={e=>setState(p=>({...p, ping:e.target.value}))} placeholder="åªæ•¸" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-white text-sm" />
                            <input type="number" value={state.height} onChange={e=>setState(p=>({...p, height:e.target.value}))} placeholder="é«˜åº¦(m)" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-white text-sm" />
                        </div>
                        <div className="grid grid-cols-2 gap-3 mb-6">
                            <input type="number" value={state.currentTemp} onChange={e=>setState(p=>({...p, currentTemp:e.target.value}))} placeholder="å®¤æº«Â°C" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-red-300 text-sm" />
                            <input type="number" value={state.targetTemp} onChange={e=>setState(p=>({...p, targetTemp:e.target.value}))} placeholder="ç›®æ¨™Â°C" className="bg-industrial-900 border border-industrial-700 rounded-xl p-3 text-center text-blue-300 text-sm" />
                        </div>
                        <div className="mb-6">
                            <label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest text-center">å†·æ°£åˆ¶å†·èƒ½åŠ› (KW)</label>
                            <input type="number" value={state.acKw} onChange={e=>setState(p=>({...p, acKw:e.target.value}))} className="w-full bg-industrial-900 border-2 border-industrial-700 focus:border-purple-500 rounded-2xl p-4 text-center text-white font-bold text-xl shadow-inner" placeholder="0.0" />
                        </div>
                        <button onClick={calculate} className="w-full py-4 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm">åŸ·è¡Œæ•¸æ“šä¼°ç®—</button>
                    </div>

                    {state.minutes !== null && (
                        <div className="bg-industrial-900 rounded-2xl p-5 border border-purple-600/50 animate-slide-up shadow-2xl relative overflow-hidden text-center">
                             <div className="absolute top-0 left-0 w-full h-1 bg-purple-600"></div>
                             <div className="text-gray-500 text-[10px] mb-1 uppercase tracking-widest font-bold">é ä¼°é”åˆ°ç›®æ¨™æ™‚é–“</div>
                             <div className="text-5xl font-mono font-bold text-purple-400 leading-none my-2">{state.minutes}</div>
                             <div className="text-[10px] text-gray-500 uppercase font-bold tracking-widest">åˆ†é˜ Minutes</div>
                        </div>
                    )}
                </div>
            );
        }

        function DuctedCalculator({ state, setState, addToHistory }) {
            const calculate = () => {
                const fw = parseFloat(state.flangeW), fh = parseFloat(state.flangeH);
                if (!fw || !fh) return alert('è«‹å¡«å…¥æ³•è˜­å¯¬åº¦èˆ‡é«˜åº¦');
                const area = fw * fh;
                let size = state.spaceType === 'square' ? 10 : 8, qty = 2, pType = "æ¨™æº–é›†é¢¨ç®±", note = "";
                if (fh < 20) { pType = "ä¸‰è§’å½¢é›†é¢¨ç®±"; size = 8; qty = 2; note = "æ³•è˜­éçª„ï¼Œé™åˆ¶å­”å¾‘ä»¥æå‡é é€é¢¨åŠ›ã€‚"; }
                else { qty = Math.max(2, Math.ceil(area / (Math.PI * Math.pow((size*2.54/2), 2) * 0.9))); }
                if ([0, 2, 6, 8].includes(state.unitPos) && state.spaceType === 'long') note = "ä¸»æ©Ÿä½æ–¼è§’è½ä¸”ç©ºé–“é•·ï¼šå»ºè­°ç¸®å°å­”å¾‘æå‡é¢¨é€Ÿã€‚";
                setState(p => ({ ...p, result: { holeSize: size, holeQty: qty, plenumType: pType, airflowNote: note } }));
                addToHistory(`åŠéš±: ${fw}x${fh} / ${qty}å­”`, 'ducted', { flangeW: fw, flangeH: fh, holeSize: size, holeQty: qty, plenumType: pType, spaceTypeCN: state.spaceType });
            };
            const handleReset = () => setState({ flangeW:'', flangeH:'', spaceType:'long', unitPos:4, result:null });

            return (
                <div className="animate-fade-in space-y-4 pb-10">
                    <div className="bg-industrial-800 p-6 rounded-2xl border border-industrial-700 shadow-xl">
                        <div className="flex justify-between items-center mb-6 text-white">
                            <h2 className="text-blue-400 font-bold flex items-center gap-2 text-sm"><i data-lucide="box" className="w-4 h-4"></i> åŠéš±å‡ºé¢¨é…ç½®è¨ˆç®—</h2>
                            <button onClick={handleReset} className="text-[10px] text-gray-500 hover:text-white px-2 py-1 bg-industrial-900 rounded">é‡ç½®</button>
                        </div>
                        <div className="space-y-6">
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">1. å‡ºé¢¨å£æ³•è˜­é‡æ¸¬å°ºå¯¸ (cm)</label><div className="grid grid-cols-2 gap-3"><input type="number" value={state.flangeW} onChange={e=>setState(p=>({...p, flangeW:e.target.value}))} placeholder="å¯¬åº¦" className="w-full bg-industrial-900 border border-industrial-700 rounded-xl py-3 text-center text-white text-sm" /><input type="number" value={state.flangeH} onChange={e=>setState(p=>({...p, flangeH:e.target.value}))} placeholder="é«˜åº¦" className="w-full bg-industrial-900 border border-industrial-700 rounded-xl py-3 text-center text-white text-sm" /></div></div>
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest">2. å®‰è£ç©ºé–“å‹æ…‹</label><div className="grid grid-cols-3 gap-2">{[{id:'long',l:'é•·è·é›¢'},{id:'narrow',l:'çª„ç©ºé–“'},{id:'square',l:'æ–¹å½¢'}].map(t => <button key={t.id} onClick={()=>setState(p=>({...p, spaceType:t.id}))} className={`p-2 rounded-xl border text-[10px] font-bold transition-all ${state.spaceType===t.id ? 'bg-blue-600 border-blue-400 text-white shadow-md' : 'bg-industrial-900 border-industrial-700 text-gray-500'}`}>{t.l}</button>)}</div></div>
                            <div><label className="text-[10px] text-gray-500 mb-2 block font-bold uppercase tracking-widest text-center">3. é¸æ“‡ä¸»æ©Ÿä½ç½®</label><div className="bg-industrial-950 p-4 rounded-2xl flex justify-center"><div className="grid grid-cols-3 gap-2 w-40">{[...Array(9)].map((_, i) => <button key={i} onClick={() => setState(p => ({ ...p, unitPos: i }))} className={`grid-pos-btn ${state.unitPos === i ? 'active' : 'bg-industrial-900 hover:border-industrial-accent'}`}>{i===4 && <i data-lucide="air-vent" className="w-3 h-3"></i>}{state.unitPos===i && i!==4 && <i data-lucide="check" className="w-3 h-3"></i>}</button>)}</div></div></div>
                            <button onClick={calculate} className="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-sm flex items-center justify-center gap-2"><i data-lucide="zap" className="w-4 h-4"></i> ç”Ÿæˆå°ˆæ¥­å»ºè­°</button>
                        </div>
                    </div>
                    {state.result && (
                        <div className="bg-industrial-900 rounded-2xl p-5 border border-blue-600/50 animate-slide-up shadow-2xl relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-blue-600"></div>
                             <div className="grid grid-cols-2 gap-4 text-white">
                                 <div className="text-center border-r border-industrial-700 font-mono"><div className="text-gray-500 text-[10px] mb-1">å»ºè­°å­”æ•¸</div><div className="text-3xl font-bold">{state.result.holeQty}<span className="text-xs text-blue-500 ml-1 font-sans">å­”</span></div></div>
                                 <div className="text-center font-mono"><div className="text-gray-500 text-[10px] mb-1">å­”å¾‘å¤§å°</div><div className="text-3xl font-bold">{state.result.holeSize}<span className="text-xs text-blue-500 ml-1 font-sans">å‹</span></div></div>
                                 <div className="col-span-2 bg-industrial-800/50 p-3 rounded-xl text-[10px] leading-relaxed text-gray-400 border border-industrial-700/50"><span className="text-blue-400 font-bold block mb-1">âš ï¸ æ–½å·¥æŒ‡å—:</span>- {state.result.plenumType}<br/>- {state.result.airflowNote || "ç¶­æŒ 8 å‹ä»¥ä¸Šé–‹å­”å¯å…¼é¡§é¢¨é‡èˆ‡éœå£“ã€‚"}</div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        function NavBtn({ active, onClick, icon, label }) {
            return (
                <button onClick={onClick} className={`flex flex-col items-center justify-center w-full transition-all duration-300 ${active ? 'text-industrial-accent scale-110' : 'text-gray-500 hover:text-gray-300'}`}>
                    <i data-lucide={icon} className={`w-5 h-5 mb-1 ${active ? 'fill-current/10' : ''}`}></i>
                    <span className="text-[9px] font-bold tracking-tighter uppercase">{label}</span>
                </button>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
