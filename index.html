<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾ç¥ç©ºèª¿å¹«æ‰‹ | å°ˆæ¥­å†·æ°£å¸«å‚…å·¥å…·ç®±</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        // --- åŸºæœ¬é˜²è­·è…³æœ¬ (é˜²å›å­) ---
        // ç¦ç”¨å³éµ
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });
        
        // ç¦ç”¨å¸¸è¦‹é–‹ç™¼è€…å·¥å…·å¿«æ·éµ
        document.addEventListener('keydown', function(e) {
            // F12
            if(e.keyCode == 123) {
                e.preventDefault();
                return false;
            }
            // Ctrl+Shift+I, Ctrl+Shift+J (é–‹å•Ÿé–‹ç™¼è€…å·¥å…·)
            if(e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'i' || e.key === 'j')) {
                e.preventDefault();
                return false;
            }
            // Ctrl+U (æª¢è¦–åŸå§‹ç¢¼)
            if(e.ctrlKey && (e.key === 'U' || e.key === 'u')) {
                e.preventDefault();
                return false;
            }
        });

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        industrial: {
                            900: '#0f172a', // æ·±éµç°èƒŒæ™¯
                            800: '#1e293b', // å¡ç‰‡èƒŒæ™¯
                            700: '#334155', // é‚Šæ¡†
                            600: '#475569', // æ¬¡è¦æ–‡å­—
                            accent: '#f59e0b', // å·¥ç¨‹é»ƒ (è­¦ç¤º/æŒ‰éˆ•)
                            text: '#e2e8f0', // ä¸»è¦æ–‡å­—
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            user-select: none; /* ç¦æ­¢é¸å–æ–‡å­— */
            -webkit-user-select: none;
        }
        /* è‡ªå®šç¾©æ²è»¸ */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        
        /* éš±è—æ•¸å­—è¼¸å…¥æ¡†çš„ç®­é ­ */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        
        /* å…è¨±è¼¸å…¥æ¡†å…§çš„æ–‡å­—è¢«é¸å–ï¼Œå¦å‰‡ç„¡æ³•ç·¨è¼¯ */
        input {
            user-select: auto;
            -webkit-user-select: auto;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- æ¨¡æ“¬è³‡æ–™åº« ---
        const AC_DATABASE = [
            { id: 'daikin-001', brand: 'Daikin', brandCN: 'å¤§é‡‘', model: 'RXV36UVLT', type: 'å†·æš–è®Šé »', pipes: '2åˆ† / 3åˆ†', dims: 'å¯¬825 x é«˜283 x æ·±233 mm', power: '220V / 4.5A', refrigerant: 'R32' },
            { id: 'hitachi-001', brand: 'Hitachi', brandCN: 'æ—¥ç«‹', model: 'RAC-40NK', type: 'å†·å°ˆè®Šé »', pipes: '2åˆ† / 4åˆ†', dims: 'å¯¬900 x é«˜300 x æ·±250 mm', power: '220V / 5.2A', refrigerant: 'R410A' },
            { id: 'panasonic-001', brand: 'Panasonic', brandCN: 'åœ‹éš›ç‰Œ', model: 'CU-PX28FCA2', type: 'å†·æš–æ——è‰¦', pipes: '2åˆ† / 3åˆ†', dims: 'å¯¬780 x é«˜290 x æ·±240 mm', power: '220V / 3.8A', refrigerant: 'R32' },
            { id: 'midea-001', brand: 'Midea', brandCN: 'ç¾çš„', model: 'MV-36HP', type: 'å®šé »å†·æ°£', pipes: '3åˆ† / 5åˆ†', dims: 'å¯¬850 x é«˜270 x æ·±220 mm', power: '220V / 6.0A', refrigerant: 'R410A' },
            { id: 'teco-001', brand: 'TECO', brandCN: 'æ±å…ƒ', model: 'MA-28IH-ZR', type: 'è®Šé »å†·æš–', pipes: '2åˆ† / 3åˆ†', dims: 'å¯¬815 x é«˜275 x æ·±210 mm', power: '110V / 8.5A', refrigerant: 'R32' }
        ];

        // --- å…±ç”¨å…ƒä»¶: æ©Ÿå‹å¡ç‰‡ ---
        function ResultCard({ item }) {
            return (
                <div className="bg-industrial-800 rounded-xl p-5 border border-industrial-700 shadow-lg relative overflow-hidden group hover:border-industrial-accent transition-colors">
                    <div className="absolute top-0 left-0 w-1 h-full bg-industrial-accent"></div>
                    <div className="flex justify-between items-start mb-3">
                        <div>
                            <span className="text-xs font-bold text-industrial-accent uppercase tracking-wider bg-industrial-900 px-2 py-1 rounded">
                                {item.brandCN} / {item.brand}
                            </span>
                            <h3 className="text-xl font-bold mt-2 font-mono">{item.model}</h3>
                        </div>
                        <div className="text-right">
                            <span className={`inline-block px-2 py-1 text-xs rounded font-bold ${item.type.includes('æš–') ? 'bg-red-900 text-red-200' : 'bg-blue-900 text-blue-200'}`}>
                                {item.type}
                            </span>
                        </div>
                    </div>
                    <div className="grid grid-cols-2 gap-4 text-sm mt-4 pt-4 border-t border-industrial-700">
                        <div>
                            <span className="block text-gray-500 text-xs mb-1">éŠ…ç®¡è¦æ ¼</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="circle-dot" className="w-3 h-3"></i> {item.pipes}
                            </span>
                        </div>
                        <div>
                            <span className="block text-gray-500 text-xs mb-1">é›»æºè¦æ ¼</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="zap" className="w-3 h-3"></i> {item.power}
                            </span>
                        </div>
                        <div className="col-span-2">
                            <span className="block text-gray-500 text-xs mb-1">æ©Ÿé«”å°ºå¯¸</span>
                            <span className="font-mono text-white flex items-center gap-1">
                                <i data-lucide="box" className="w-3 h-3"></i> {item.dims}
                            </span>
                        </div>
                        <div className="col-span-2">
                            <span className="block text-gray-500 text-xs mb-1">å†·åª’ç¨®é¡</span>
                            <span className="font-mono text-white">{item.refrigerant}</span>
                        </div>
                    </div>
                </div>
            );
        }

        // --- æ‡‰ç”¨ç¨‹å¼ä¸»å…ƒä»¶ ---
        function App() {
            const [activeTab, setActiveTab] = useState('search'); 
            const [searchTerm, setSearchTerm] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [history, setHistory] = useState([]);
            const [selectedHistoryItem, setSelectedHistoryItem] = useState(null);

            useEffect(() => {
                const savedHistory = localStorage.getItem('yiGeHistory');
                if (savedHistory) {
                    setHistory(JSON.parse(savedHistory));
                }
                if (window.lucide) window.lucide.createIcons();
            }, []);

            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, searchResults, selectedHistoryItem, history, searchTerm]);

            const getSearchResults = (term) => {
                if (!term) return [];
                const lowerTerm = term.toLowerCase();
                return AC_DATABASE.filter(item => 
                    item.brand.toLowerCase().includes(lowerTerm) ||
                    item.brandCN.includes(lowerTerm) ||
                    item.model.toLowerCase().includes(lowerTerm)
                );
            };

            const handleSearch = (term) => {
                setSearchTerm(term);
                const results = getSearchResults(term);
                setSearchResults(results);
            };

            const triggerSearchAndSave = () => {
                if (searchTerm) {
                    const currentResults = getSearchResults(searchTerm);
                    addToHistory(`æœå°‹: ${searchTerm}`, 'search', { term: searchTerm, results: currentResults });
                }
            };

            const addToHistory = (title, type, data = {}) => {
                const newEntry = {
                    id: Date.now(),
                    title: title,
                    type: type, 
                    date: new Date().toLocaleString(),
                    data: data 
                };
                const newHistory = [newEntry, ...history].slice(0, 20);
                setHistory(newHistory);
                localStorage.setItem('yiGeHistory', JSON.stringify(newHistory));
            };

            const clearHistory = () => {
                if(confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ')) {
                    setHistory([]);
                    localStorage.removeItem('yiGeHistory');
                }
            };

            const renderHistoryIcon = (type) => {
                switch(type) {
                    case 'calc': return <i data-lucide="calculator" className="text-green-400 w-5 h-5"></i>;
                    case 'search': return <i data-lucide="search" className="text-blue-400 w-5 h-5"></i>;
                    case 'capacity': return <i data-lucide="ruler" className="text-yellow-400 w-5 h-5"></i>;
                    case 'cooling': return <i data-lucide="thermometer" className="text-purple-400 w-5 h-5"></i>;
                    default: return <i data-lucide="file" className="text-gray-400 w-5 h-5"></i>;
                }
            };

            const renderHistoryBadge = (type) => {
                switch(type) {
                    case 'calc': return <span className="bg-green-900 text-green-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">å†·åª’</span>;
                    case 'search': return <span className="bg-blue-900 text-blue-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">æœå°‹</span>;
                    case 'capacity': return <span className="bg-yellow-900 text-yellow-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">è² è¼‰</span>;
                    case 'cooling': return <span className="bg-purple-900 text-purple-300 text-[10px] px-1.5 py-0.5 rounded font-bold uppercase">é™æº«</span>;
                    default: return null;
                }
            };

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    <header className="bg-industrial-900 border-b border-industrial-700 sticky top-0 z-50">
                        <div className="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <i data-lucide="wrench" className="text-industrial-accent w-6 h-6"></i>
                                <h1 className="text-xl font-bold tracking-wider">
                                    é¾ç¥<span className="text-industrial-accent">ç©ºèª¿</span>å¹«æ‰‹
                                </h1>
                            </div>
                            <div className="text-xs text-industrial-600 font-mono border border-industrial-700 px-2 py-1 rounded">V1.2</div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-md mx-auto w-full p-4 pb-24 relative">
                        {activeTab === 'search' && (
                            <div className="animate-fade-in">
                                <div className="relative mb-6">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i data-lucide="search" className="text-gray-400 w-5 h-5"></i>
                                    </div>
                                    <input
                                        type="text"
                                        className="block w-full pl-10 pr-10 py-3 border border-industrial-600 rounded-lg leading-5 bg-industrial-800 text-gray-100 placeholder-gray-500 focus:outline-none focus:border-industrial-accent focus:ring-1 focus:ring-industrial-accent sm:text-sm transition-colors"
                                        placeholder="è¼¸å…¥å“ç‰Œæˆ–å‹è™Ÿ..."
                                        value={searchTerm}
                                        onChange={(e) => handleSearch(e.target.value)}
                                        onKeyDown={(e) => e.key === 'Enter' && triggerSearchAndSave()}
                                    />
                                    {searchTerm && (
                                        <button onClick={() => handleSearch('')} className="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-white transition-colors">
                                            <i data-lucide="x" className="w-5 h-5"></i>
                                        </button>
                                    )}
                                </div>
                                <div className="space-y-4">
                                    {searchTerm && searchResults.length === 0 ? (
                                        <div className="text-center py-10 text-gray-500">
                                            <i data-lucide="archive-x" className="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                            <p>æ‰¾ä¸åˆ°ç¬¦åˆ "{searchTerm}" çš„è³‡æ–™</p>
                                        </div>
                                    ) : (
                                        searchResults.map(item => <ResultCard key={item.id} item={item} />)
                                    )}
                                    {!searchTerm && (
                                        <div className="text-center py-10">
                                            <p className="text-industrial-600 mb-4">è¼¸å…¥å“ç‰Œæˆ–å‹è™Ÿé–‹å§‹æŸ¥è©¢</p>
                                            <div className="flex flex-wrap justify-center gap-2">
                                                {['å¤§é‡‘', 'æ—¥ç«‹', 'åœ‹éš›ç‰Œ', 'TECO'].map(brand => (
                                                    <button 
                                                        key={brand}
                                                        onClick={() => {
                                                            setSearchTerm(brand);
                                                            const results = getSearchResults(brand);
                                                            setSearchResults(results);
                                                            addToHistory(`æœå°‹: ${brand}`, 'search', { term: brand, results: results });
                                                        }}
                                                        className="px-3 py-1 bg-industrial-800 border border-industrial-600 rounded-full text-sm hover:bg-industrial-700 transition"
                                                    >
                                                        {brand}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'capacity' && <CapacityCalculator addToHistory={addToHistory} />}
                        {activeTab === 'calc' && <RefrigerantCalculator addToHistory={addToHistory} />}
                        {activeTab === 'cooling' && <CoolingTimeCalculator addToHistory={addToHistory} />}

                        {activeTab === 'history' && (
                            <div className="animate-fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">æ“ä½œç´€éŒ„</h2>
                                    {history.length > 0 && (
                                        <button onClick={clearHistory} className="text-xs text-red-400 flex items-center gap-1 border border-red-900 bg-red-900/20 px-2 py-1 rounded">
                                            <i data-lucide="trash-2" className="w-3 h-3"></i> æ¸…é™¤
                                        </button>
                                    )}
                                </div>
                                {history.length === 0 ? (
                                    <div className="text-center py-12 text-gray-500">
                                        <i data-lucide="history" className="w-12 h-12 mx-auto mb-2 opacity-50"></i>
                                        <p>å°šç„¡æ“ä½œç´€éŒ„</p>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {history.map(item => (
                                            <div key={item.id} onClick={() => setSelectedHistoryItem(item)} className="bg-industrial-800 p-4 rounded-lg border-l-4 border-industrial-600 flex justify-between items-center cursor-pointer hover:bg-industrial-700 transition-colors group">
                                                <div>
                                                    <div className="flex items-center gap-2 mb-1">
                                                        {renderHistoryBadge(item.type)}
                                                        <span className="text-gray-400 text-xs">{item.date}</span>
                                                    </div>
                                                    <div className="text-sm font-mono text-gray-200">{item.title}</div>
                                                </div>
                                                <i data-lucide="chevron-right" className="text-gray-600 group-hover:text-industrial-accent w-5 h-5"></i>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}

                        {selectedHistoryItem && (
                            <div className="fixed inset-0 z-[60] flex items-end sm:items-center justify-center p-0 sm:p-4">
                                <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setSelectedHistoryItem(null)}></div>
                                <div className="bg-industrial-900 w-full max-w-md rounded-t-2xl sm:rounded-2xl border border-industrial-700 shadow-2xl overflow-hidden transform animate-slide-up flex flex-col max-h-[85vh]">
                                    <div className="p-4 border-b border-industrial-700 flex justify-between items-center bg-industrial-800">
                                        <h3 className="text-lg font-bold flex items-center gap-2">
                                            {renderHistoryIcon(selectedHistoryItem.type)} è©³ç´°ç´€éŒ„
                                        </h3>
                                        <button onClick={() => setSelectedHistoryItem(null)} className="p-1 rounded-full hover:bg-industrial-700 text-gray-400 hover:text-white">
                                            <i data-lucide="x" className="w-6 h-6"></i>
                                        </button>
                                    </div>
                                    <div className="p-5 overflow-y-auto text-sm">
                                        <div className="mb-4 text-xs text-gray-500 flex items-center gap-1">
                                            <i data-lucide="clock" className="w-3 h-3"></i> è¨˜éŒ„æ™‚é–“: {selectedHistoryItem.date}
                                        </div>
                                        {selectedHistoryItem.type === 'search' && (
                                            <div>
                                                <div className="mb-4">
                                                    <span className="text-gray-500">æœå°‹é—œéµå­—ï¼š</span>
                                                    <span className="text-industrial-accent font-bold text-lg ml-2">{selectedHistoryItem.data?.term}</span>
                                                </div>
                                                <h4 className="font-bold text-gray-300 mb-3 border-b border-industrial-700 pb-1">ç•¶æ™‚æœå°‹çµæœ</h4>
                                                <div className="space-y-3">
                                                    {selectedHistoryItem.data?.results?.map(item => <ResultCard key={item.id} item={item} />)}
                                                </div>
                                            </div>
                                        )}
                                        {selectedHistoryItem.type === 'calc' && (
                                            <div className="space-y-4">
                                                <div className="bg-industrial-800 p-4 rounded-lg border border-industrial-700 text-center">
                                                    <span className="block text-gray-500 text-xs mb-1">éœ€è£œå……å†·åª’é‡</span>
                                                    <div className="text-4xl font-mono font-bold text-green-400">{selectedHistoryItem.data?.result} g</div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-3 text-sm">
                                                    <div className="bg-industrial-950 p-3 rounded">å¯¦éš›ç®¡é•·: {selectedHistoryItem.data?.totalLen}m</div>
                                                    <div className="bg-industrial-950 p-3 rounded">åŸå» åŸºæº–: {selectedHistoryItem.data?.baseLen}m</div>
                                                </div>
                                            </div>
                                        )}
                                        {selectedHistoryItem.type === 'capacity' && (
                                            <div className="space-y-4">
                                                <div className="bg-industrial-800 p-4 rounded-lg border border-industrial-700">
                                                    <span className="block text-gray-500 text-xs mb-1">å»ºè­°èƒ½åŠ›</span>
                                                    <div className="text-3xl font-mono font-bold text-yellow-400">{selectedHistoryItem.data?.kw} KW</div>
                                                    <div className="text-gray-400 text-sm">ç´„ {selectedHistoryItem.data?.tons} é “</div>
                                                </div>
                                                <div className="bg-industrial-950 p-3 rounded">æ¢ä»¶: {selectedHistoryItem.data?.conditions?.join(', ') || 'ç„¡ç‰¹æ®Šæ¢ä»¶'}</div>
                                            </div>
                                        )}
                                        {selectedHistoryItem.type === 'cooling' && (
                                            <div className="space-y-4 text-center">
                                                <div className="bg-industrial-800 p-4 rounded-lg border border-industrial-700">
                                                    <span className="block text-gray-500 text-xs mb-1">ä¼°è¨ˆé™æº«æ™‚é–“</span>
                                                    <div className="text-3xl font-mono font-bold text-purple-400">{selectedHistoryItem.data?.minutes} åˆ†é˜</div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                    <div className="p-4 border-t border-industrial-700 bg-industrial-800">
                                        <button onClick={() => setSelectedHistoryItem(null)} className="w-full py-3 bg-industrial-700 text-white rounded-lg font-bold">é—œé–‰</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 w-full bg-industrial-900 border-t border-industrial-700 pb-safe z-40">
                        <div className="max-w-md mx-auto grid grid-cols-5 h-16">
                            <NavButton active={activeTab === 'search'} onClick={() => setActiveTab('search')} icon="search" label="æœå°‹" />
                            <NavButton active={activeTab === 'capacity'} onClick={() => setActiveTab('capacity')} icon="ruler" label="è² è¼‰" />
                            <NavButton active={activeTab === 'calc'} onClick={() => setActiveTab('calc')} icon="calculator" label="å†·åª’" />
                            <NavButton active={activeTab === 'cooling'} onClick={() => setActiveTab('cooling')} icon="thermometer" label="é™æº«" />
                            <NavButton active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon="history" label="ç´€éŒ„" />
                        </div>
                    </nav>
                </div>
            );
        }

        // --- è² è¼‰è©¦ç®—å…ƒä»¶ ---
        function CapacityCalculator({ addToHistory }) {
            const [unit, setUnit] = useState('m');
            const [length, setLength] = useState('');
            const [width, setWidth] = useState('');
            const [ping, setPing] = useState(0);
            const [conditions, setConditions] = useState({ westSun: false, allDaySun: false, topFloor: false, highCeiling: false, ironSheet: false, blackIron: false });
            const [result, setResult] = useState(null);

            useEffect(() => {
                const l = parseFloat(length) || 0, w = parseFloat(width) || 0;
                let areaM2 = unit === 'm' ? l * w : (l / 100) * (w / 100);
                setPing((areaM2 * 0.3025).toFixed(1));
            }, [length, width, unit]);

            const toggleCondition = (key) => {
                setConditions(prev => {
                    const newState = { ...prev, [key]: !prev[key] };
                    if (key === 'blackIron' && newState.blackIron) newState.ironSheet = false;
                    if (key === 'ironSheet' && newState.ironSheet) newState.blackIron = false;
                    return newState;
                });
            };

            const calculate = () => {
                if(ping <= 0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆé•·å¯¬');
                let baseKcal = 450, multiplier = 1.0, conditionList = [];
                if (conditions.westSun) { multiplier += 0.2; conditionList.push('è¥¿æ›¬'); }
                if (conditions.allDaySun) { multiplier += 0.3; conditionList.push('ç™½å¤©æ—¥æ›¬'); }
                if (conditions.topFloor) { multiplier += 0.2; conditionList.push('é ‚æ¨“/å¹³æˆ¿'); }
                if (conditions.highCeiling) { multiplier += 0.2; conditionList.push('æŒ‘é«˜'); } 
                if (conditions.blackIron) { multiplier += 0.8; conditionList.push('é»‘è‰²éµçš®'); } 
                else if (conditions.ironSheet) { multiplier += 0.5; conditionList.push('ä¸€èˆ¬éµçš®'); }
                const totalKcal = baseKcal * multiplier * ping;
                const kw = (totalKcal / 860).toFixed(2), tons = (totalKcal / 2500).toFixed(1);
                setResult({ kw, tons });
                addToHistory(`è² è¼‰è¨ˆç®—: ${ping}åª / éœ€ ${kw} KW`, 'capacity', { ping, conditions: conditionList, multiplier, kw, tons });
            };

            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-yellow-400"><i data-lucide="ruler" className="w-5 h-5"></i> ç©ºé–“è² è¼‰è©¦ç®—</h2>
                        <div className="flex bg-industrial-900 rounded-lg p-1 mb-4">
                            {['m', 'cm'].map(u => <button key={u} onClick={() => setUnit(u)} className={`flex-1 py-1 text-sm rounded transition ${unit===u ? 'bg-industrial-700 text-white' : 'text-gray-500'}`}>{u === 'm' ? 'å…¬å°º' : 'å…¬åˆ†'}</button>)}
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value={length} onChange={e=>setLength(e.target.value)} placeholder="é•·åº¦" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" />
                            <input type="number" value={width} onChange={e=>setWidth(e.target.value)} placeholder="å¯¬åº¦" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" />
                        </div>
                        <div className="text-center mb-6 py-2 bg-industrial-900/50 rounded border border-industrial-700/50">
                            <span className="text-sm text-gray-400">æ›ç®—åªæ•¸</span>
                            <div className="text-3xl font-mono font-bold text-white">{ping} <span className="text-sm text-gray-500">åª</span></div>
                        </div>
                        <div className="grid grid-cols-2 gap-2 mb-6">
                            {[
                                { k: 'westSun', l: 'ğŸŒ è¥¿æ›¬' }, { k: 'allDaySun', l: 'â˜€ï¸ ç™½å¤©æ—¥æ›¬' },
                                { k: 'topFloor', l: 'ğŸ  é ‚æ¨“ / å¹³æˆ¿' }, { k: 'highCeiling', l: 'ğŸ“ æŒ‘é«˜ (>3m)' },
                                { k: 'ironSheet', l: 'ğŸ­ éµçš®å±‹', d: conditions.blackIron }, { k: 'blackIron', l: 'ğŸ”¥ é»‘è‰²éµçš®' }
                            ].map(c => (
                                <label key={c.k} className={`flex items-center space-x-2 bg-industrial-900 p-2 rounded border border-industrial-700 cursor-pointer ${c.d ? 'opacity-30' : ''}`}>
                                    <input type="checkbox" checked={conditions[c.k]} onChange={()=>!c.d && toggleCondition(c.k)} disabled={c.d} className="rounded text-industrial-accent" />
                                    <span className="text-xs">{c.l}</span>
                                </label>
                            ))}
                        </div>
                        <button onClick={calculate} className="w-full py-3 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-lg shadow-lg transition">è¨ˆç®—å†·æˆ¿èƒ½åŠ›</button>
                    </div>
                    {result && (
                        <div className="bg-industrial-900 rounded-lg p-5 border border-yellow-600/50 text-center animate-slide-up relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-yellow-600"></div>
                             <div className="flex justify-center items-end gap-4">
                                 <div><div className="text-4xl font-bold text-white font-mono">{result.kw}</div><div className="text-xs text-yellow-500">KW</div></div>
                                 <div className="text-gray-500 pb-2">/</div>
                                 <div><div className="text-2xl font-bold text-white font-mono">{result.tons}</div><div className="text-xs text-yellow-500">é “ (åƒè€ƒ)</div></div>
                             </div>
                        </div>
                    )}
                </div>
            );
        }

        // --- å†·åª’è¨ˆç®—æ©Ÿå…ƒä»¶ ---
        function RefrigerantCalculator({ addToHistory }) {
            const [baseLen, setBaseLen] = useState(5), [totalLen, setTotalLen] = useState(''), [gramPerMeter, setGramPerMeter] = useState(20), [result, setResult] = useState(null);
            const calculate = () => {
                const total = parseFloat(totalLen);
                if (isNaN(total) || total < 0) return alert('è«‹è¼¸å…¥æœ‰æ•ˆç®¡é•·');
                const addAmount = Math.max(0, Math.round((total - baseLen) * gramPerMeter));
                setResult(addAmount);
                addToHistory(`å†·åª’è¨ˆç®—: éœ€è£œ ${addAmount}g`, 'calc', { baseLen, totalLen: total, gramPerMeter, result: addAmount });
            };
            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <h2 className="text-lg font-bold mb-6 text-green-400 flex items-center gap-2"><i data-lucide="scale" className="w-5 h-5"></i> å†·åª’è£œå……é‡è¨ˆç®—</h2>
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">åŸå» åŸºæº–é•·åº¦ (m)</label>
                                <div className="flex gap-2">
                                    {[5, 8].map(l => <button key={l} onClick={()=>setBaseLen(l)} className={`flex-1 py-2 rounded text-sm font-bold border ${baseLen===l ? 'bg-green-600 border-green-500 text-white' : 'bg-industrial-900 border-industrial-600 text-gray-400'}`}>{l}m</button>)}
                                </div>
                            </div>
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">æ¯ç±³è£œå……é‡ (g/m)</label>
                                <div className="grid grid-cols-3 gap-2">
                                    {[15, 20, 30].map(v => <button key={v} onClick={()=>setGramPerMeter(v)} className={`py-2 rounded text-sm font-bold border ${gramPerMeter===v ? 'bg-green-600 border-green-500 text-white' : 'bg-industrial-900 border-industrial-600 text-gray-400'}`}>{v}g</button>)}
                                </div>
                            </div>
                            <div>
                                <label className="text-xs text-gray-500 mb-1 block">å¯¦éš›ç®¡é•· (m)</label>
                                <input type="number" value={totalLen} onChange={e=>setTotalLen(e.target.value)} className="w-full text-2xl py-3 px-4 bg-industrial-900 border-2 border-industrial-600 focus:border-green-500 rounded-lg text-center" />
                            </div>
                            <button onClick={calculate} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg shadow-lg transition flex items-center justify-center gap-2"><i data-lucide="calculator" className="w-5 h-5"></i> é–‹å§‹è¨ˆç®—</button>
                        </div>
                        {result !== null && (
                            <div className="mt-6 bg-industrial-900 rounded-lg p-4 border border-industrial-600 text-center animate-bounce-in">
                                <span className="block text-gray-500 text-xs mb-1">éœ€è£œå……å†·åª’é‡</span>
                                <div className="text-4xl font-mono font-bold text-green-400">{result} <span className="text-lg">g</span></div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- é™æº«æ™‚é–“ä¼°ç®—å…ƒä»¶ ---
        function CoolingTimeCalculator({ addToHistory }) {
            const [ping, setPing] = useState(''), [height, setHeight] = useState(3.0), [currentTemp, setCurrentTemp] = useState(32), [targetTemp, setTargetTemp] = useState(26), [acKw, setAcKw] = useState(''), [minutes, setMinutes] = useState(null);
            const calculate = () => {
                const p = parseFloat(ping), h = parseFloat(height), kw = parseFloat(acKw), dt = currentTemp - targetTemp;
                if (!p || !kw || dt <= 0) return alert('è«‹æª¢æŸ¥æ•¸å€¼');
                const volume = p * 3.3058 * h;
                const airMass = volume * 1.2;
                const totalLoadKJ = airMass * 1.005 * dt * 10; // åŠ å…¥ç†±è“„ç©ä¿‚æ•¸
                const timeMinutes = Math.round((totalLoadKJ / kw) / 60);
                setMinutes(timeMinutes);
                addToHistory(`é™æº«ä¼°ç®—: ç´„ ${timeMinutes} åˆ†é˜`, 'cooling', { ping: p, height: h, deltaT: dt, acKw: kw, minutes: timeMinutes });
            };
            return (
                <div className="animate-fade-in space-y-4">
                    <div className="bg-industrial-800 rounded-xl p-6 border border-industrial-700 shadow-xl">
                        <h2 className="text-lg font-bold mb-4 flex items-center gap-2 text-purple-400"><i data-lucide="thermometer" className="w-5 h-5"></i> é™æº«æ™‚é–“ä¼°ç®—</h2>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value={ping} onChange={e=>setPing(e.target.value)} placeholder="ç©ºé–“åªæ•¸" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" />
                            <input type="number" value={height} onChange={e=>setHeight(e.target.value)} placeholder="é«˜åº¦ (m)" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-white" step="0.1" />
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <input type="number" value={currentTemp} onChange={e=>setCurrentTemp(e.target.value)} placeholder="ç›®å‰å®¤æº«" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-red-300" />
                            <input type="number" value={targetTemp} onChange={e=>setTargetTemp(e.target.value)} placeholder="ç›®æ¨™æº«" className="bg-industrial-900 border border-industrial-600 rounded p-2 text-center text-blue-300" />
                        </div>
                        <input type="number" value={acKw} onChange={e=>setAcKw(e.target.value)} placeholder="å†·æ°£èƒ½åŠ› (KW)" className="w-full bg-industrial-900 border border-industrial-600 rounded p-3 text-center text-white font-bold mb-6" />
                        <button onClick={calculate} className="w-full py-3 bg-purple-700 hover:bg-purple-600 text-white font-bold rounded-lg shadow-lg transition">é–‹å§‹æ¨¡æ“¬è¨ˆç®—</button>
                    </div>
                    {minutes !== null && (
                        <div className="bg-industrial-900 rounded-lg p-5 border border-purple-500/50 text-center animate-slide-up relative overflow-hidden">
                             <div className="absolute top-0 left-0 w-full h-1 bg-purple-500"></div>
                             <div className="text-4xl font-bold text-white font-mono mb-1">{minutes} <span className="text-sm font-sans font-normal text-gray-400">åˆ†é˜</span></div>
                             <div className="text-[10px] text-gray-500">*æ­¤ç‚ºç‰©ç†ä¼°ç®—å€¼ï¼Œå¯¦éš›æƒ…æ³å—éš”ç†±å½±éŸ¿</div>
                        </div>
                    )}
                </div>
            );
        }

        function NavButton({ active, onClick, icon, label }) {
            return (
                <button onClick={onClick} className={`flex flex-col items-center justify-center w-full h-full transition-colors ${active ? 'text-industrial-accent' : 'text-gray-500 hover:text-gray-300'}`}>
                    <i data-lucide={icon} className={`w-6 h-6 mb-1 ${active ? 'fill-current/20' : ''}`}></i>
                    <span className="text-[10px] font-bold">{label}</span>
                </button>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
