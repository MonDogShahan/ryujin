<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é¾ç¥åŠ©æ‰‹ - å°ˆæ¥­ç©ºèª¿é‹ç®—</title>
    <link rel="icon" href="icon.png" type="image/png" sizes="512x512">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="theme-color" content="#1a1a1a">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        /* åŸºç¤æ’ç‰ˆèˆ‡é¾ç¥æš—é‡‘è‰²ç³» */
        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a1a;
            color: #f0f0f0;
        }
        
        /* é ‚éƒ¨å°èˆªèˆ‡åˆ†é  */
        header {
            background: linear-gradient(145deg, #2a2a2a, #151515);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }
        h1 {
            margin: 0;
            color: #ffd700;
            font-size: 1.5em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            margin-right: auto;
        }
        .tab-btn {
            background: transparent;
            color: #aaaaaa;
            border: none;
            font-size: 1.1em;
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: 0.3s;
        }
        .tab-btn.active {
            color: #ffd700;
            border-bottom: 2px solid #ffd700;
        }

        /* å…§å®¹å€å¡Š */
        .tab-content {
            display: none;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        .tab-content.active {
            display: block;
        }

        /* ç©ºé–“å¡ç‰‡è¨­è¨ˆ */
        .space-card {
            background: #242424;
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .space-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        .space-title-input {
            background: transparent;
            border: none;
            color: #ffd700;
            font-size: 1.3em;
            font-weight: bold;
            width: 70%;
            outline: none;
        }
        .space-title-input::placeholder { color: #888; }

        .delete-btn {
            background: transparent;
            color: #ff4c4c;
            border: 1px solid #ff4c4c;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: 0.2s;
        }
        .delete-btn:hover {
            background: #ff4c4c;
            color: white;
        }

        /* è¡¨å–®èˆ‡é¸é …ç¶²æ ¼ */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            font-size: 0.9em;
            color: #aaa;
            margin-bottom: 5px;
        }
        .input-group input[type="number"] {
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #444;
            background: #1a1a1a;
            color: #fff;
            outline: none;
        }
        .input-group input[type="number"]:focus {
            border-color: #ffd700;
        }
        
        .ping-input {
            color: #ffd700 !important;
            font-weight: bold;
        }
        
        /* ç’°å¢ƒé¸é …å€å¡Š */
        .options-section {
            background: #1e1e1e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .options-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        .options-row:last-child { margin-bottom: 0; }
        .option-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95em;
            color: #ddd;
        }
        .option-label input { margin-right: 5px; }

        /* çµæœé¡¯ç¤º */
        .result-box {
            text-align: right;
            font-size: 1.2em;
            color: #ffd700;
            font-weight: bold;
            padding-top: 10px;
        }

        /* åº•éƒ¨æ“ä½œæŒ‰éˆ• */
        .action-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            margin-bottom: 40px;
        }
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-add { background: linear-gradient(145deg, #ffd700, #d4af37); color: #1a1a1a; }
        .btn-pdf { background: #4a90e2; color: white; }
        .btn-reset { background: transparent; border: 2px solid #ff4c4c; color: #ff4c4c; }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <div id="main-ui">
        <header>
            <img src="icon.png" alt="é¾ç¥" class="header-logo" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI1MCIgZmlsbD0iI2ZmZDcwMCIvPjwvc3ZnPg=='">
            <h1>é¾ç¥åŠ©æ‰‹</h1>
            <button class="tab-btn active" onclick="switchTab('calc')">è² è¼‰è¨ˆç®—</button>
            <button class="tab-btn" onclick="switchTab('flange')">åŠéš±å¼é¢¨ç®¡è¦åŠƒ</button>
        </header>

        <div id="calc" class="tab-content active">
            <div id="spaces-container"></div>
            <div class="action-bar">
                <button class="btn btn-add" onclick="addSpace()">+ æ–°å¢ç©ºé–“</button>
                <button class="btn btn-pdf" id="btn-export" onclick="exportPDF()">åŒ¯å‡º PDF è¡¨å–®</button>
                <button class="btn btn-reset" onclick="resetAll()">é‡ç½®è³‡æ–™</button>
            </div>
        </div>

        <div id="flange" class="tab-content">
            <div class="space-card">
                <div class="space-header">
                    <div style="color: #ffd700; font-size: 1.3em; font-weight: bold;">åŠéš±å¼é›†é¢¨ç®±é–‹å­”é‹ç®—</div>
                </div>
                
                <div class="input-grid">
                    <div class="input-group">
                        <label>å¹å‡ºå£æ³•è˜­å¯¬åº¦ (cm)</label>
                        <input type="number" id="flange-w" placeholder="è¼¸å…¥å¯¬åº¦" oninput="updateFlange()">
                    </div>
                    <div class="input-group">
                        <label>å¹å‡ºå£æ³•è˜­é«˜åº¦ (cm)</label>
                        <input type="number" id="flange-h" placeholder="è¼¸å…¥é«˜åº¦" oninput="updateFlange()">
                    </div>
                    <div class="input-group">
                        <label>ç›®æ¨™å‡ºé¢¨å£æ•¸é‡ (å¯é¸)</label>
                        <input type="number" id="flange-t" placeholder="ä¾‹å¦‚: 4" oninput="updateFlange()">
                    </div>
                </div>

                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #444;">
                    <span style="font-size: 1em; color: #aaa;">æ³•è˜­æˆªé¢ç©ï¼š</span>
                    <span id="flange-area-text" style="color: #fff; font-size: 1.3em; font-weight: bold;">0</span>
                    <span style="color: #aaa;"> cmÂ²</span>
                </div>

                <div class="result-box" id="flange-result-box" style="margin-top: 15px; font-size: 1.4em;">
                    å»ºè­°é…ç½®ï¼šè«‹è¼¸å…¥å°ºå¯¸
                </div>
            </div>

            <div class="space-card" style="background: #1e1e1e; border: none; padding: 15px;">
                <p style="color: #888; font-size: 0.9em; line-height: 1.6; margin: 0;">
                    ğŸ’¡ <strong>é¾ç¥é‹ç®—é‚è¼¯ï¼š</strong><br>
                    â€¢ ç³»çµ±å…§å»º 8è‹±å‹(314cmÂ²)ã€10è‹±å‹(490cmÂ²)ã€12è‹±å‹(706cmÂ²) åœ“é¢ç©æ¨™æº–ã€‚<br>
                    â€¢ è¼¸å…¥ç›®æ¨™æ•¸é‡æ™‚ï¼Œæœƒè‡ªå‹•å˜—è©¦ç”±å¤§åˆ°å°åŒ¹é…åˆé©ç®¡å¾‘ï¼›è‹¥ç„¡ç¬¦åˆè©²æ•¸é‡çš„ç®¡å¾‘ï¼Œç³»çµ±æœƒè‡ªå‹•éæ¸›å°‹æ‰¾æœ€ä½³è§£ã€‚<br>
                    â€¢ ç›®æ¨™æ•¸é‡ç‚º 1 æ™‚ï¼Œæœƒå¼·åˆ¶ç”±æœ€å¤§ç®¡å¾‘ (12è‹±å‹) é–‹å§‹å¾€ä¸‹é™¤ï¼Œç¢ºä¿é¢¨é‡ç„¡æã€‚
                </p>
            </div>
        </div>
    </div>

    <script>
        let appState = {
            spaces: [],
            spaceCounter: 1,
            flange: { w: '', h: '', t: '' }
        };

        function loadData() {
            const savedData = localStorage.getItem('dragonGodSpaces');
            if (savedData) {
                let parsed = JSON.parse(savedData);
                if (Array.isArray(parsed)) {
                    appState.spaces = parsed;
                    appState.spaceCounter = parsed.length + 1;
                } else {
                    appState = parsed;
                }
            }
            
            if (!appState.flange) {
                appState.flange = { w: '', h: '', t: '' };
            }

            if (appState.spaces.length === 0) {
                appState.spaceCounter = 1;
                addSpace(); 
            } else {
                renderSpaces(); 
            }

            document.getElementById('flange-w').value = appState.flange.w;
            document.getElementById('flange-h').value = appState.flange.h;
            document.getElementById('flange-t').value = appState.flange.t;
            calculateFlange(); 
        }

        function saveDataSilently() {
            localStorage.setItem('dragonGodSpaces', JSON.stringify(appState));
        }

        function updateFlange() {
            appState.flange.w = document.getElementById('flange-w').value;
            appState.flange.h = document.getElementById('flange-h').value;
            appState.flange.t = document.getElementById('flange-t').value;
            saveDataSilently();
            calculateFlange();
        }

        function calculateFlange() {
            let w = parseFloat(appState.flange.w) || 0;
            let h = parseFloat(appState.flange.h) || 0;
            let t = parseInt(appState.flange.t) || 0;
            
            let areaText = document.getElementById('flange-area-text');
            let resBox = document.getElementById('flange-result-box');

            if (w <= 0 || h <= 0) {
                areaText.innerText = "0";
                resBox.innerText = "å»ºè­°é…ç½®ï¼šè«‹è¼¸å…¥æ³•è˜­å¯¬åº¦èˆ‡é«˜åº¦";
                resBox.style.color = "#ffd700";
                return;
            }

            let area = w * h;
            areaText.innerText = area;

            if (area < 314) {
                resBox.innerText = "å»ºè­°é…ç½®ï¼šæˆªé¢ç©éå°ï¼Œç„¡æ³•é–‹ 8 è‹±å‹å­”";
                resBox.style.color = "#ff4c4c";
                return;
            }

            let sizes = [
                { name: "12è‹±å‹", area: 706 },
                { name: "10è‹±å‹", area: 490 },
                { name: "8è‹±å‹", area: 314 }
            ];

            let bestMatch = null;

            if (t > 0) {
                let currentTarget = t;
                while (currentTarget > 0) {
                    for (let i = 0; i < sizes.length; i++) {
                        if (Math.floor(area / sizes[i].area) === currentTarget) {
                            bestMatch = { size: sizes[i].name, count: currentTarget };
                            break; 
                        }
                    }
                    if (bestMatch) break; 
                    currentTarget--; 
                }
            } else {
                for (let i = 0; i < sizes.length; i++) {
                    let maxCount = Math.floor(area / sizes[i].area);
                    if (maxCount >= 1) {
                        bestMatch = { size: sizes[i].name, count: maxCount };
                        break;
                    }
                }
            }

            resBox.style.color = "#ffd700";
            if (bestMatch) {
                if (t > 0 && bestMatch.count !== t) {
                    resBox.innerHTML = `å»ºè­°é…ç½®ï¼š<span style="color:#fff">${bestMatch.size} Ã— ${bestMatch.count} å€‹</span><br><span style="font-size: 0.6em; color: #ff4c4c; display:block; margin-top:5px;">(ç©ºé–“ä¸è¶³ ${t} å€‹ï¼Œå·²è‡ªå‹•éæ¸›)</span>`;
                } else {
                    resBox.innerHTML = `å»ºè­°é…ç½®ï¼š<span style="color:#fff">${bestMatch.size} Ã— ${bestMatch.count} å€‹</span>`;
                }
            } else {
                resBox.innerText = "å»ºè­°é…ç½®ï¼šç„¡æ³•åŒ¹é…é©åˆçš„ç®¡å¾‘";
            }
        }

        function addSpace() {
            const newId = Date.now().toString();
            appState.spaces.push({
                id: newId,
                name: 'ç©ºé–“' + appState.spaceCounter, 
                length: '', width: '', ping: '',
                sun: 'none', roof: 'none', topFloor: false, highCeiling: false, kw: 0
            });
            appState.spaceCounter++; 
            saveDataSilently();
            renderSpaces(); 
        }

        function removeSpace(id) {
            if (appState.spaces.length <= 1) {
                alert("ç„¡æ³•åˆªé™¤ï¼è¡¨å–®ä¸­è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹ç©ºé–“é€²è¡Œè¨ˆç®—ã€‚");
                return;
            }
            if (confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ç©ºé–“çš„è³‡æ–™å—ï¼Ÿ")) {
                appState.spaces = appState.spaces.filter(space => space.id !== id);
                saveDataSilently();
                renderSpaces();
            }
        }

        function updateField(id, field, value) {
            const space = appState.spaces.find(s => s.id === id);
            if (!space) return;

            space[field] = value;

            if (field === 'length' || field === 'width') {
                const l = parseFloat(space.length) || 0;
                const w = parseFloat(space.width) || 0;
                if (l > 0 && w > 0) {
                    const ping = ((l / 100) * (w / 100)) * 0.3025;
                    space.ping = ping.toFixed(2);
                    document.getElementById('ping_' + id).value = space.ping;
                } else {
                    space.ping = '';
                    document.getElementById('ping_' + id).value = '';
                }
            }

            const pingVal = parseFloat(space.ping) || 0;
            let kwVal = pingVal * 0.6; 
            
            if (kwVal > 0) {
                if (space.sun === 'west') kwVal *= 1.15;
                if (space.sun === 'all') kwVal *= 1.25;
                if (space.topFloor) kwVal *= 1.15;
                if (space.highCeiling) kwVal *= 1.10;
                if (space.roof === 'tin') kwVal *= 1.20;
                if (space.roof === 'black_tin') kwVal *= 1.30;
            }
            space.kw = kwVal.toFixed(2);
            
            document.getElementById('result_' + id).innerText = 'å»ºè­°èƒ½åŠ›ï¼šç´„ ' + space.kw + ' kW';
            saveDataSilently();
        }

        function renderSpaces() {
            const container = document.getElementById('spaces-container');
            container.innerHTML = '';

            appState.spaces.forEach((space) => {
                const card = document.createElement('div');
                card.className = 'space-card';
                card.innerHTML = `
                    <div class="space-header">
                        <input type="text" class="space-title-input" placeholder="ç©ºé–“åç¨±" 
                               value="${space.name}" oninput="updateField('${space.id}', 'name', this.value)">
                        <button class="delete-btn" onclick="removeSpace('${space.id}')">åˆªé™¤</button>
                    </div>
                    
                    <div class="input-grid">
                        <div class="input-group">
                            <label>é•·åº¦ (cm)</label>
                            <input type="number" placeholder="å…¬åˆ†" value="${space.length}" 
                                   oninput="updateField('${space.id}', 'length', this.value)">
                        </div>
                        <div class="input-group">
                            <label>å¯¬åº¦ (cm)</label>
                            <input type="number" placeholder="å…¬åˆ†" value="${space.width}" 
                                   oninput="updateField('${space.id}', 'width', this.value)">
                        </div>
                        <div class="input-group">
                            <label>åªæ•¸</label>
                            <input type="number" id="ping_${space.id}" class="ping-input" step="0.01" placeholder="å¯æ‰‹å‹•" value="${space.ping}" 
                                   oninput="updateField('${space.id}', 'ping', this.value)">
                        </div>
                    </div>

                    <div class="options-section">
                        <div class="options-row">
                            <label class="option-label"><input type="radio" name="sun_${space.id}" value="none" ${space.sun === 'none' ? 'checked' : ''} onchange="updateField('${space.id}', 'sun', this.value)"> ç„¡è¥¿æ›¬</label>
                            <label class="option-label"><input type="radio" name="sun_${space.id}" value="west" ${space.sun === 'west' ? 'checked' : ''} onchange="updateField('${space.id}', 'sun', this.value)"> è¥¿æ›¬</label>
                            <label class="option-label"><input type="radio" name="sun_${space.id}" value="all" ${space.sun === 'all' ? 'checked' : ''} onchange="updateField('${space.id}', 'sun', this.value)"> å…¨æ—¥æ›¬</label>
                        </div>
                        <div class="options-row">
                            <label class="option-label"><input type="checkbox" ${space.topFloor ? 'checked' : ''} onchange="updateField('${space.id}', 'topFloor', this.checked)"> é ‚æ¨“</label>
                            <label class="option-label"><input type="checkbox" ${space.highCeiling ? 'checked' : ''} onchange="updateField('${space.id}', 'highCeiling', this.checked)"> æŒ‘é«˜</label>
                        </div>
                        <div class="options-row">
                            <label class="option-label"><input type="radio" name="roof_${space.id}" value="none" ${space.roof === 'none' ? 'checked' : ''} onchange="updateField('${space.id}', 'roof', this.value)"> ä¸€èˆ¬å±‹é ‚</label>
                            <label class="option-label"><input type="radio" name="roof_${space.id}" value="tin" ${space.roof === 'tin' ? 'checked' : ''} onchange="updateField('${space.id}', 'roof', this.value)"> éµçš®</label>
                            <label class="option-label"><input type="radio" name="roof_${space.id}" value="black_tin" ${space.roof === 'black_tin' ? 'checked' : ''} onchange="updateField('${space.id}', 'roof', this.value)"> é»‘éµçš®</label>
                        </div>
                    </div>
                    <div class="result-box" id="result_${space.id}">å»ºè­°èƒ½åŠ›ï¼šç´„ ${space.kw} kW</div>
                `;
                container.appendChild(card);
            });
        }

        function resetAll() {
            if (confirm("è­¦å‘Šï¼šç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ¸¬é‡è³‡æ–™å—ï¼Ÿ")) {
                localStorage.removeItem('dragonGodSpaces');
                appState = { spaces: [], spaceCounter: 1, flange: { w: '', h: '', t: '' } };
                addSpace();
                document.getElementById('flange-w').value = '';
                document.getElementById('flange-h').value = '';
                document.getElementById('flange-t').value = '';
                calculateFlange();
            }
        }

        function exportPDF() {
            const hasData = appState.spaces.some(space => parseFloat(space.kw) > 0 || parseFloat(space.ping) > 0);
            if (!hasData) {
                alert("ç›®å‰æ²’æœ‰ä»»ä½•æ¸¬é‡è³‡æ–™ï¼"); return;
            }

            const btn = document.getElementById('btn-export');
            btn.innerText = "ç”Ÿæˆè¡¨å–®ä¸­..."; btn.disabled = true;

            document.getElementById('main-ui').style.display = 'none';

            const printArea = document.createElement('div');
            printArea.id = 'print-area';
            printArea.style.backgroundColor = '#ffffff';
            printArea.style.color = '#000000';
            printArea.style.padding = '30px';
            printArea.style.minHeight = '100vh';
            printArea.style.fontFamily = "'Microsoft JhengHei', sans-serif";

            const today = new Date();
            const dateString = `${today.getFullYear()}/${today.getMonth() + 1}/${today.getDate()}`;

            let textBlocks = '';
            appState.spaces.forEach((space) => {
                let conditions = [];
                if (space.sun === 'west') conditions.push('è¥¿æ›¬');
                if (space.sun === 'all') conditions.push('å…¨æ—¥æ›¬');
                if (space.topFloor) conditions.push('é ‚æ¨“');
                if (space.highCeiling) conditions.push('æŒ‘é«˜');
                if (space.roof === 'tin') conditions.push('éµçš®');
                if (space.roof === 'black_tin') conditions.push('é»‘éµçš®');
                
                let condText = conditions.length > 0 ? conditions.join('ã€') : 'ç„¡ç‰¹æ®Šç’°å¢ƒ';
                let dimText = (space.length && space.width) ? `${space.length} Ã— ${space.width} cm` : 'æœªå¡«å¯«å°ºå¯¸';
                let pingText = space.ping ? `${space.ping} åª` : 'æœªå¡«å¯«åªæ•¸';
                let kwText = space.kw > 0 ? `${space.kw} kW` : 'å°šæœªè¨ˆç®—';

                textBlocks += `
                    <div style="border-bottom: 1px dashed #ccc; padding: 15px 0; page-break-inside: avoid;">
                        <div style="font-size: 20px; font-weight: bold; margin-bottom: 8px;">ğŸ”¸ ${space.name || 'æœªå‘½åç©ºé–“'}</div>
                        <div style="font-size: 16px; color: #333; line-height: 1.8;">
                            â€¢ æ¸¬é‡å°ºå¯¸ï¼š${dimText} ï½œ æ›ç®—åªæ•¸ï¼š${pingText}<br>
                            â€¢ ç’°å¢ƒæ¢ä»¶ï¼š${condText}<br>
                            <span style="color: #d32f2f; font-weight: bold; font-size: 18px;">ğŸ‘‰ å»ºè­°èƒ½åŠ›ï¼šç´„ ${kwText}</span>
                        </div>
                    </div>
                `;
            });

            printArea.innerHTML = `
                <div style="border-bottom: 3px solid #000; padding-bottom: 15px; margin-bottom: 20px; display: flex; align-items: center;">
                    <h1 style="margin: 0; font-size: 26px; flex-grow: 1;">é¾ç¥åŠ©æ‰‹ - ç©ºé–“è² è¼‰å ±è¡¨</h1>
                    <div style="font-size: 14px; color: #666;">åˆ—å°æ—¥æœŸï¼š${dateString}</div>
                </div>
                ${textBlocks}
                <div style="margin-top: 30px; font-size: 13px; color: #888;">
                    * å‚™è¨»ï¼šæ­¤è¡¨å–®èƒ½åŠ›å»ºè­°åƒ…ä¾›åˆæ­¥è©•ä¼°ï¼Œå¯¦éš›ä»¥ç¾å ´ç®¡ç·šé…ç½®èˆ‡å®¢æˆ¶éœ€æ±‚ç‚ºæº–ã€‚
                </div>
            `;

            document.body.appendChild(printArea);
            window.scrollTo(0, 0);

            html2pdf().set({
                margin: 0.5, filename: 'ç©ºèª¿ç©ºé–“è² è¼‰è¨ˆç®—è¡¨.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            }).from(printArea).save().then(() => {
                document.body.removeChild(printArea);
                document.getElementById('main-ui').style.display = 'block';
                btn.innerText = "åŒ¯å‡º PDF è¡¨å–®"; btn.disabled = false;
            }).catch((err) => {
                if(document.getElementById('print-area')) document.body.removeChild(printArea);
                document.getElementById('main-ui').style.display = 'block';
                btn.innerText = "åŒ¯å‡º PDF è¡¨å–®"; btn.disabled = false;
                alert("åŒ¯å‡ºå¤±æ•—ï¼Œè«‹é‡è©¦ã€‚");
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        window.onload = loadData;
    </script>
</body>
</html>
